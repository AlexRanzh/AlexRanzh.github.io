<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Introduction to Machine Learning</title>
      <link href="/2019/04/16/Introduction%20to%20Machine%20Learning/"/>
      <url>/2019/04/16/Introduction%20to%20Machine%20Learning/</url>
      
        <content type="html"><![CDATA[<p>This note is based on 2019 Spring COMPSCI189/289A course at University of California, Berkeley by Jonathan Shewchuk.</p><p>#Supervised Learning</p><h2 id="Classification"><a href="#Classification" class="headerlink" title="Classification"></a>Classification</h2><h3 id="example-1-classify-digit-1-and-7"><a href="#example-1-classify-digit-1-and-7" class="headerlink" title="example 1: classify digit 1 and 7"></a>example 1: classify digit 1 and 7</h3><ol><li>$N\times N$ pixels matrices</li><li>flatten into vector</li><li>create a classifier for $N\times N$ space<br>Note: Decision Boundary is a hyperplane</li></ol><h3 id="example-2-Bank-loan-default-prediction"><a href="#example-2-Bank-loan-default-prediction" class="headerlink" title="example 2: Bank loan default prediction"></a>example 2: Bank loan default prediction</h3><p>See notes for M3S17<a href>Quantitative Methods for Finance</a></p><h3 id="Feature-Independent-Variables-Predictor-Variables"><a href="#Feature-Independent-Variables-Predictor-Variables" class="headerlink" title="Feature/Independent Variables/ Predictor Variables"></a>Feature/Independent Variables/ Predictor Variables</h3><p>?</p><h3 id="Overfitting"><a href="#Overfitting" class="headerlink" title="Overfitting"></a>Overfitting</h3><p>The model is shaped to specifically to one certain data set so not predictive to new data.</p><p>When the test error worse coz the classifier becomes too sensitive to outliers or to other spurious/untrue patterns.</p><p>Sinuous decision boundaries that fit the sample points so well that it do not classify future points well.</p><h4 id="Quantify-Overfitting"><a href="#Quantify-Overfitting" class="headerlink" title="Quantify Overfitting"></a>Quantify Overfitting</h4><h3 id="Decision-Boundary"><a href="#Decision-Boundary" class="headerlink" title="Decision Boundary"></a>Decision Boundary</h3><p>The boundary chosen by classifier to separate items in class from those are not.</p><h3 id="Decision-Function"><a href="#Decision-Function" class="headerlink" title="Decision Function"></a>Decision Function</h3><p>A function $f(x)$ that maps a sample point to a scalar value that<br>$$<br>f(x)&gt;0 if x \in class C<br>f(x)\leq if x not \in class C<br>$$</p><p>For these decision function, the decision boundary is $f(x)=0$, <strong>usually</strong> a (d-1) dimensional surface in $R^d$.</p><h3 id="Isosurface-iso-contours"><a href="#Isosurface-iso-contours" class="headerlink" title="Isosurface/iso contours"></a>Isosurface/iso contours</h3><p>A isosurface for function $f$ is ${x: f(x)=0}$, 0 is isovalue here.<br>Note: â€˜iso-â€˜ prefix means â€˜equal-â€˜</p><h3 id="Linear-classifier"><a href="#Linear-classifier" class="headerlink" title="Linear classifier"></a>Linear classifier</h3><p>The decision boundary is a line/plane<br>Usually a linear decision function.</p><p>$$<br>x=(x_1,x_2,â€¦,x_5)^T</p><p>$$</p><h3 id="Conventions"><a href="#Conventions" class="headerlink" title="Conventions:"></a>Conventions:</h3><p>Uppercase roman: matrix, random variables, set<br>Lowercase roman: vector<br>Greek: scalar<br>Other scalar:</p><ul><li>n, number of sample points</li><li>d, number of features</li><li>i,j,k, integer indices<br>Function: f(), s(),â€¦</li></ul><h3 id="Norms"><a href="#Norms" class="headerlink" title="Norms"></a>Norms</h3><ul><li>Euclidean norms</li><li>Normalize a vector: $\frac{x}{|x|}$</li><li>dot product:<ul><li>length:$|x|=\sum x_i y_i$</li><li>angle: $cos(\theta)=\frac{x\dot y}{|x||y|}$</li></ul></li></ul><h3 id="hyperplane"><a href="#hyperplane" class="headerlink" title="hyperplane"></a>hyperplane</h3><p>Given a decision function $f(x)=w\dot x+\alpha$ is $H={x: w\dot x =-\alpha }$<br>The set H is a <strong>hyperplane</strong>.</p><p><strong>property</strong><br>For any x, y on H, $w\dot(y-x)=0$</p><p><strong>normal vector</strong> w</p><p><strong>signed distance</strong>$w\dot x +\alpha$, $w$ is unit vector<br>i.e. positive on one side of H, negative on the other side</p><p>Note: the distance from H to the origin is $\alpha$.<br>Note2: $\alpha =0$ iff H passes through origin</p><h3 id="weights"><a href="#weights" class="headerlink" title="weights"></a>weights</h3><p>coefficients in $w$ and$\alpha$ are called <strong>weights</strong> or <strong>regression coefficients</strong></p><h3 id="Linearly-separable"><a href="#Linearly-separable" class="headerlink" title="Linearly separable"></a>Linearly separable</h3><p>the input data is <strong>linearly separable</strong> if there exists a hyperplane that separates all the sample planes in C from those not in C.</p><h3 id="Centriod-classifier"><a href="#Centriod-classifier" class="headerlink" title="Centriod classifier"></a>Centriod classifier</h3><p>computer mean $\mu_c$ of all vectors in class C and meam $\mu_x$ of al vectors NOT in class C.</p><ul><li>Decision function:<br>$f(x)=(\mu_c-\mu_x)\dot x-(\mu_c-\mu_x)\dot \frac{(\mu_c-\mu_x)}{2}$<br>$(\mu_c-\mu_x)$ is normal vector<br>$\frac{(\mu_c-\mu_x)}{2}$ is midpoint between$\mu_c, \mu_x$<br>so the decision boundary is the hyperplane that bisects \bar{\mu_c\mu_x}</li><li>good at: classify with samples from two gaussian/normal distributions, especially when sample size is large</li></ul><h3 id="Perceptron-Algorithm"><a href="#Perceptron-Algorithm" class="headerlink" title="Perceptron Algorithm"></a>Perceptron Algorithm</h3><blockquote><p>Slow but correct for linearly separable points.<br>Uses a <strong>numerical optimisation</strong> algorithm, namely the <strong>gradient decent</strong>.</p></blockquote><p>Sample points $X_1,X_2,â€¦,X_n$.<br>For each sample point, $y_i = 1(\in C)\ or\ -1(\notin C)$</p><p>For simplicity, assume the decision boundaries pass through the origin.</p><h2 id="Regression"><a href="#Regression" class="headerlink" title="Regression"></a>Regression</h2><p>#Unsupervised Learning</p><h2 id="Clustering"><a href="#Clustering" class="headerlink" title="Clustering"></a>Clustering</h2><h2 id="Dimensionality-Reduction"><a href="#Dimensionality-Reduction" class="headerlink" title="Dimensionality Reduction"></a>Dimensionality Reduction</h2><h1 id="Validation"><a href="#Validation" class="headerlink" title="Validation"></a>Validation</h1><p>Hold back a subset of training data for future test useâ€“validation set(to tune hyperparameters/choose model).</p><p>test set: final evaluation</p><ol><li>train a classifier multiple times, with different model/hyperparameter</li><li>test it on NEW data</li><li>choose the setting that gives the best validation result<br>?why: we want the model to be working in general data. In most cases(knn for example),input used data will always give the right output, which is not valuable for our evaluation of the model.</li></ol><h2 id="Types-of-error"><a href="#Types-of-error" class="headerlink" title="Types of error"></a>Types of error</h2><ol><li>training set error: fraction of training images not classified correctly</li><li>test set error:<br>fraction of misclassifying new data</li></ol><h1 id="outlier"><a href="#outlier" class="headerlink" title="outlier:"></a>outlier:</h1><p>points are atypical</p><h1 id="hyperparameters"><a href="#hyperparameters" class="headerlink" title="hyperparameters"></a>hyperparameters</h1><p>~ control overfitting/underfitting(e.g. k in knn)</p>]]></content>
      
      
      
        <tags>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2019/04/14/hello-world/"/>
      <url>/2019/04/14/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><p><img src="/photos/1.png" alt></p><a id="more"></a><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p><img src="https://itimetraveler.github.io/hexo-theme-hiker/2016/10/24/Hiker%E4%B8%BB%E9%A2%98%E9%A2%84%E8%A7%88/homepage-index.png" alt></p><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Quantitative Methods in Retail Finance Note 4</title>
      <link href="/2019/04/14/Quantitative%20Methods%20in%20Retail%20Finance%20Note4/"/>
      <url>/2019/04/14/Quantitative%20Methods%20in%20Retail%20Finance%20Note4/</url>
      
        <content type="html"><![CDATA[<p>This notes follows materials from the slides for M3S17 at Imperial College London Mathematics Department by Dr. Tony Bellotti. Questions mentioned are referring to past exam papers of M3S17 at Imperial College London.</p><p>#Chapter 3: Markov Transition Model</p><h2 id="Markov-Transition-Models"><a href="#Markov-Transition-Models" class="headerlink" title="Markov Transition Models"></a>Markov Transition Models</h2><h3 id="Why-Markov-Chain-Model"><a href="#Why-Markov-Chain-Model" class="headerlink" title="Why Markov Chain Model?"></a>Why Markov Chain Model?</h3><p>This model allow us to track model <strong>changes in the state</strong> of an account over time.<br>e.g. Tracking credit card use.</p><h3 id="First-order-Markov-Transition-Model"><a href="#First-order-Markov-Transition-Model" class="headerlink" title="First-order Markov Transition Model"></a>First-order Markov Transition Model</h3><ul><li>Let $(X_1, X_2, â€¦, X_n)$ be a sequence of discrete random variables that take value from ${1,2,â€¦,K}$ with K fixed.</li><li><strong>first-order finite value Markov chain</strong><br>The sequence is said to be a <em>first-order finite value Markov chain</em> if<br>$$<br>P(X_{n+1}=j|X_0=x_0,X_1=x_1,X_2=x_2,â€¦,X_{n-1}=x_{n-1},X_n = i) = P(X_{n+1}=j|X_n = i)<br>$$<br>for all $n, x_0,x_1, â€¦, x_{n-1}$ and $i,j$ such that $1\leq i,j \leq K$.</li><li><strong>transition probability</strong><br><em>Transition probability</em> $p_n$ is defined as<br>$$<br>p_{n}(i,j)=P(X_n=j|X_{n-1}=i)<br>$$</li><li><strong>transition matrix</strong><br><em>Transition matrix</em> $P$ is defined as a $K \times K$ matrix such that<br>$$<br>P_n[i,j] = p_{n}(i,j)<br>$$</li><li><strong>structural zeroes</strong><br>If it is certain that no transition will be made from i to j in the $n$th period, then set $p_n(i,j)=0$, this is called a <em>structural zero</em>.</li></ul><p>###Propagation of Markov Chain<br>If we know the transition matrix from period $n-r$ to $n$, i.e. $P_r,P_{r+1},â€¦,P_{n-1}$ are known, then we also be able to know the state in the $n$th period:<br>$$<br>Prob(X_{n}=j|X_{n-r}=i) = P_{n-r+1}P_{n-r+2}â€¦P_{n}[i,j]<br>$$<br>for any $1\leq r \leq n$</p><p>Forcasting from state 0:<br>$$<br>Prob(X_{n}=j|X_{0}=i) = P_{1}P_{2}â€¦P_{n}[i,j]<br>$$<br>let $\pi_{i}$ be the marginal distribution for $X_n$:<br>$$\pi_n = (P(X_n = 1),P(X_n = 2),â€¦,P(X_n = K))^T$$</p><p>Then,<br>$$\pi_n = \pi_0(P_1 P_2 â€¦ P_n)$$</p><h3 id="Stationary-Markov-Chain"><a href="#Stationary-Markov-Chain" class="headerlink" title="Stationary Markov Chain"></a>Stationary Markov Chain</h3><ul><li><strong>stationary</strong><br>A Markov chain is <em>stationary</em> if $p_n(i,j)=p(i,j)$ for all $<strong>n</strong>,\ and\ i,j\ where 1\leq i, j \leq K$, for some transition probability $p$.</li><li><strong>stationary distribution</strong><br>A <em>stationary distribution</em> for transition matrix is a distribution $\pi^\star = \pi^\star P$.<blockquote><p>In practice, most Markov chains converge (with ğ‘›) to a stationary<br>distribution.<br>(Markov chains which have a periodicity in state change do not necessarily converge, but we do not cover this material in this course).</p></blockquote></li></ul><h2 id="Estimation"><a href="#Estimation" class="headerlink" title="Estimation"></a>Estimation</h2><p>The aim this section, given some data, is to estimate $\mathbf{\theta}=(\theta_{ij})^{K}<em>{i,j=1}$ where $\theta</em>{ij}=p(i,j)$.<br>Maximum likelihood estimator for $\mathbf{\theta}$:<br>$$<br>\hat\theta_{ij}=\hat p(i,j)=\frac{n_{ij}}{\sum_{l=1}^{n}n_{il}}<br>$$<br>where $n_{ij}=|{t:x_{t-1}=i,x_{t}=j,\ for \ t\in {1,2,â€¦,n}}|$, i.e. total number of observations that move from state $i$ to state $j$ during period 1 to n.<br><strong>proof</strong></p><blockquote><p>2017Q1<br>(c) Derive the maximum likelihood estimator for the first order finite-valued Markov transition model, assuming stationarity.</p></blockquote><ol><li>likelihood function</li></ol><p>$P(X_0=x_0,X_1=x_1,â€¦,X_n=x_n)$<br>$=\prod_{t=1}^{n} P(X_{t}=x_t|X_{t-1}=x_{t-1},X_{t-2}=x_{t-2},â€¦,X_{1}=x_{1})P(X_0=x_0)$<br>$=\prod_{t=1}^{n} P(X_{t}=x_t|X_{t-1}=x_{t-1})P(X_0=x_0)(Chain rule)$<br>$=P(X_0=x_0)\prod_{t=1}^{n} P(X_{t}=x_t|X_{t-1}=x_{t-1})$<br>$=P(X_0=x_0)\prod_{i=1}^{n}\prod_{j=1}^{n}[p(i,j)]^{n_{ij}}$<br>$=P(X_0=x_0)\prod_{i=1}^{n}\prod_{j=1}^{n}[\theta_{ij}]^{n_{ij}}$<br>$$<br>where\ n_{ij}=|{t:x_t=x_t,X_{t-1}=x_{t-1},\ for\ t\in {1,â€¦,n}}|<br>$$</p><ol start="2"><li>log likelihood function</li><li>differentiate and find MLE</li><li>adjust to constraints  </li></ol><h2 id="Testing-First-order-Assumptions"><a href="#Testing-First-order-Assumptions" class="headerlink" title="Testing First-order Assumptions"></a>Testing First-order Assumptions</h2><p>In order to test if first order markov chain is a suitable assumption in each occasion,<br>we use chi-square hypothesis test.</p><h3 id="second-order-Markov-chain"><a href="#second-order-Markov-chain" class="headerlink" title="second order Markov chain"></a>second order Markov chain</h3><p>A sequence (x_1,..,x_n) is a <em>second order Markov chain</em> if<br>$P(x_n+1=j|X_0=x_0,â€¦,X_{n-1}=k,X_{n}=i)=P(x_n+1=j|X_{n-1}=k,X_{n}=i)$</p><p>The <strong>transition probability</strong><br>$p_n(k,i,j)=P(X_n=i, X_{n-1}=k)$</p><p>The <strong>MLE for a second-Markov chain</strong> can similarly be proved as:<br>$\hat p(k,i,j)=\hat\theta_{kij}=\frac{n_kij}{mki}$<br>where $n_{kij}=|{t:x_{t-2}=k,x_{t-1}=i,x_{t}=j\ for\ t \in {2,â€¦,n}}|,<br>m_{ki}=|{t:x_{t-2}=k,x_{t-1}=i\ for\ t \in {2,â€¦,n}}|=\sum_{l=i}^{n}n_{kil}$</p><ol><li><p><strong>$H_{0}$</strong><br>Null hypothesis:<br>$P(1,i,j)=P(2,i,j)=â€¦=P(K,i,j)=P(i,j)$<br>where $P(k,i,j)$ is second-order Markov transition probability from state k to i then to j.</p></li><li><p><strong>$n_k$</strong><br>$n_k=|{t:x_t=k\ for\ t \in {1,..,n}}|$<br>i.e. The observed number of times for each states</p></li><li><p><strong>$O_{kj}$</strong><br>The observed number of times state k follwed by i and then j<br>$O_{kj}=n{kij}=m_{ki}\hat p(i,j)$</p></li><li><p><strong>$E_{kj}$</strong><br>The expected number of times state $k$ is followed by state $i$ and then $j$, <strong>given null hypothesis</strong> is:<br>$E_{kj}=n_{k}\hat p(k,i)\hat p(i,j)\approx m_{ki}\hat p(i,j)$<br>becuase $\hat p(k,i)=\frac{n_{ki}}{\sum_{l=1}^{K}n_{kl}}\approx \frac{m_{ki}}{n_k}$</p></li><li><p><strong>Pearson Chi_square test</strong><br>$$<br>\chi^2 = \sum_{k\in S_1}\sum_{k\in S_2}\frac{(O_{kj}-E{kj})^2}{E_{kj}}<br>$$</p></li></ol><ul><li>S1 is the set of states which do not have a structural zero moving to state $i$</li><li>S2 is the set of states which do not have a structural zero moving from state $i$</li></ul><ol start="6"><li><strong>Degree of freedom</strong><br>$df = (K-1-z_{1})(K-1-z_{2})$</li></ol><ul><li>$z_1$: the number of structural zeroes in the transition from $k$ to $i$.</li><li>$z_2$: the number of structural zeroes in the transition from $i$ to $j$.</li></ul><h2 id="Roll-rate-Model"><a href="#Roll-rate-Model" class="headerlink" title="Roll-rate Model"></a>Roll-rate Model</h2>]]></content>
      
      
      <categories>
          
          <category> Notes </category>
          
          <category> Math Notes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Credit Modelling </tag>
            
            <tag> Markov Transition Model </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Quantitative Methods in Retail Finance Note 3</title>
      <link href="/2019/04/14/Quantitative%20Methods%20in%20Retail%20Finance%20Note3/"/>
      <url>/2019/04/14/Quantitative%20Methods%20in%20Retail%20Finance%20Note3/</url>
      
        <content type="html"><![CDATA[<p>This notes follows materials from the slides for M3S17 at Imperial College London Mathematics Department by Dr. Tony Bellotti. Questions mentioned are referring to past exam papers of M3S17 at Imperial College London.</p><h1 id="Chapter-2-Survival-Models-for-Credit-Risk"><a href="#Chapter-2-Survival-Models-for-Credit-Risk" class="headerlink" title="Chapter 2: Survival Models for Credit Risk"></a>Chapter 2: Survival Models for Credit Risk</h1>]]></content>
      
      
      <categories>
          
          <category> Notes </category>
          
          <category> Math Notes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Survival Model </tag>
            
            <tag> Credit Modelling </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Quantitative Methods in Retail Finance Note 2</title>
      <link href="/2019/04/14/Quantitative%20Methods%20in%20Retail%20Finance%20Note2/"/>
      <url>/2019/04/14/Quantitative%20Methods%20in%20Retail%20Finance%20Note2/</url>
      
        <content type="html"><![CDATA[<p>This notes follows materials from the slides for M3S17 at Imperial College London Mathematics Department by Dr. Tony Bellotti. Questions mentioned are referring to past exam papers of M3S17 at Imperial College London.</p><h1 id="Chapter-8-Artificial-Neural-Networks-in-Fraud-detection"><a href="#Chapter-8-Artificial-Neural-Networks-in-Fraud-detection" class="headerlink" title="Chapter 8: Artificial Neural Networks in Fraud detection"></a>Chapter 8: Artificial Neural Networks in Fraud detection</h1><p>##</p>]]></content>
      
      
      <categories>
          
          <category> Notes </category>
          
          <category> Math Notes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ANN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Quantitative Method in Retail Finance Note 1</title>
      <link href="/2019/04/13/Quantitative%20Methods%20in%20Retail%20Finance%20Notes1/"/>
      <url>/2019/04/13/Quantitative%20Methods%20in%20Retail%20Finance%20Notes1/</url>
      
        <content type="html"><![CDATA[<p>This notes follows materials from the slides for M3S17 at Imperial College London Mathematics Department by Dr. Tony Bellotti. Questions mentioned are referring to past exam papers of M3S17 at Imperial College London.</p><h1 id="Chapter-7-Fraud-Detection-in-Retail-Credit"><a href="#Chapter-7-Fraud-Detection-in-Retail-Credit" class="headerlink" title="Chapter 7: Fraud Detection in Retail Credit"></a>Chapter 7: Fraud Detection in Retail Credit</h1><h2 id="Types-of-Fraud"><a href="#Types-of-Fraud" class="headerlink" title="Types of Fraud:"></a>Types of Fraud:</h2><ul><li>Theft</li><li>Counterfeit</li><li>Application</li><li>Card-not-present/online</li></ul><h2 id="Automated-Fraud-Detection"><a href="#Automated-Fraud-Detection" class="headerlink" title="Automated Fraud Detection"></a>Automated Fraud Detection</h2><p>This essentially is a classification problem, legitimate transaction Y=1, illegal Y=0.</p><p><strong>Special problems for fraud detection (that distinguish it from other classification problems)</strong></p><blockquote><p>2017 Q3(a) What special characteristics does fraud detection have, considered as a classification problem?<br>âˆ— Need to process millions of transactions in real time.<br>âˆ— Highly imbalanced classification problem: ratio of fraudulent to legitimate<br>transactions is typically very small.<br>âˆ— Nature of fraud is reflexive. That is, fraudsters adapt to the detection methods applied by banks to stop them.</p></blockquote><ol><li>High volume data.</li><li>Data highly imbalanced.</li><li>Reflexive nature.</li></ol><p><em>difference of fraud detection problem from application model?</em><br>  Do not need to explain the model, so nonlinear complicated models are allowed.</p><h2 id="Business-Rule-method"><a href="#Business-Rule-method" class="headerlink" title="Business Rule method"></a>Business Rule method</h2><blockquote><p>For example, the card is used abroad<br>and it had not been used in the past year in the country<br>and the card holder did not tell the bank they will be abroad</p></blockquote><h2 id="Predictive-Model-method"><a href="#Predictive-Model-method" class="headerlink" title="Predictive Model method"></a>Predictive Model method</h2><p>Construct a two-class classifier - a fraud scorecard.</p><ul><li>the higher the score, the more trustworthy the account is.</li><li>classifier model with function $f$: $\hat{y} = f(x,\theta)$, and estimate $\theta$ with data x.</li><li>filter out some legitimate transaction to balance training data set. e.g. discard small amount transactions, regular transactions and inactive accounts.<br><strong>past research have shown that a linear model is not enough, non-linear classifiers like ANN works better.</strong></li><li>This method works well in detecting known type fraudulent transactions, but not able to deal with new fraud types.</li></ul><h2 id="Anomaly-Detection-method"><a href="#Anomaly-Detection-method" class="headerlink" title="Anomaly Detection method"></a>Anomaly Detection method</h2><p>Another method is to model only the legal transactions and detect any abnormal new transactions.</p><h3 id="Comparing-with-predictive-modelling"><a href="#Comparing-with-predictive-modelling" class="headerlink" title="Comparing with predictive modelling:"></a>Comparing with predictive modelling:</h3><p>  pros:</p><ol><li>it can detect new types of fraud</li><li>it do not worry about the imbalanced data(coz 1)<br>con:</li><li>it is not as sensible to transactions that are similar to legitimate ones</li></ol><h3 id="One-class-classifier-only-model-legitimate-pdf-over-predictor-variables"><a href="#One-class-classifier-only-model-legitimate-pdf-over-predictor-variables" class="headerlink" title="One-class classifier only model legitimate pdf over predictor variables"></a>One-class classifier only model legitimate pdf over predictor variables</h3><blockquote><p>2017Q3(b) What are the key differences between one-class and two-class classifiers for fraud?<br>âˆ— Two-class classifiers are modelling the difference between fraudulent and legitimate transactions.<br>âˆ— One-class classifiers just model distribution of legitimate transactions.<br>âˆ— One-class classifiers are well-suited to deal with the reflexivity of fraud, since they do not explicitly model the existing pattern of fraud.</p></blockquote><h3 id="Steps-for-Anomaly-Detection"><a href="#Steps-for-Anomaly-Detection" class="headerlink" title="Steps for Anomaly Detection:"></a>Steps for Anomaly Detection:</h3><ol><li>drop out abnormal transactions: fraudulent transactions, errors, genuine but outliers</li><li>Let $S = (\mathbf{x_{1}},\mathbf{x_{2}},â€¦,\mathbf{x_{n}})$ be a training sequence of legitimate transactions.</li><li>estimate $f(\mathbf{x}|S,\gamma)$ where $\gamma$ is an estimation parameter.</li><li>A classification decision is made with a new observation $\mathbf{x_{new}}$ at:<br>$$<br>\hat(y) = I(f(\mathbf{x_{new}}|S,\gamma)&gt;\theta)<br>$$<br>where $\theta$ is a threshold in probability.<blockquote><p>2017Q3(e) Which of these will register a fraud alert, based on your result in part (d)?<br>ANS: T2 and T3 have density less than Î¸ = 0.05 and so will register a fraud alert.</p></blockquote></li></ol><p><em>The threshold $\theta$ is manually set based on the (sensible) strategy of controlling the fraction $\epsilon$ of legitimate cases to be classified as anomalous, based on training data.</em><br>â€”- This is constrained by how many false alert is generated/business resource can be input to followups.</p><blockquote><p>2017 Q3(d) Given a false alarm rate Îµ = 1/8, and based only on this data, what is the value of Î¸?<br>ANS:<br>Use formula $$<br>max \theta s.t. \sum^{n}_{i=1}I(f(x_i) &gt; \theta) \leq n(1 âˆ’ \epsilon)$$<br>where $$n(1 âˆ’ \epsilon) = 24 Ã— 7/8 = 21$$<br>Therefore, count lowest (24 âˆ’ 21) = 3 densities from the table gives $\theta$ = 0.05.</p></blockquote><p>i.e.<br>$$<br>min\theta s.t.  \sum_{i=1}^{n}I(f(\mathbf{x}_{i}|S,\gamma)&gt;\theta)=floor(n\epsilon)<br>$$</p><h3 id="Kernel-Density-Estimator"><a href="#Kernel-Density-Estimator" class="headerlink" title="Kernel Density Estimator"></a>Kernel Density Estimator</h3><p>Crude empirical density:<br>$$<br>\hat{F_{EMP}}= \frac{1}{n}\sum_{i=1}^{n}I(x_{i}\leqslant x)<br>$$</p><p>kernel density function:</p><blockquote><p>2017Q3(c) Describe Parzen density estimation.</p></blockquote><p>$$<br>\hat{f(x)} = \frac{1}{nh^m}\sum_{i=1}^{n} K(\frac{x-x_{i}}{h})<br>$$s.t.</p><ol><li>$K(z) = K(-z)$</li><li>$\int K(z) dz = 1$</li><li>$\mathbf{x_1}, \mathbf{x_2}, â€¦, \mathbf{x_n}$ is observations with dimension m</li><li>h is bandwidth constant</li></ol><h3 id="Available-data"><a href="#Available-data" class="headerlink" title="Available data"></a>Available data</h3><ul><li>Account Data</li><li>Transaction Data</li><li>Personal Data</li><li>Location data</li></ul><h2 id="Social-Network-Analysis"><a href="#Social-Network-Analysis" class="headerlink" title="Social Network Analysis"></a>Social Network Analysis</h2><p>Using weight $w_{ij}$ to estimate <strong>association feature/degree of connectedness to fraud people</strong> $F_{i}$ and hence have fraud propensity from it.</p><blockquote><p>2017Q3(f) Describe in words what Fi is measuring?<br>(f) Variable $F_{i}$ measures the degree of connectedness to other people committing fraud.</p></blockquote><h3 id="Formula"><a href="#Formula" class="headerlink" title="Formula:"></a>Formula:</h3><p>$$<br>F_{i} = \frac{1}{\sum_{i=1}^{n}w_{ij}} \sum_{j=1}^{n} w_{ij}p_{j}<br>$$</p><blockquote><p>2017Q3(g) What range of values can Fi take?<br>$0\leq F_i \leq 1$</p></blockquote><blockquote><p>2017Q3(h) Calculate the value of Fi for T4 (node 3)?<br>Use formula in the question to get (4 + 1)/(2 + 4 + 1 + 1) = 5/8 = 0.625.</p></blockquote><blockquote><p><strong>2017Q3(i) How are values of Fi broadly affecting the density?</strong><br>(i)<br>Low values of $F_i$ are inducing a small <strong>increase</strong> in density.<br>High values of $F_i$ are inducing a large <strong>decrease</strong> in density.<br><strong>Low density means default</strong></p></blockquote><h2 id="Model-Evaluation"><a href="#Model-Evaluation" class="headerlink" title="Model Evaluation"></a>Model Evaluation</h2><p>Special performance evaluation for this problem:</p><ol><li>proportion fraud detected</li><li>keep low false alarm rate, not to upset customer</li><li>cost monitoring automated fraud alert</li></ol><h3 id="Receiver-operating-characteristics-ROC"><a href="#Receiver-operating-characteristics-ROC" class="headerlink" title="Receiver-operating characteristics (ROC)"></a>Receiver-operating characteristics (ROC)</h3><p>Two CDF measures:<br>$$y = {0,1}  F_{y}(c)=P(S\leq c|Y=y)$$</p><ul><li>y=0: given a threshold c, probability of fraud transaction that identified as fraud)</li><li>y=1: given a threshold c, probability of false alert generated</li></ul><h3 id="Area-under-ROC-curve-AUC"><a href="#Area-under-ROC-curve-AUC" class="headerlink" title="Area under ROC curve(AUC)"></a>Area under ROC curve(AUC)</h3><p>$$<br>A = \int F_{1}(c)F_{0}â€™(c)dc<br>$$</p><h3 id="Precision-Recall-and-alarm-rate"><a href="#Precision-Recall-and-alarm-rate" class="headerlink" title="Precision, Recall and alarm rate"></a>Precision, Recall and alarm rate</h3><ul><li>$F(c) = P(S\leq c)$</li><li>$p_{0} = P(Y=0)$</li><li>Recall: $F_{0}(c)$, the proportion of fraud transactions that are detected</li><li>Precision: the proportion alerts that are actually fraud<br>$P(Y=0|S\leq c)=\frac{F_{0}(c)p_0}{F(c)}$</li><li>Alarm rate: $F(c)= p_0 \frac{recall}{precision}$, unconditional probability of alarm<br><strong>Monitoring cost increases linear with alarm rate</strong></li></ul><h3 id="Precision-recall-PR-curve"><a href="#Precision-recall-PR-curve" class="headerlink" title="Precision-recall (PR) curve"></a>Precision-recall (PR) curve</h3><p>properties:</p><ul><li>typical decreasing</li><li>best: 1,1</li><li>worst: $F(c)=F_0 (c)$, horizontal line with $precision =p_0$</li></ul>]]></content>
      
      
      <categories>
          
          <category> Notes </category>
          
          <category> Math Notes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ANN </tag>
            
            <tag> Credit modelling </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DS100&amp;More - Data Manipulation and Cleaning</title>
      <link href="/2019/04/06/DS100%20-%20Data%20Manipulation%20and%20Cleaning/"/>
      <url>/2019/04/06/DS100%20-%20Data%20Manipulation%20and%20Cleaning/</url>
      
        <content type="html"><![CDATA[<p>This is the first section for my study note: DS100&amp;More, which records some useful points in data ETL(Extract, Transform and Loaded), visualisation, and modelling. The motivation is to keep a record of my second learning of UC Berkeley DS100 course:  Principles and Techniques of Data Science. By learning relative knowledge, reader should be familiar with some python tools that are in use now, as well as making some inferences from data by hand.</p><p>Please contact me at <a href="mailto:zr116@ic.ac.uk" target="_blank" rel="noopener">zr116@ic.ac.uk</a> for any correction and improvement, general discussion on data science is also welcome.</p><h3 id="Todayâ€™s-Objectives"><a href="#Todayâ€™s-Objectives" class="headerlink" title="Todayâ€™s Objectives"></a>Todayâ€™s Objectives</h3><ol><li>EDA(Exploratory Data Analysis)</li><li>Use pyhton Pandas to do EDA</li></ol><h3 id="Tabular-Data"><a href="#Tabular-Data" class="headerlink" title="Tabular Data"></a>Tabular Data</h3><p><a href="https://www.textbook.ds100.org/ch/03/pandas_intro.html" target="_blank" rel="noopener">DS100 Textbook: Tabular Data</a></p><p>The first thing to do when we have a new data set in hand is to look at its inside. Data can be structured in different ways:<br>1.1 Comma-Separated Values (CSV)<br>[example]<br>1.2 Tab-Separated Values (TSV)<br>2.1 JavaScript Object Format (JSON)<br>[curly brackets]<br>3.1 eXtensible Markup Language (XML)<br>[how websites store info]<br>3.2 HyperText Markup Language (HTML)</p><blockquote><p>CSV and TSV data is structured in a tabular structure, in rows and columns.<br>JSON, XML, HTML data has a hierarchical structure, like a tree.<br>(see Hokodo intern note for JSON processing methods)</p></blockquote><p>Check file format:</p><ol><li>right click and view profile</li><li>fancier way:<br>use command-line interface (CLI) tools/terminal<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br></pre></td></tr></table></figure></li></ol><p>or if you are in Jupyter notebook:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!ls</span><br></pre></td></tr></table></figure></p><blockquote><p>!+command line in Jupyter</p></blockquote><p>Although all these data formats are often used, CSV is often the easiest and most frequently used structure.</p><p>Before reading data, need to figure out how much memory it is going to take.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">!ls -l -h folder</span><br><span class="line">!du -h folder</span><br><span class="line">#specific file usage</span><br><span class="line">!du -sh folder/*</span><br></pre></td></tr></table></figure><p>As a rule of thumb, reading in a file of x GB requires 4x GB memory. <code>Pandas</code> needs 2x but has to share memory with other programs.</p><blockquote><p><strong>Memory Overhead</strong><br>Note that memory is shared by all programs running on a computer, including the operating system, web browsers, and yes, Jupyter notebook itself. A computer with 4 GiB total RAM might have only 1 GiB available RAM with many applications running. With 1 GiB available RAM, it is unlikely that <code>pandas</code> will be able to read in a 1 GiB file.</p></blockquote><ul><li>To view CSV data in python:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line">data = pd.read_csv(&apos;&apos;)</span><br></pre></td></tr></table></figure><ul><li>How many rows and columns:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.shape</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>Check the size of data before inpecting it to avoid printing too many columns, which is not helpful to getting to konw the data.</p></blockquote><ul><li><p>Total size:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.size</span><br></pre></td></tr></table></figure></li><li><p>Inspecting important statistical values of numerical variables in a data set:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.describe()</span><br></pre></td></tr></table></figure></li></ul><p>This returns count, mean, standard deviation, min, max, and quartiles. <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.describe.html" target="_blank" rel="noopener">Details</a></p><ul><li><p>inspect first/last several rows(default 5)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data.head(5)#first 5</span><br><span class="line">data.tail(3)#last 3</span><br></pre></td></tr></table></figure></li><li><p>other common command</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#set &apos;col_name&apos; column as index column, in_place replace the old index column</span><br><span class="line">data.set_index(&apos;col_name&apos;, in_place = True)</span><br><span class="line"></span><br><span class="line">#list all column names</span><br><span class="line">data.columns</span><br><span class="line"></span><br><span class="line">#selection</span><br><span class="line">##select entries in column &apos;col1&apos;</span><br><span class="line">data[&apos;col1&apos;]</span><br><span class="line">##select two columns: col1, col2</span><br><span class="line">data[[&apos;col1&apos;,&apos;col2&apos;]]</span><br><span class="line">##make selected part into a DataFrame</span><br><span class="line">data[[&apos;col1&apos;,&apos;col2&apos;]].to_frame()</span><br><span class="line">##select rows that has val1 in col1</span><br><span class="line">data[data[&apos;col1&apos;]==val1]</span><br><span class="line"></span><br><span class="line">#column manipulation</span><br><span class="line">##count number of each value in a column</span><br><span class="line">data[&apos;col1&apos;].value_count()</span><br><span class="line">##print unique values in a column</span><br><span class="line">data[&apos;col1&apos;].unique()</span><br><span class="line">##statistical values of a column</span><br><span class="line">data[&apos;col1&apos;].min()</span><br><span class="line">data[&apos;col1&apos;].max()</span><br><span class="line">data[&apos;col1&apos;].median()</span><br><span class="line"></span><br><span class="line">#locator</span><br><span class="line">data.loc[row_list,col_list]</span><br><span class="line">data.iloc[[row_index],[column_index]]</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Study Notes </category>
          
          <category> DS Notes </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Data Science </tag>
            
            <tag> Python </tag>
            
            <tag> Pandas </tag>
            
            <tag> Data Cleaning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Parallel Computing with Fortran, OpenMP and MPI</title>
      <link href="/2018/10/27/Parallel%20computing%20with%20Fortran,%20OpenMP%20and%20MPI/"/>
      <url>/2018/10/27/Parallel%20computing%20with%20Fortran,%20OpenMP%20and%20MPI/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> CS projects </category>
          
          <category> M3C@imperial </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Computer science </tag>
            
            <tag> Parallel computing </tag>
            
            <tag> Fortran </tag>
            
            <tag> OpenMP </tag>
            
            <tag> MPI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stochastic Differential Equation simulations and uniform peacock problem</title>
      <link href="/2018/09/27/Stochastic%20Differential%20Equation%20simulations%20and%20uniform%20peacock%20problem/"/>
      <url>/2018/09/27/Stochastic%20Differential%20Equation%20simulations%20and%20uniform%20peacock%20problem/</url>
      
        <content type="html"><![CDATA[<p>In this report we will discuss stochastic differential equations and simulations of their roots. After that, a special SDE equation will be introduced and simulated using both Euler and Milstein method.</p><p>Find full report <a href="/files/UROP.pdf">here</a>.</p>]]></content>
      
      
      <categories>
          
          <category> Research projects </category>
          
          <category> UROP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Math </tag>
            
            <tag> Stochastic Differential Equations </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»æºç åˆ†æsentryçš„é”™è¯¯ä¿¡æ¯æ”¶é›†</title>
      <link href="/2018/08/18/%E4%BB%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90sentry%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
      <url>/2018/08/18/%E4%BB%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90sentry%E7%9A%84%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<p>raven.js æ˜¯ sentry ä¸º JavaScript é”™è¯¯ä¸ŠæŠ¥æä¾›çš„ JS-SDKï¼Œæœ¬ç¯‡æˆ‘ä»¬åŸºäºå…¶æºä»£ç å¯¹å…¶åŸç†è¿›è¡Œåˆ†æï¼Œæœ¬ç¯‡æ–‡ç« åªåˆ†æå‰ç«¯éƒ¨åˆ†ï¼Œå¯¹åº”çš„æ–‡ä»¶ç›®å½•æ˜¯<code>https://github.com/getsentry/sentry-javascript/tree/master/packages/raven-js</code>ã€‚</p><p>é¦–å…ˆæŠ›å‡ºå‡ ä¸ªé—®é¢˜ï¼š</p><ul><li><strong>raven.js æ˜¯å¦‚ä½•æ”¶é›†æµè§ˆå™¨é”™è¯¯ä¿¡æ¯çš„ï¼Ÿ</strong></li><li><strong>raven.js ä¸ŠæŠ¥çš„é”™è¯¯ä¿¡æ¯æ ¼å¼æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿåˆæ˜¯å¦‚ä½•æŠŠè¿™äº›ä¿¡æ¯ä¼ ç»™åç«¯ï¼Ÿæ”¯ä¸æ”¯æŒåˆå¹¶ä¸ŠæŠ¥ï¼Ÿ</strong></li><li><strong>é¢åŒ…å±‘ï¼ˆbreadcrumbsï¼‰æ˜¯ä»€ä¹ˆï¼Ÿraven.js å¦‚ä½•æ¥æ”¶é›†é¢åŒ…å±‘ä¿¡æ¯ï¼Ÿ</strong></li><li><strong>raven.js å¦‚ä½•å’Œæ¡†æ¶é…åˆä½¿ç”¨ï¼ˆæ¯”å¦‚ vueã€reactï¼‰ï¼Ÿ</strong></li></ul><p>åœ¨å›ç­”ä»¥ä¸Šè¿™å‡ ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥å¯¹ raven.js åšä¸€ä¸ªå®è§‚çš„åˆ†æï¼Œä¸»è¦æ¶‰åŠå…¶æ–‡ä»¶ç›®å½•ã€æ‰€å¼•ç”¨çš„ç¬¬ä¸‰æ–¹æ¡†æ¶ç­‰ã€‚</p><p>raven.js çš„æ ¸å¿ƒæ–‡ä»¶å†…å®¹å¹¶ä¸å¤šï¼Œå…¶ä¸­ä½¿ç”¨äº†ä¸‰ä¸ªç¬¬ä¸‰æ–¹åº“ï¼Œæ”¾åœ¨äº† vendor æ–‡ä»¶å¤¹ä¸‹ï¼š</p><ul><li><a href="https://github.com/moll/json-stringify-safe" target="_blank" rel="noopener">json-stringify-safe</a> ï¼šä¸€ä¸ªå¯¹ <code>JSON.stringify</code> çš„å°è£…ï¼Œå®‰å…¨çš„ json åºåˆ—åŒ–æ“ä½œå‡½æ•°ï¼Œä¸ä¼šæŠ›å‡ºå¾ªç¯å¼•ç”¨çš„é”™è¯¯ã€‚<ul><li>è¿™é‡Œé¢æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹è¦å•ç‹¬è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç†ŸçŸ¥çš„ <code>JSON.stringify</code> , å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¦åºåˆ—åŒ–çš„å¯¹è±¡ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯¹å…¶ä¸­é”®å€¼å¯¹çš„å¤„ç†å‡½æ•°ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ§åˆ¶ç¼©è¿›ç©ºæ ¼ã€‚reven.js çš„ <code>json-stringify-safe</code> å°±æ˜¯å……åˆ†åˆ©ç”¨äº†è¿™ä¸‰ä¸ªå‚æ•°ã€‚</li></ul></li><li><a href="https://github.com/blueimp/JavaScript-MD5" target="_blank" rel="noopener">md5</a>ï¼šjs çš„ md5 å‡½æ•°ã€‚</li><li><a href="https://github.com/csnover/TraceKit" target="_blank" rel="noopener">TraceKit</a>ï¼šTraceKit æ˜¯ä¸€ä¸ªå·²ç»æ¯”è¾ƒå®Œå–„çš„é”™è¯¯æ”¶é›†ã€å †æ ˆæ ¼å¼åŒ–çš„åº“ï¼Œreven.js çš„åŠŸèƒ½åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå¯¹å®ƒæœ‰æ‰€ä¾èµ–ã€‚</li></ul><p>é™¤æ­¤ä¹‹å¤–ï¼Œraven.js æ”¯æŒæ’ä»¶ï¼Œå®˜æ–¹æä¾›çš„ä¸€äº›çŸ¥ååº“çš„ sentry æ’ä»¶ä¸»è¦æ”¾åœ¨äº† plugin æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œraven.js çš„ä¸€äº›æ ¸å¿ƒæ–‡ä»¶ï¼Œåˆ™æ”¾åœ¨äº† src æ–‡ä»¶å¤¹ä¸‹é¢ã€‚</p><h3 id="raven-js-æ˜¯å¦‚ä½•æ”¶é›†é”™è¯¯ä¿¡æ¯çš„ï¼Ÿ"><a href="#raven-js-æ˜¯å¦‚ä½•æ”¶é›†é”™è¯¯ä¿¡æ¯çš„ï¼Ÿ" class="headerlink" title="raven.js æ˜¯å¦‚ä½•æ”¶é›†é”™è¯¯ä¿¡æ¯çš„ï¼Ÿ"></a>raven.js æ˜¯å¦‚ä½•æ”¶é›†é”™è¯¯ä¿¡æ¯çš„ï¼Ÿ</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨å‰ç«¯æ”¶é›†é”™è¯¯ï¼Œè‚¯å®šç¦»ä¸å¼€ <code>window.onerror</code> è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä»è¿™ä¸ªå‡½æ•°è¯´èµ·ã€‚</p><p>å®é™…ä¸Šï¼Œè¿™éƒ¨åˆ†å·¥ä½œæ˜¯ raven.js å¼•ç”¨çš„ç¬¬ä¸‰æ–¹åº“ TraceKit å®Œæˆçš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function installGlobalHandler() &#123;</span><br><span class="line">  if (_onErrorHandlerInstalled) &#123; // ä¸€ä¸ªèµ·åˆ°æ ‡å¿—ä½œç”¨çš„å…¨å±€å˜é‡</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  _oldOnerrorHandler = _window.onerror; </span><br><span class="line">  // _oldOnerrorHandler æ˜¯é˜²æ­¢å¯¹ç”¨æˆ·å…¶ä»–åœ°æ–¹å®šä¹‰çš„å›è°ƒå‡½æ•°è¿›è¡Œè¦†ç›–</span><br><span class="line">  // è¯¥ _window ç»è¿‡å…¼å®¹ï¼Œå®é™…ä¸Šå°±æ˜¯ window</span><br><span class="line">  _window.onerror = traceKitWindowOnError;</span><br><span class="line">  _onErrorHandlerInstalled = true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸å…³é”™è¯¯å›è°ƒå‡½æ•°äº¤ç»™ traceKitWindowOnError å¤„ç†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ traceKitWindowOnError å‡½æ•°ï¼Œä¸ºäº†é¿å…å¤ªå¤šå†—ä½™ä»£ç ï¼Œæˆ‘ä»¬ä»…åˆ†æä¸€ç§ä¸»è¦æƒ…å†µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function traceKitWindowOnError(msg, url, lineNo, colNo, ex) &#123;</span><br><span class="line"></span><br><span class="line">var exception = utils.isErrorEvent(ex) ? ex.error : ex;</span><br><span class="line">//...</span><br><span class="line">    stack = TraceKit.computeStackTrace(exception);</span><br><span class="line">    notifyHandlers(stack, true);</span><br><span class="line">    //...</span><br><span class="line">   </span><br><span class="line">    //...</span><br><span class="line">    if (_oldOnerrorHandler) &#123;</span><br><span class="line">       return _oldOnerrorHandler.apply(this, arguments);</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­è°ƒç”¨çš„æœ€é‡è¦çš„ä¸€ä¸ªå‡½æ•°ï¼Œå°±æ˜¯ computeStackTraceï¼Œè€Œè¿™ä¸ªå‡½æ•°ä¹Ÿæ˜¯ TraceKit çš„æ ¸å¿ƒå‡½æ•°ï¼Œç®€å•æ¥è®²ï¼Œå®ƒåšçš„äº‹æƒ…å°±æ˜¯ç»Ÿä¸€æ ¼å¼åŒ–æŠ¥é”™ä¿¡æ¯è°ƒç”¨æ ˆï¼Œå› ä¸ºå¯¹äºå„ä¸ªæµè§ˆå™¨æ¥è¯´ï¼Œè¿”å›çš„ Error è°ƒç”¨æ ˆä¿¡æ¯æ ¼å¼ä¸å°½ç›¸åŒï¼Œå¦å¤–ç”šè‡³è¿˜æœ‰çš„æµè§ˆå™¨å¹¶ä¸è¿”å›è°ƒç”¨æ ˆï¼ŒcomputeStackTrace å‡½æ•°å¯¹è¿™äº›æƒ…å†µéƒ½åšäº†å…¼å®¹æ€§å¤„ç†ï¼Œå¹¶ä¸”å¯¹äºä¸€äº›ä¸è¿”å›è°ƒç”¨æ ˆçš„æƒ…å†µï¼Œè¿˜ä½¿ç”¨äº† caller æ¥å‘ä¸Šå›æº¯å‡½æ•°çš„è°ƒç”¨æ ˆï¼Œæœ€ç»ˆæŠŠæŠ¥é”™ä¿¡æ¯è½¬åŒ–æˆä¸€ä¸ªé”®ç›¸åŒçš„å¯¹è±¡æ•°ç»„ï¼Œåšåˆ°äº†æŠ¥é”™ä¿¡æ¯æ ¼å¼çš„ç»Ÿä¸€ã€‚</p><p>notifyHandlers å‡½æ•°åˆ™æ˜¯é€šçŸ¥ç›¸å…³çš„å›è°ƒå‡½æ•°ã€‚ å®é™…ä¸Šï¼Œraven.js åœ¨ install å‡½æ•°ä¸­ä¼šè°ƒç”¨ TraceKit.report.subscribe å‡½æ•°ï¼Œå¹¶æŠŠå¯¹é”™è¯¯çš„å¤„ç†é€»è¾‘å†™å…¥å›è°ƒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function subscribe(handler) &#123;</span><br><span class="line">    installGlobalHandler();</span><br><span class="line">    handlers.push(handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šè¿‡ç¨‹å®Œæˆäº†é”™è¯¯å¤„ç†è¿‡ç¨‹ä¸­çš„è´Ÿè´£è§’è‰²è½¬æ¢ï¼Œå¹¶ä¸”å€ŸåŠ© TraceKitï¼Œå¯ä»¥ä½¿ raven.js å¾—åˆ°ä¸€ä¸ªç»“æ„æ¯”è¾ƒæ¸…æ™°çš„å¸¦æœ‰æ ¼å¼åŒ–å¥½çš„è°ƒç”¨æ ˆä¿¡æ¯çš„é”™è¯¯å†…å®¹å¯¹è±¡ï¼Œä¹‹åï¼Œraven.js å¯¹é”™è¯¯å†…å®¹è¿›ä¸€æ­¥å¤„ç†å¹¶æœ€ç»ˆä¸ŠæŠ¥ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å¯¹é”™è¯¯å¤„ç† raven.js æ§åˆ¶çš„éƒ¨åˆ†åšäº†ä¸€äº›æ¢³ç†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"> _handleOnErrorStackInfo: function(stackInfo, options) &#123;</span><br><span class="line">    options.mechanism = options.mechanism || &#123;</span><br><span class="line">      type: &apos;onerror&apos;,</span><br><span class="line">      handled: false</span><br><span class="line">    &#125;;</span><br><span class="line">    // mechanism å’Œé”™è¯¯ç»Ÿè®¡æ¥æºæœ‰å…³</span><br><span class="line"></span><br><span class="line">    if (!this._ignoreOnError) &#123;</span><br><span class="line">      this._handleStackInfo(stackInfo, options);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">_handleStackInfo: function(stackInfo, options) &#123;</span><br><span class="line">    var frames = this._prepareFrames(stackInfo, options);</span><br><span class="line"></span><br><span class="line">    this._triggerEvent(&apos;handle&apos;, &#123;</span><br><span class="line">      stackInfo: stackInfo,</span><br><span class="line">      options: options</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    this._processException(</span><br><span class="line">      stackInfo.name,</span><br><span class="line">      stackInfo.message,</span><br><span class="line">      stackInfo.url,</span><br><span class="line">      stackInfo.lineno,</span><br><span class="line">      frames,</span><br><span class="line">      options</span><br><span class="line">    );</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">_processException: function(type, message, fileurl, lineno, frames, options) &#123;</span><br><span class="line">    // é¦–å…ˆæ ¹æ® message ä¿¡æ¯åˆ¤æ–­æ˜¯å¦æ˜¯éœ€è¦å¿½ç•¥çš„é”™è¯¯ç±»å‹</span><br><span class="line">    // ç„¶ååˆ¤æ–­å‡ºé”™çš„æ–‡ä»¶æ˜¯å¦åœ¨é»‘åå•ä¸­æˆ–è€…ç™½åå•ä¸­</span><br><span class="line">    // æ¥ä¸‹æ¥å¯¹é”™è¯¯å†…å®¹è¿›è¡Œå¿…è¦çš„æ•´åˆä¸è½¬æ¢ï¼Œæ„é€ å‡º data å¯¹è±¡</span><br><span class="line">    // æœ€åè°ƒç”¨ä¸ŠæŠ¥å‡½æ•°</span><br><span class="line">    this._send(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_send: function(data) &#123;</span><br><span class="line"></span><br><span class="line">// å¯¹ data è¿›ä¸€æ­¥å¤„ç†ï¼Œå¢åŠ å¿…è¦çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åç»­ä¼šæåˆ°çš„é¢åŒ…å±‘ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">// äº¤ç”± _sendProcessedPayload è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†</span><br><span class="line">this._sendProcessedPayload(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_sendProcessedPayload: function(data, callback) &#123;</span><br><span class="line"></span><br><span class="line">// å¯¹ data å¢åŠ ä¸€äº›å¿…è¦çš„å…ƒä¿¡æ¯</span><br><span class="line">// å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ globalOptions.transport çš„æ–¹å¼æ¥è‡ªå®šä¹‰ä¸ŠæŠ¥å‡½æ•° </span><br><span class="line">(globalOptions.transport || this._makeRequest).call(this, &#123;</span><br><span class="line">     url: url,</span><br><span class="line">     auth: auth,</span><br><span class="line">     data: data,</span><br><span class="line">     options: globalOptions,</span><br><span class="line">     onSuccess: function success() &#123;</span><br><span class="line">       </span><br><span class="line">     &#125;,</span><br><span class="line">     onError: function failure(error) &#123;</span><br><span class="line">       </span><br><span class="line">     &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line">// çœŸæ­£å‘èµ·è¯·æ±‚çš„å‡½æ•°</span><br><span class="line">_makeRequest: function(opts) &#123;</span><br><span class="line">// å¯¹äºæ”¯æŒ fetch çš„æµè§ˆå™¨ï¼Œç›´æ¥ä½¿ç”¨ fetch çš„æ–¹å¼å‘é€ POST è¯·æ±‚</span><br><span class="line">// å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒ fetchï¼Œåˆ™ä½¿ç”¨ XHR çš„ä¼ ç»Ÿæ–¹å¼å‘é€ POST è¯·æ±‚</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">å®é™…ä¸Šæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä»æ‹¿åˆ°å·²ç»åˆæ­¥æ ¼å¼åŒ–çš„æŠ¥é”™ä¿¡æ¯ï¼Œåˆ°æœ€ç»ˆçœŸæ­£æ‰§è¡Œæ•°æ®ä¸ŠæŠ¥ï¼Œraven.js çš„è¿‡ç¨‹éå¸¸æ¼«é•¿ï¼Œè¿™å…¶ä¸­æˆ‘åˆ†ææœ‰å¦‚ä¸‹å‡ ä¸ªåŸå› ï¼š</span><br><span class="line"></span><br><span class="line">* æ¯ä¸ªå‡½æ•°åªå¤„ç†ä¸€ä»¶æˆ–è€…ä¸€äº›äº‹æƒ…ï¼Œä¿æŒå‡½æ•°çš„çŸ­å°æ•´æ´ã€‚</span><br><span class="line">* éƒ¨åˆ†å‡½æ•°å¯ä»¥åšåˆ°å¤ç”¨ï¼ˆå› ä¸ºé™¤äº†è‡ªåŠ¨æ•è·é”™è¯¯çš„æ–¹å¼ï¼Œ raven.js è¿˜æä¾›é€šè¿‡ captureExceptionï¼Œå³ `try &#123;</span><br><span class="line">    doSomething(a[0])</span><br><span class="line">&#125; catch(e) &#123;</span><br><span class="line">    Raven.captureException(e)</span><br><span class="line">&#125;` çš„æ–¹å¼æ¥ä¸ŠæŠ¥é”™è¯¯ï¼Œä¸¤ä¸ªè¿‡ç¨‹ä¸­æœ‰ä¸€äº›å‡½æ•°çš„è°ƒç”¨æ˜¯æœ‰é‡å çš„ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯ç¬”è€…è®¤ä¸ºï¼Œraven.js çš„ä»£ç è®¾è®¡è¿˜æœ‰å¾ˆå¤šå€¼å¾—ä¼˜åŒ–çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼š</span><br><span class="line"></span><br><span class="line">* å¯¹æœ€ç»ˆä¸ŠæŠ¥æ•°æ®ï¼ˆdataï¼‰çš„å±æ€§å¤„ç†å’Œå¢åŠ åˆ†æ•£åœ¨å¤šä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æœ‰è¾ƒå¤šå¯é€‰é¡¹ç›®ï¼Œå¾ˆéš¾æ¢³ç†å‡ºä¸€ä¸ªå®Œæ•´çš„ data æ ¼å¼ï¼Œå¹¶ä¸”ä¸ä¾¿äºç»´æŠ¤ã€‚</span><br><span class="line">* éƒ¨åˆ†å‡½æ•°çš„æ‹†åˆ†å¿…è¦æ€§ä¸è¶³ï¼Œå¹¶ä¸”ä¼šå¢åŠ é“¾è·¯çš„å¤æ‚æ€§ï¼Œæ¯”å¦‚ `_processException `ã€`_sendProcessedPayload `ã€`_makeRequest `ç­‰éƒ½åªåœ¨ä¸€ä¸ªé“¾è·¯ä¸­è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</span><br><span class="line">* éƒ¨åˆ†å±æ€§é‡å‘½åä¼šé€ æˆèµ„æºæµªè´¹ï¼Œç”±äº TraceKit éƒ¨åˆ†æœ€ç»ˆè¿”å›çš„æ•°æ®æ ¼å¼å¹¶ä¸å®Œå…¨æ»¡è¶³ raven.js çš„éœ€è¦ï¼Œæ‰€ä»¥ raven.js ä¹‹ååˆåœ¨è¾ƒåé˜¶æ®µè¿›è¡Œäº†é‡å‘½åç­‰å¤„ç†ï¼Œå®é™…ä¸Šè¿™äº›å†…å®¹å®Œå…¨å¯ä»¥é€šè¿‡ä¸€äº›å…¶ä»–çš„æ–¹å¼é¿å…ã€‚</span><br><span class="line"></span><br><span class="line">æœ€åï¼Œéå¸¸é—æ†¾ï¼Œsentry ç›®å‰å®Œå…¨ä¸æ”¯æŒåˆå¹¶ä¸ŠæŠ¥ï¼Œå°±ç®—æ˜¯åœ¨åŒä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼ˆç”šè‡³äº‹ä»¶å¾ªç¯çš„åŒä¸€ä¸ªé˜¶æ®µï¼Œå…³äºäº‹ä»¶å¾ªç¯ï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰ç»˜åˆ¶çš„[ä¸€å¼ å›¾](https://www.processon.com/view/link/5b6ec8cbe4b053a09c2fb977)ï¼‰çš„ä¸¤ä¸ªé”™è¯¯ï¼Œsentry éƒ½æ˜¯åˆ†å¼€æ¥ä¸ŠæŠ¥çš„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç®€å•ä¾‹å­ï¼š</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">Raven.config(&apos;http://8ec3f1a9f652463bb58191bd0b35f20c@localhost:9000/2&apos;).install()</span><br><span class="line">let s = window.ss;</span><br><span class="line"></span><br><span class="line">try&#123;</span><br><span class="line">    let b = s.b</span><br><span class="line">&#125; catch (e) &#123;</span><br><span class="line">    Raven.captureException(e)</span><br><span class="line">    // sentry should report error now</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">s.nomethod();</span><br><span class="line">// sentry should report error now</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¾‹å­ä¸­ï¼Œsentry ä¼šå‘é€ä¸¤ä¸ª POST è¯·æ±‚ã€‚</p><h3 id="raven-js-æœ€ç»ˆä¸ŠæŠ¥æ•°æ®çš„æ ¼å¼"><a href="#raven-js-æœ€ç»ˆä¸ŠæŠ¥æ•°æ®çš„æ ¼å¼" class="headerlink" title="raven.js æœ€ç»ˆä¸ŠæŠ¥æ•°æ®çš„æ ¼å¼"></a>raven.js æœ€ç»ˆä¸ŠæŠ¥æ•°æ®çš„æ ¼å¼</h3><p>è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šè¯¦ç»†åœ°åˆ†æ raven.js ä¸ŠæŠ¥çš„æ•°æ®çš„æ¯ä¸€é¡¹å†…å®¹ï¼Œä»…ä¼šç»™è¯»è€…å±•ç¤ºä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„æƒ…å†µã€‚</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹å¯¹äºä¸€ä¸ªä¸€èˆ¬çš„ js é”™è¯¯ï¼Œraven.js ä¸ŠæŠ¥çš„ json ä¸­åŒ…å«å“ªäº›å†…å®¹ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªå·²ç»åˆ æ‰ä¸€äº›å†—ä½™å†…å®¹çš„å…¸å‹ä¸ŠæŠ¥ä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;project&quot;: &quot;2&quot;,</span><br><span class="line">  &quot;logger&quot;: &quot;javascript&quot;,</span><br><span class="line">  &quot;platform&quot;: &quot;javascript&quot;,</span><br><span class="line">  &quot;request&quot;: &#123;</span><br><span class="line">    &quot;headers&quot;: &#123;</span><br><span class="line">      &quot;User-Agent&quot;: &quot;Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;url&quot;: &quot;http://localhost:63342/sentry-test1/test1.html?_ijt=j54dmgn136gom08n8v8v9fdddu&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;exception&quot;: &#123;</span><br><span class="line">    &quot;values&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;TypeError&quot;,</span><br><span class="line">        &quot;value&quot;: &quot;Cannot read property &apos;b&apos; of undefined&quot;,</span><br><span class="line">        &quot;stacktrace&quot;: &#123;</span><br><span class="line">          &quot;frames&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">              &quot;filename&quot;: &quot;http://localhost:63342/sentry-test1/test1.html?_ijt=j54dmgn136gom08n8v8v9fdddu&quot;,</span><br><span class="line">              &quot;lineno&quot;: 19,</span><br><span class="line">              &quot;colno&quot;: 19,</span><br><span class="line">              &quot;function&quot;: &quot;?&quot;,</span><br><span class="line">              &quot;in_app&quot;: true</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;mechanism&quot;: &#123;</span><br><span class="line">      &quot;type&quot;: &quot;generic&quot;,</span><br><span class="line">      &quot;handled&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;transaction&quot;: &quot;http://localhost:63342/sentry-test1/test1.html?_ijt=j54dmgn136gom08n8v8v9fdddu&quot;,</span><br><span class="line">  &quot;extra&quot;: &#123;</span><br><span class="line">    &quot;session:duration&quot;: 6</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;breadcrumbs&quot;: &#123;</span><br><span class="line">    &quot;values&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;timestamp&quot;: 1534257309.996,</span><br><span class="line">        &quot;message&quot;: &quot;_prepareFrames stackInfo: [object Object]&quot;,</span><br><span class="line">        &quot;level&quot;: &quot;log&quot;,</span><br><span class="line">        &quot;category&quot;: &quot;console&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      // ...</span><br><span class="line">   ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;event_id&quot;: &quot;ea0334adaf9d43b78e72da2b10e084a9&quot;,</span><br><span class="line">  &quot;trimHeadFrames&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æ”¯æŒçš„ä¿¡æ¯ç±»å‹é‡ç‚¹åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>sentry åŸºæœ¬é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬åº“æœ¬èº«çš„é…ç½®å’Œä½¿ç”¨è€…çš„é…ç½®ä¿¡æ¯ï¼Œä»¥åŠç”¨æˆ·çš„ä¸€äº›è‡ªå®šä¹‰ä¿¡æ¯</li><li>é”™è¯¯ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬é”™è¯¯è°ƒç”¨æ ˆä¿¡æ¯</li><li>request ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬æµè§ˆå™¨çš„ User-Agentã€å½“å‰è¯·æ±‚åœ°å€ç­‰</li><li>é¢åŒ…å±‘ä¿¡æ¯ï¼Œå…³äºé¢åŒ…å±‘å…·ä½“æŒ‡çš„æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€ç¯èŠ‚è¿›è¡Œä»‹ç»</li></ul><h3 id="raven-js-é¢åŒ…å±‘æ”¶é›†"><a href="#raven-js-é¢åŒ…å±‘æ”¶é›†" class="headerlink" title="raven.js é¢åŒ…å±‘æ”¶é›†"></a>raven.js é¢åŒ…å±‘æ”¶é›†</h3><p>é¢åŒ…å±‘ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯é”™è¯¯åœ¨å‘ç”Ÿä¹‹å‰ï¼Œä¸€äº›ç”¨æˆ·ã€æµè§ˆå™¨çš„è¡Œä¸ºä¿¡æ¯ï¼Œraven.js å®ç°äº†ä¸€ä¸ªç®€å•çš„é˜Ÿåˆ—ï¼ˆæœ‰ä¸€ä¸ªæœ€å¤§æ¡ç›®é•¿åº¦ï¼Œé»˜è®¤ä¸º 100ï¼‰ï¼Œè¿™ä¸ªé˜Ÿåˆ—åœ¨æ—¶åˆ»è®°å½•ç€è¿™äº›ä¿¡æ¯ï¼Œä¸€æ—¦é”™è¯¯å‘ç”Ÿå¹¶ä¸”éœ€è¦ä¸ŠæŠ¥ï¼Œraven.js å°±æŠŠè¿™ä¸ªé˜Ÿåˆ—çš„ä¿¡æ¯å†…å®¹ï¼Œä½œä¸ºé¢åŒ…å±‘ breadcrumbsï¼Œå‘å›å®¢æˆ·ç«¯ã€‚</p><p>é¢åŒ…å±‘ä¿¡æ¯ä¸»è¦åŒ…æ‹¬è¿™å‡ ç±»ï¼š</p><ul><li>ç”¨æˆ·å¯¹æŸä¸ªå…ƒç´ çš„ç‚¹å‡»æˆ–è€…ç”¨æˆ·å¯¹æŸä¸ªå¯è¾“å…¥å…ƒç´ çš„è¾“å…¥</li><li>å‘é€çš„ http è¯·æ±‚</li><li>console æ‰“å°çš„ä¿¡æ¯ï¼ˆæ”¯æŒé…ç½® â€˜debugâ€™, â€˜infoâ€™, â€˜warnâ€™, â€˜errorâ€™, â€˜logâ€™ ç­‰ä¸åŒçº§åˆ«ï¼‰</li><li>window.location å˜åŒ–ä¿¡æ¯</li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯¹è¿™å‡ ç±»é¢åŒ…å±‘ä¿¡æ¯ sentry çš„è®°å½•å®ç°è¿›è¡Œç®€å•çš„åˆ†æã€‚</p><p>å®é™…ä¸Šï¼Œsentry å¯¹è¿™äº›ä¿¡æ¯è®°å½•çš„æ–¹å¼æ¯”è¾ƒä¸€è‡´ï¼Œéƒ½æ˜¯é€šè¿‡å¯¹åŸå£°çš„å‡½æ•°è¿›è¡ŒåŒ…è£…ï¼Œå¹¶ä¸”åœ¨åŒ…è£…å¥½çš„å‡½æ•°ä¸­å¢åŠ è‡ªå·±çš„é’©å­å‡½æ•°ï¼Œæ¥å®ç°è§¦å‘æ—¶å€™çš„äº‹ä»¶è®°å½•ï¼Œå®é™…ä¸Šï¼Œsentry æ€»å…±åŒ…è£…çš„å‡½æ•°æœ‰ï¼š</p><ul><li>window.setTimeout</li><li>window.setInterval</li><li>window.requestAnimationFrame</li><li>EventTarget.addEventListener</li><li>EventTarget.removeEventListener</li><li>XMLHTTPRequest.open</li><li>XMLHTTPRequest.send</li><li>window.fetch</li><li>History.pushState</li><li>History.replaceState</li></ul><blockquote><p>å¤‡æ³¨ï¼šè¿™é‡ŒåŒ…è£…çš„æ‰€æœ‰å‡½æ•°ï¼Œå…¶ä¸­æœ‰ä¸€éƒ¨åˆ†åªæ˜¯ä½¿ raven.js å…·æœ‰æ•è·å›è°ƒå‡½æ•°ä¸­é”™è¯¯çš„èƒ½åŠ›ï¼ˆå¯¹å›è°ƒå‡½æ•°è¿›è¡ŒåŒ…è£…ï¼‰</p></blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€æ®µå…¸å‹çš„ä»£ç ï¼Œæ¥åˆ†æ raven.js æ˜¯å¦‚ä½•è®°å½•ç”¨æˆ·çš„ç‚¹å‡»å’Œè¾“å…¥ä¿¡æ¯çš„ï¼ˆé€šè¿‡å¯¹ EventTarget.addEventListener è¿›è¡Œå°è£…ï¼‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wrapEventTarget</span>(<span class="params">global</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> proto = _window[global] &amp;&amp; _window[global].prototype;</span><br><span class="line">      <span class="keyword">if</span> (proto &amp;&amp; proto.hasOwnProperty &amp;&amp; proto.hasOwnProperty(<span class="string">'addEventListener'</span>)) &#123;</span><br><span class="line">        fill(</span><br><span class="line">          proto,</span><br><span class="line">          <span class="string">'addEventListener'</span>,</span><br><span class="line">          <span class="function"><span class="keyword">function</span>(<span class="params">orig</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">evtName, fn, capture, secure</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (fn &amp;&amp; fn.handleEvent) &#123; <span class="comment">//å…¼å®¹é€šè¿‡ handleEvent çš„æ–¹å¼è¿›è¡Œç»‘å®šäº‹ä»¶</span></span><br><span class="line">                  fn.handleEvent = self.wrap(</span><br><span class="line">                    &#123;</span><br><span class="line">                      mechanism: &#123;</span><br><span class="line">                        type: <span class="string">'instrument'</span>,</span><br><span class="line">                        data: &#123;</span><br><span class="line">                          target: global,</span><br><span class="line">                          <span class="function"><span class="keyword">function</span>: '<span class="title">handleEvent</span>',</span></span><br><span class="line"><span class="function">                          <span class="title">handler</span>: (<span class="params">fn &amp;&amp; fn.name</span>) || '&lt;<span class="title">anonymous</span>&gt;'</span></span><br><span class="line"><span class="function">                        &#125;</span></span><br><span class="line"><span class="function">                      &#125;</span></span><br><span class="line"><span class="function">                    &#125;,</span></span><br><span class="line"><span class="function">                    <span class="title">fn</span>.<span class="title">handleEvent</span></span></span><br><span class="line"><span class="function">                  );</span></span><br><span class="line"><span class="function">                &#125;</span></span><br><span class="line"><span class="function">              &#125; <span class="title">catch</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">var</span> before, clickHandler, keypressHandler;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">if</span> (</span><br><span class="line">                autoBreadcrumbs &amp;&amp;</span><br><span class="line">                autoBreadcrumbs.dom &amp;&amp;</span><br><span class="line">                (global === <span class="string">'EventTarget'</span> || global === <span class="string">'Node'</span>)</span><br><span class="line">              ) &#123;</span><br><span class="line">                <span class="comment">// <span class="doctag">NOTE:</span> generating multiple handlers per addEventListener invocation, should</span></span><br><span class="line">                <span class="comment">//       revisit and verify we can just use one (almost certainly)</span></span><br><span class="line">                clickHandler = self._breadcrumbEventHandler(<span class="string">'click'</span>);</span><br><span class="line">                keypressHandler = self._keypressEventHandler();</span><br><span class="line">                before = <span class="function"><span class="keyword">function</span>(<span class="params">evt</span>) </span>&#123; <span class="comment">// é’©å­å‡½æ•°ï¼Œç”¨äºåœ¨å›è°ƒå‡½æ•°è°ƒç”¨çš„æ—¶å€™è®°å½•ä¿¡æ¯</span></span><br><span class="line">                  <span class="keyword">if</span> (!evt) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">var</span> eventType;</span><br><span class="line">                  <span class="keyword">try</span> &#123;</span><br><span class="line">                    eventType = evt.type;</span><br><span class="line">                  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                    <span class="comment">// just accessing event properties can throw an exception in some rare circumstances</span></span><br><span class="line">                    <span class="comment">// see: https://github.com/getsentry/raven-js/issues/838</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">if</span> (eventType === <span class="string">'click'</span>) <span class="keyword">return</span> clickHandler(evt);</span><br><span class="line">                  <span class="keyword">else</span> <span class="keyword">if</span> (eventType === <span class="string">'keypress'</span>) <span class="keyword">return</span> keypressHandler(evt);</span><br><span class="line">                &#125;;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> orig.call(</span><br><span class="line">                <span class="keyword">this</span>,</span><br><span class="line">                evtName,</span><br><span class="line">                self.wrap(</span><br><span class="line">                  &#123;</span><br><span class="line">                    mechanism: &#123;</span><br><span class="line">                      type: <span class="string">'instrument'</span>,</span><br><span class="line">                      data: &#123;</span><br><span class="line">                        target: global,</span><br><span class="line">                        <span class="function"><span class="keyword">function</span>: '<span class="title">addEventListener</span>',</span></span><br><span class="line"><span class="function">                        <span class="title">handler</span>: (<span class="params">fn &amp;&amp; fn.name</span>) || '&lt;<span class="title">anonymous</span>&gt;'</span></span><br><span class="line"><span class="function">                      &#125;</span></span><br><span class="line"><span class="function">                    &#125;</span></span><br><span class="line"><span class="function">                  &#125;,</span></span><br><span class="line"><span class="function">                  <span class="title">fn</span>,</span></span><br><span class="line"><span class="function">                  <span class="title">before</span></span></span><br><span class="line"><span class="function">                ),</span></span><br><span class="line"><span class="function">                <span class="title">capture</span>,</span></span><br><span class="line"><span class="function">                <span class="title">secure</span></span></span><br><span class="line"><span class="function">              );</span></span><br><span class="line"><span class="function">            &#125;;</span></span><br><span class="line"><span class="function">          &#125;,</span></span><br><span class="line"><span class="function">          <span class="title">wrappedBuiltIns</span></span></span><br><span class="line"><span class="function">        );</span></span><br><span class="line"><span class="function">        <span class="title">fill</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">          proto,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="string">'removeEventListener'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">          function(orig</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">evt, fn, capture, secure</span>) </span>&#123;</span><br><span class="line">              <span class="keyword">try</span> &#123;</span><br><span class="line">                fn = fn &amp;&amp; (fn.__raven_wrapper__ ? fn.__raven_wrapper__ : fn);</span><br><span class="line">              &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="comment">// ignore, accessing __raven_wrapper__ will throw in some Selenium environments</span></span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> orig.call(<span class="keyword">this</span>, evt, fn, capture, secure);</span><br><span class="line">            &#125;;</span><br><span class="line">          &#125;,</span><br><span class="line">          wrappedBuiltIns</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç å…¼å®¹äº†é€šè¿‡ handleEvent çš„æ–¹å¼è¿›è¡Œç»‘å®šäº‹ä»¶ï¼ˆå¦‚æœæ²¡æœ‰å¬è¯´è¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨<a href="http://www.ayqy.net/blog/handleevent%E4%B8%8Eaddeventlistener/" target="_blank" rel="noopener">è¿™é‡Œ</a>è¡¥å……ä¸€äº›ç›¸å…³çš„çŸ¥è¯†ï¼‰ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œraven.js åªè®°å½•é€šè¿‡ <code>EventTarget.addEventListener</code> ç»‘å®šçš„ç‚¹å‡»å’Œè¾“å…¥ä¿¡æ¯ï¼Œå®é™…ä¸Šè¿™æ˜¯æ¯”è¾ƒç§‘å­¦çš„ï¼Œå¹¶ä¸”è¿™äº›ä¿¡æ¯è¾ƒä¸ºæœ‰æ•ˆã€‚å¦å¤–ï¼Œraven.js ä¹Ÿæä¾›äº†è®°å½•æ‰€æœ‰ç‚¹å‡»å’Œè¾“å…¥ä¿¡æ¯çš„å¯é€‰é¡¹ï¼Œå…¶å®ç°æ–¹å¼æ›´ä¸ºç®€å•ï¼Œç›´æ¥åœ¨ document ä¸Šæ·»åŠ ç›¸å…³çš„ç›‘å¬å³å¯ã€‚</p><h3 id="raven-js-å¦‚ä½•å’Œæ¡†æ¶é…åˆä½¿ç”¨"><a href="#raven-js-å¦‚ä½•å’Œæ¡†æ¶é…åˆä½¿ç”¨" class="headerlink" title="raven.js å¦‚ä½•å’Œæ¡†æ¶é…åˆä½¿ç”¨"></a>raven.js å¦‚ä½•å’Œæ¡†æ¶é…åˆä½¿ç”¨</h3><p>raven.js å’Œæ¡†æ¶é…åˆä½¿ç”¨çš„æ–¹å¼éå¸¸ç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬è¦çŸ¥é“ï¼Œå¾ˆå¤šæ¡†æ¶å†…ç½®äº†é”™è¯¯è¾¹ç•Œå¤„ç†ï¼Œæˆ–è€…å¯¹é”™è¯¯è¿›è¡Œè½¬ä¹‰ã€‚ä»¥è‡³äºæˆ‘ä»¬é€šè¿‡ window.onerror çš„æ–¹å¼å¾—ä¸åˆ°å®Œæ•´çš„é”™è¯¯ä¿¡æ¯ã€‚åŒæ—¶ï¼Œæœ‰äº›æ¡†æ¶æä¾›äº†é”™è¯¯å¤„ç†çš„æ¥å£ï¼ˆæ¯”å¦‚ vueï¼‰ï¼Œåˆ©ç”¨é”™è¯¯å¤„ç†çš„æ¥å£ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè·å–åˆ°å’Œé”™è¯¯æœ‰å…³çš„æ›´å¤šæ›´é‡è¦çš„ä¿¡æ¯ã€‚</p><p>raven.js åˆ©ç”¨å„ä¸ªæ¡†æ¶çš„å®˜æ–¹æ¥å£ï¼Œæä¾›äº† vueã€require.jsã€angularã€emberã€react-native ç­‰å„ä¸ªæ¡†æ¶çš„å®˜æ–¹æ’ä»¶ã€‚</p><p>æ’ä»¶å†…å®¹æœ¬èº«éå¸¸ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ vue æ’ä»¶çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">function formatComponentName(vm) &#123;</span><br><span class="line">  if (vm.$root === vm) &#123;</span><br><span class="line">    return &apos;root instance&apos;;</span><br><span class="line">  &#125;</span><br><span class="line">  var name = vm._isVue ? vm.$options.name || vm.$options._componentTag : vm.name;</span><br><span class="line">  return (</span><br><span class="line">    (name ? &apos;component &lt;&apos; + name + &apos;&gt;&apos; : &apos;anonymous component&apos;) +</span><br><span class="line">    (vm._isVue &amp;&amp; vm.$options.__file ? &apos; at &apos; + vm.$options.__file : &apos;&apos;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function vuePlugin(Raven, Vue) &#123;</span><br><span class="line">  Vue = Vue || window.Vue;</span><br><span class="line"></span><br><span class="line">  // quit if Vue isn&apos;t on the page</span><br><span class="line">  if (!Vue || !Vue.config) return;</span><br><span class="line"></span><br><span class="line">  var _oldOnError = Vue.config.errorHandler;</span><br><span class="line">  Vue.config.errorHandler = function VueErrorHandler(error, vm, info) &#123;</span><br><span class="line">    var metaData = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    // vm and lifecycleHook are not always available</span><br><span class="line">    if (Object.prototype.toString.call(vm) === &apos;[object Object]&apos;) &#123;</span><br><span class="line">      metaData.componentName = formatComponentName(vm);</span><br><span class="line">      metaData.propsData = vm.$options.propsData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (typeof info !== &apos;undefined&apos;) &#123;</span><br><span class="line">      metaData.lifecycleHook = info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Raven.captureException(error, &#123;</span><br><span class="line">      extra: metaData</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    if (typeof _oldOnError === &apos;function&apos;) &#123;</span><br><span class="line">      _oldOnError.call(this, error, vm, info);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = vuePlugin;</span><br></pre></td></tr></table></figure><p>åº”è¯¥ä¸ç”¨è¿›è¡Œè¿‡å¤šè§£é‡Šã€‚</p><p>ä½ ä¹Ÿè®¸æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰æä¾› react æ’ä»¶ï¼Œäº‹å®ä¸Šï¼Œreact 16 ä»¥åæ‰å¼•å…¥äº†<a href="https://reactjs.org/blog/2017/07/26/error-handling-in-react-16.html" target="_blank" rel="noopener">Error Boundaries</a>ï¼Œè¿™ç§æ–¹å¼ç”±äºçµæ´»æ€§å¤ªå¼ºï¼Œå¹¶ä¸å¤ªé€‚åˆä½¿ç”¨æ’ä»¶ï¼Œå¦å¤–ï¼Œå°±ç®—ä¸ä½¿ç”¨æ’ä»¶ï¼Œä¹Ÿéå¸¸æ–¹ä¾¿åœ°ä½¿ç”¨ raven.js è¿›è¡Œé”™è¯¯ä¸ŠæŠ¥ï¼Œå¯ä»¥å‚è€ƒ<a href="https://docs.sentry.io/clients/javascript/integrations/react/" target="_blank" rel="noopener">è¿™é‡Œ</a></p><blockquote><p>ä½†ç¬”è€…è®¤ä¸ºï¼Œç›®å‰ react çš„å¼•å…¥æ–¹å¼ä¼šå¯¹æºä»£ç è¿›è¡Œä¾µå…¥ï¼Œå¹¶ä¸”æ¯”è¾ƒéš¾é€šè¿‡æ„å»ºçš„æ–¹å¼è¿›è¡Œ sentry çš„é…ç½®ï¼Œä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥å¯»æ‰¾æ›´å¥½çš„æ–¹å¼ã€‚</p></blockquote><p>å®Œã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> å‰ç«¯ç›‘æ§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lagrangian Mechanics and Rigid Body Motion</title>
      <link href="/2018/06/20/Lagrangian%20Mechanics%20and%20Heavy-top%20Motion/"/>
      <url>/2018/06/20/Lagrangian%20Mechanics%20and%20Heavy-top%20Motion/</url>
      
        <content type="html"><![CDATA[<p>This is a group research project I did in my second year at Imperial College London as a math undergraduate student. I cooperated with the team in explaining and proving basic Lagrangian Mechanics and the investigation into the heavy-top problems.</p><p>Here is an abstract of what this project is about. The full report reveals more about the proof, examples and Matlab code.</p><blockquote><p>In our report we will discuss Lagrangian Mechanics and the Motion of Rigid Bodies. La- grangian Mechanics is a reformulation of Classical Mechanics, first introduced by the famous mathematician Joseph-Louis Lagrange, in 1788. We shall discuss the uses of Lagrangian Me- chanics and include two examples - the Spherical Pendulum and the Double Pendulum. In each case we will derive the equations of motion, and then try to solve these numerically and/or analytically. We will investigate the effect of removing the gravitational field (in the case of the Spherical Pendulum) and discuss any links between the two, as well as any implications of the solutions. <br><br>A rigid body is a collection of N points such that the distance between any two of them is fixed regardless of any external forces they are subject to. We shall look at the kinematics, the Inertia Tensor and Eulerâ€™s Equation and use this to explain about the dynamical stability of rigid bodies. Symmetric tops are the main example that we will investigate and discuss. We will look into the precession rate and the spinning rate and discuss two examples, Feynmanâ€™s wobbling plate and the hula hoop. A more complicated rigid body we shall then explore is the heavy symmetric top, in which we take into account the forces exerted by a gravitational field.</p></blockquote><p>Full report is <a href="/files/M2R.pdf">here</a>.</p>]]></content>
      
      
      <categories>
          
          <category> Research projects </category>
          
          <category> M2R </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Math </tag>
            
            <tag> Mechanics </tag>
            
            <tag> Matlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ç¯‡å…³äºreactå†å²çš„æµæ°´è´¦</title>
      <link href="/2018/06/09/%E4%B8%80%E7%AF%87%E5%85%B3%E4%BA%8Ereact%E5%8E%86%E5%8F%B2%E7%9A%84%E6%B5%81%E6%B0%B4%E8%B4%A6/"/>
      <url>/2018/06/09/%E4%B8%80%E7%AF%87%E5%85%B3%E4%BA%8Ereact%E5%8E%86%E5%8F%B2%E7%9A%84%E6%B5%81%E6%B0%B4%E8%B4%A6/</url>
      
        <content type="html"><![CDATA[<p>react ç›®å‰å·²ç»æ›´æ–°åˆ° V16.3ï¼Œå…¶ä¸€è·¯èµ°æ¥ï¼Œæ—¥è‡»å®Œå–„ï¼Œç¬”è€…æ¥è§¦ react ä¸¤å¹´æœ‰ä½™ï¼Œåœ¨è¿™é‡Œåšä¸€ä¸ªé˜¶æ®µæ€§çš„æ•´ç†ï¼Œä¹Ÿå¯¹ react çš„å‘å±•å’Œæˆ‘å¯¹ react çš„å­¦ä¹ åšä¸€ä¸ªæ•´ä½“è®°å½•ã€‚</p><p>ç¬”è€…æ˜¯åœ¨ 16 å¹´åˆå¼€å§‹å…³æ³¨ reactï¼Œè€Œå®é™…ä¸Šé‚£ä¸ªæ—¶å€™ react å·²ç»å‘å¸ƒå¿«ä¸‰å¹´äº†ï¼Œ 16 å¹´åˆçš„æˆ‘å†™é¡µé¢è¿˜æ˜¯ä¸»è¦ä½¿ç”¨ backbone.jsã€Jqueryï¼Œå¹¶ä¸”è®¤ä¸ºï¼Œç›¸æ¯”äºçº¯ç²¹ä½¿ç”¨ Jquery çš„â€œåˆ€è€•ç«ç§â€çš„æ—¶ä»£ï¼Œä½¿ç”¨ backbone.js å·²ç»è¶³å¤Ÿæ–¹ä¾¿å¹¶ä¸”ä¸éœ€è¦æ›¿ä»£å“äº†ã€‚</p><p>è¿™ç¯‡æ–‡ç« ä¼šä» react å¼€æºä¹‹åˆè¿›è¡Œè®²èµ·ï¼Œç›´åˆ° 2018 å¹´å…­æœˆã€‚</p><h3 id="ä¸ºä»€ä¹ˆæ˜¯-react"><a href="#ä¸ºä»€ä¹ˆæ˜¯-react" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯ react"></a>ä¸ºä»€ä¹ˆæ˜¯ react</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œreact å¹¶ä¸æ˜¯ä¸€ä¸ª MVC æ¡†æ¶ï¼Œä¹Ÿå¹¶æ²¡æœ‰ä½¿ç”¨ä¼ ç»Ÿçš„å‰ç«¯æ¨¡ç‰ˆï¼Œè€Œæ˜¯é‡‡ç”¨äº†çº¯ JS ç¼–å†™ï¼ˆå®é™…ä¸Šç”¨åˆ°äº† JSX ï¼‰ï¼Œä½¿ç”¨äº†è™šæ‹Ÿ DOMï¼Œä½¿ç”¨ diff æ¥ä¿è¯ DOM çš„æ›´æ–°æ•ˆç‡ï¼Œå¹¶ä¸”å¯ä»¥ç»“åˆ facebook çš„ Flux æ¶æ„ï¼Œè§£å†³ä¼ ç»Ÿ MVC æ¨¡å¼çš„ä¸€äº›ç—›ç‚¹ã€‚</p><p>åœ¨ react å¼€æºä¹‹åˆï¼Œç›¸å…³ç”Ÿæ€ä½“ç³»å¹¶ä¸å®Œå–„ï¼Œç”šè‡³å®˜æ–¹è¿˜åœ¨ç”¨<code>Backbone.Router</code>åŠ  react æ¥å¼€å‘å•é¡µé¢åº”ç”¨ã€‚</p><p>ä½†æ˜¯é‚£ä¸ªæ—¶å€™çš„ reactï¼Œå’Œç°åœ¨çš„ reactï¼Œè§£å†³çš„æ ¸å¿ƒé—®é¢˜éƒ½æ²¡æœ‰å˜åŒ–ï¼Œé‚£å°±æ˜¯<strong>å¤æ‚çš„UIæ¸²æŸ“é—®é¢˜ï¼ˆ complex UI rendering ï¼‰</strong>ï¼Œæ‰€æœ‰çš„å®ƒçš„ç»„ä»¶åŒ–ï¼Œè™šæ‹Ÿ DOM å’Œ diff ç®—æ³•ï¼Œç”šè‡³ç›®å‰æå‡ºçš„ Fiberã€async renderingç­‰ç­‰ï¼Œéƒ½æ˜¯å›´ç»•è¿™ä¸ªä¸­å¿ƒã€‚</p><h3 id="FLUX"><a href="#FLUX" class="headerlink" title="FLUX"></a>FLUX</h3><p>åœ¨ 2014 å¹´äº”æœˆå·¦å³ï¼Œä¹Ÿå°±æ˜¯è·ç¦» react å¼€æºæ¥è¿‘ä¸€å¹´æ—¶é—´ï¼Œreact å…¬å¼€äº† FLUX æ¶æ„ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ç°åœ¨åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œç”šè‡³éƒ½å¾ˆéš¾å¬åˆ° FLUX è¿™ä¸ªè¯æ±‡äº†ï¼Œæ›´å¤šçš„åˆ™æ˜¯ redux ç”šè‡³ dva ç­‰æ›´ä¸Šå±‚çš„æ¡†æ¶ï¼Œä½†æ˜¯ç›®å‰ç»å¤§å¤šæ•° react ç›¸å…³çš„æ•°æ®ç®¡ç†æ¡†æ¶éƒ½å—åˆ°äº† FLUX å¾ˆå¤§å¯å‘ã€‚</p><p>FLUX å’ŒåŒå‘æ•°æ®ç»‘å®šçš„å…³ç³»ï¼Œæˆ‘è®¤ä¸ºè¿™é‡Œæœ‰å¿…è¦æ´å¼•å½“åˆå®˜æ–¹å†™çš„ä¸€ç‚¹è§£é‡Šï¼ˆæ›´è¯¦ç»†çš„ä¸€äº›ä¿¡æ¯ï¼Œå¯ä»¥çœ‹<a href="https://www.10000h.top/react_flux.pdf" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ï¼‰ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">To summarize, Flux works well for us because the single directional data flow makes it easy to understand and modify an application as it becomes more complicated. We found that two-way data bindings lead to cascading updates, where changing one data model led to another data model updating, making it very difficult to predict what would change as the result of a single user interaction.</span><br><span class="line"></span><br><span class="line">æ€»è€Œè¨€ä¹‹ï¼ŒFluxå¯¹æˆ‘ä»¬æ¥è¯´æ•ˆæœå¾ˆå¥½ï¼Œå› ä¸ºå•å‘æ•°æ®æµå¯ä»¥è®©åº”ç”¨ç¨‹åºå˜å¾—æ›´åŠ å¤æ‚ï¼Œä»è€Œè½»æ¾ç†è§£å’Œä¿®æ”¹åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å‘ç°åŒå‘æ•°æ®ç»‘å®šå¯¼è‡´çº§è”æ›´æ–°ï¼Œå…¶ä¸­æ›´æ”¹ä¸€ä¸ªæ•°æ®æ¨¡å‹å¯¼è‡´å¦ä¸€ä¸ªæ•°æ®æ¨¡å‹æ›´æ–°ï¼Œä½¿å¾—å¾ˆéš¾é¢„æµ‹å•ä¸ªç”¨æˆ·äº¤äº’çš„ç»“æœä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ã€‚</span><br></pre></td></tr></table></figure><p>ä»æ­¤ä¹‹åï¼Œä¸‹é¢è¿™å¼ å›¾ä¾¿å¤šæ¬¡å‡ºç°åœ¨å®˜æ–¹åšå®¢å’Œå„ä¸ªç½‘ç«™ä¸­ï¼Œç›¸ä¿¡æˆ‘ä»¬ä¹Ÿè‚¯å®šè§è¿‡ä¸‹å›¾ï¼š</p><p><img src="https://www.10000h.top/images/flux.png" alt></p><h3 id="react-router"><a href="#react-router" class="headerlink" title="react-router"></a>react-router</h3><p>2014å¹´8æœˆï¼Œreact-router çš„é›å½¢å‘å¸ƒï¼Œåœ¨å…¶å‘å¸ƒä¹‹å‰ï¼Œä¸å°‘ç¤ºä¾‹åº”ç”¨è¿˜åœ¨ä½¿ç”¨ backbone<br>.js çš„ routerï¼Œè€Œ react-router çš„å‘å¸ƒï¼Œæ ‡å¿—ç€ react ç”Ÿæ€çš„è¿›ä¸€æ­¥æˆç†Ÿã€‚</p><h3 id="react-ES6-Class"><a href="#react-ES6-Class" class="headerlink" title="react ES6 Class"></a>react ES6 Class</h3><p>å®é™…ä¸Šï¼Œåœ¨ 2015.01.27 ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½æ˜¯åœ¨ä½¿ç”¨ <code>React.createClass</code>æ¥ä¹¦å†™ç»„ä»¶ã€‚</p><p>è€Œåœ¨ 2015.01.27 è¿™ä¸€å¤©ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€å±Š <code>reactjs conf</code> çš„å‰ä¸€å¤©ï¼Œreact å®˜æ–¹å‘å¸ƒäº† React V0.13.0 beta ç‰ˆæœ¬ã€‚è¿™ä¸€ä¸ªç‰ˆæœ¬çš„æœ€å¤§æ›´æ–°å°±æ˜¯æ”¯æŒ ES6 çš„ Class å†™æ³•æ¥ä¹¦å†™ç»„ä»¶ï¼ŒåŒæ—¶ä¹Ÿå…¬å¸ƒäº†æ¯”å¦‚ propTypes ç±»å‹æ£€æŸ¥ã€defaultPropsã€AutoBindã€ref ç­‰ä¸€ç³»åˆ—ç›¸å…³å·¥ä½œåœ¨ ES6 Class æ¨¡å¼ä¸‹çš„å†™æ³•ã€‚</p><p>è¿™æ¬¡å‘å¸ƒæ˜¯ react å¼€æºè‡³æ­¤æœ€ä¸ºé‡å¤§çš„ä¸€æ¬¡æ›´æ–°ï¼Œä¹Ÿå› æ­¤ç›´æ¥å°† react çš„å†™æ³•è¿›è¡Œäº†é©æ–°ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œè¿™æ ‡å¿—ç€ react ä»åˆ€è€•ç«ç§çš„åŸå§‹æ—¶ä»£è¿›å…¥äº†çŸ³å™¨æ—¶ä»£ã€‚</p><p><em>å®é™…ä¸Šï¼Œç›´åˆ°ä¸€ä¸ªåŠæœˆåçš„ 03.10 ï¼ŒV0.13 çš„æ­£å¼ç‰ˆæœ¬æ‰å‘å¸ƒã€‚</em></p><p>è€Œåœ¨ä¹‹åçš„ V15.5 ç‰ˆæœ¬ï¼ˆ2017å¹´4æœˆå‘å¸ƒï¼‰ï¼Œreact æ‰å°†<code>React.createClass</code>çš„ä½¿ç”¨è®¾ç½®ä¸º Deprecationï¼Œå¹¶ä¸”å®£å¸ƒä¼šåœ¨å°†æ¥ç§»é™¤è¯¥ APIï¼Œä¸æ­¤åŒæ—¶ï¼Œreact å›¢é˜Ÿä»ç„¶æä¾›äº†ä¸€ä¸ªå•ç‹¬çš„åº“<code>create-react-class</code> æ¥æ”¯æŒåŸæ¥çš„ <code>React.createClass</code> åŠŸèƒ½ã€‚</p><h3 id="Relay-amp-GraphQL"><a href="#Relay-amp-GraphQL" class="headerlink" title="Relay &amp; GraphQL"></a>Relay &amp; GraphQL</h3><p>åœ¨ 2015 å¹´çš„ 2æœˆï¼ŒFacebook å…¬å¸ƒäº† GraphQLï¼ŒGraphQL æ˜¯ä¸€ç§æ–°çš„æ•°æ®æŸ¥è¯¢è§£å†³æ–¹æ¡ˆï¼Œäº‹å®è¯æ˜ï¼Œå®ƒæ˜¯éå¸¸ä¼˜ç§€çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œåˆ°ç°åœ¨å·²ç»åŸºæœ¬åœ¨è¡Œä¸šå†…äººå°½çš†çŸ¥ã€‚</p><p>è€Œ Relay åˆ™æ˜¯é“¾æ¥ react å’Œ GraphQL çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæœ‰ç‚¹ç±»ä¼¼ reduxï¼ˆä½†æ˜¯ stat æ•°åªæœ‰ redux çš„å››åˆ†ä¹‹ä¸€å·¦å³ï¼‰ï¼Œä½†æ˜¯å¯¹ GraphQL æ›´ä¸ºå‹å¥½ï¼Œå¹¶ä¸”åœ¨ç¼“å­˜æœºåˆ¶çš„è®¾è®¡ï¼ˆæŒ‰ç…§ Graph æ¥ cacheï¼‰ã€å£°æ˜å¼çš„æ•°æ®è·å–ç­‰æ–¹é¢ï¼Œæœ‰ä¸€äº›è‡ªå·±çš„ç‹¬åˆ°ä¹‹å¤„ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ redux é…åˆç›¸å…³æ’ä»¶ï¼Œä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ Relayã€‚</p><h3 id="React-Native"><a href="#React-Native" class="headerlink" title="React Native"></a>React Native</h3><p>åœ¨ç¬¬ä¸€å±Š React.js Conf ä¸­ï¼Œreact å›¢é˜Ÿé¦–æ¬¡å…¬å¼€äº† React Nativeï¼Œå¹¶ä¸”åœ¨3æœˆä»½çœŸæ­£å¼€æºäº† React Nativeï¼ˆå®é™…ä¸Šè¿™ä¸ªæ—¶å€™å®‰å“ç‰ˆæœ¬è¿˜å¹¶ä¸å¯ç”¨ï¼‰ï¼Œä¹‹ååœ¨2015å¹´ä¸ŠåŠå¹´ï¼Œç›¸å…³å›¢é˜Ÿé™†é™†ç»­ç»­æŠ«éœ²äº†å…³äº React Native å‘å±•æƒ…å†µçš„æ›´å¤šä¿¡æ¯ã€‚</p><p>å¹¶ä¸”ä¹Ÿæ˜¯åœ¨è¿™ä¸ªæ—¶å€™ï¼ˆ2015å¹´3æœˆï¼‰ï¼Œreact å›¢é˜Ÿå¼€å§‹ä½¿ç”¨ <strong>learn once, write anywhere</strong> è¿™ä¸ªå¦‚ä»Šæˆ‘ä»¬è€³ç†Ÿèƒ½è¯¦çš„å£å·ã€‚</p><h3 id="react-amp-react-dom-amp-babel"><a href="#react-amp-react-dom-amp-babel" class="headerlink" title="react &amp; react-dom &amp; babel"></a>react &amp; react-dom &amp; babel</h3><p>åœ¨2015å¹´ä¸ƒæœˆï¼Œå®˜æ–¹å‘å¸ƒäº†React v0.14 Beta 1ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå˜åŠ¨æ¯”è¾ƒå¤§çš„ç‰ˆæœ¬ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œä¸»è¦æœ‰å¦‚ä¸‹æ¯”è¾ƒå¤§çš„å˜åŒ–:</p><ul><li>å®˜æ–¹å®£å¸ƒåºŸå¼ƒ react-tools å’Œ JSTransformï¼Œè¿™æ˜¯å’Œ JSX è§£æç›¸å…³çš„åº“ï¼Œè€Œä»æ­¤ react å¼€å§‹ä½¿ç”¨ babelï¼Œæˆ‘è®¤ä¸ºè¿™å¯¹ react ä»¥åŠå…¶ä½¿ç”¨è€…æ¥è¯´æ— ç–‘æ˜¯ä¸€ä¸ªåˆ©å¥½ã€‚</li><li>åˆ†ç¦» react å’Œ react-domï¼Œç”±äº React Native å·²ç»è¿­ä»£äº†ä¸€æ®µæ—¶é—´ï¼Œè¿™ä¸ªåˆ†ç¦»åŒæ—¶ä¹Ÿæ„å‘³ç€ react ä¹‹åçš„å‘å±•æ–¹å‘ï¼Œreact æœ¬èº«å°†ä¼šå…³æ³¨æŠ½è±¡å±‚å’Œç»„ä»¶æœ¬èº«ï¼Œè€Œ react-dom å¯ä»¥å°†å…¶åœ¨æµè§ˆå™¨ä¸­è½åœ°ï¼ŒReact Native å¯ä»¥å°†å…¶åœ¨å®¢æˆ·ç«¯ä¸­è½åœ°ï¼Œä¹‹åä¹Ÿè®¸è¿˜ä¼šæœ‰ react-xxx â€¦</li></ul><p>å°† react å’Œ react-dom åˆ†ç¦»ä¹‹åï¼Œreact å›¢é˜Ÿåˆå¯¹ react-dom åœ¨ dom æ–¹é¢åšäº†è¾ƒä¸ºå¤§é‡çš„æ›´æ–°ã€‚</p><h3 id="Discontinuing-IE-8-Support"><a href="#Discontinuing-IE-8-Support" class="headerlink" title="Discontinuing IE 8 Support"></a>Discontinuing IE 8 Support</h3><p>åœ¨ react V15 çš„ç‰ˆæœ¬ä¸­ï¼Œæ”¾å¼ƒäº†å¯¹ IE 8 çš„æ”¯æŒã€‚</p><h3 id="Fiber"><a href="#Fiber" class="headerlink" title="Fiber"></a>Fiber</h3><p>react å›¢é˜Ÿä½¿ç”¨ Fiber æ¶æ„å®Œæˆäº† react V16 çš„å¼€å‘ï¼Œå¾—ç›Šäº Fiber æ¶æ„ï¼Œreact çš„æ€§èƒ½åˆå¾—åˆ°äº†æ˜¾è‘—æå‡ï¼ˆå°¤å…¶æ˜¯åœ¨æŸäº›è¦æ±‚äº¤äº’è¿ç»­çš„åœºæ™¯ä¸‹ï¼‰ï¼Œå¹¶ä¸”åŒ…å¤§å°ç¼©å°äº† 32%ã€‚</p><p>åˆ°ç›®å‰æ¥è¯´ï¼Œå…³äº Fiber æ¶æ„çš„ä¸­è‹±æ–‡èµ„æ–™éƒ½å·²ç»ç›¸å½“ä¸°å¯Œï¼Œç¬”è€…åœ¨è¿™é‡Œå°±ä¸è¿›è¡Œè¿‡å¤šçš„èµ˜è¿°äº†ã€‚</p><h3 id="æ¥ä¸‹æ¥çš„å±•æœ›"><a href="#æ¥ä¸‹æ¥çš„å±•æœ›" class="headerlink" title="æ¥ä¸‹æ¥çš„å±•æœ›"></a>æ¥ä¸‹æ¥çš„å±•æœ›</h3><p>react å›¢é˜Ÿç›®å‰çš„ä¸»è¦å·¥ä½œé›†ä¸­åœ¨ async rendering æ–¹é¢ï¼Œè¿™æ–¹é¢çš„æ”¹è¿›å¯ä»¥æå¤§æå‡ç”¨æˆ·äº¤äº’ä½“éªŒï¼ˆç‰¹åˆ«æ˜¯åœ¨å¼±ç½‘ç»œç¯å¢ƒä¸‹ï¼‰ï¼Œä¼šåœ¨ 2018 å¹´å‘å¸ƒã€‚</p><p>å¦‚æœä½ å¯¹è¿™æ–¹é¢çš„å†…å®¹å¾ˆæ„Ÿå…´è¶£ï¼Œä¸å¦¨çœ‹çœ‹ react ä¹‹å‰çš„<a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html" target="_blank" rel="noopener">æ¼”è®²è§†é¢‘</a></p><h3 id="é™„å½•1-ä¸€äº›ä½ å¯èƒ½ä¸çŸ¥é“çš„å˜åŒ–"><a href="#é™„å½•1-ä¸€äº›ä½ å¯èƒ½ä¸çŸ¥é“çš„å˜åŒ–" class="headerlink" title="é™„å½•1 ä¸€äº›ä½ å¯èƒ½ä¸çŸ¥é“çš„å˜åŒ–"></a>é™„å½•1 ä¸€äº›ä½ å¯èƒ½ä¸çŸ¥é“çš„å˜åŒ–</h3><ul><li>reactå¹¶éç›´æ¥å°† JSX æ¸²æŸ“æˆ DOMï¼Œè€Œæ˜¯å¯¹æŸäº›äº‹ä»¶å’Œå±æ€§åšäº†å°è£…ï¼ˆä¼˜åŒ–ï¼‰ã€‚ react å¯¹è¡¨å•ç±»å‹çš„ DOM è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ¯”å¦‚å°è£…äº†è¾ƒä¸ºé€šç”¨çš„ onChange å›è°ƒå‡½æ•°ï¼Œè¿™å…¶ä¸­éœ€è¦å¤„ç†ä¸å°‘é—®é¢˜ï¼Œreact åœ¨ V0.4 å³æ‹¥æœ‰äº†è¿™ä¸€ç‰¹æ€§ï¼Œå¯ä»¥å‚è€ƒ<a href="https://reactjs.org/blog/2013/07/23/community-roundup-5.html#cross-browser-onchange" target="_blank" rel="noopener">è¿™é‡Œ</a></li><li>äº‹å®ä¸Šï¼Œreact åœ¨V0.8ä¹‹å‰ï¼Œä¸€ç›´åœ¨ä»¥â€œreact-toolsâ€è¿™ä¸ªåå­—å‘å¸ƒï¼Œè€Œ npm ä¸Šé¢å«åš react çš„å®é™…ä¸Šæ˜¯å¦å¤–ä¸€ä¸ªåŒ…ï¼Œè€Œåˆ° V0.8 çš„æ—¶å€™ï¼Œreact å›¢é˜Ÿå’ŒåŸæ¥çš„ â€œreactâ€ åŒ…å¼€å‘è€…åå•†ï¼Œä¹‹å react ä¾¿æ¥ç®¡äº†åŸæ¥çš„è¿™ä¸ªåŒ…ï¼Œä¹Ÿå› æ­¤ï¼Œreactå¹¶æ²¡æœ‰ V0.6 å’Œ V0.7ï¼Œè€Œæ˜¯ä» V0.5 ç›´æ¥åˆ°äº† V0.8</li><li>react ä» V0.14 ä¹‹åï¼Œå°±ç›´æ¥è·³è·ƒåˆ°äº† V15ï¼Œå®˜æ–¹å›¢é˜Ÿç»™å‡ºçš„ç†ç”±æ˜¯ï¼Œreact å¾ˆæ—©å°±å·²ç»è¶³å¤Ÿç¨³å®šå¹¶ä¸”å¯ä»¥ä½¿ç”¨åœ¨ç”Ÿäº§ç‰ˆæœ¬ä¸­ï¼Œæ›´æ”¹ç‰ˆæœ¬çš„è¡¨è¾¾æ–¹å¼æ›´æœ‰åŠ©äºè¡¨ç¤º react é¡¹ç›®æœ¬èº«çš„ç¨³å®šæ€§ã€‚</li></ul><h3 id="é™„å½•2-ä¸€äº›æ¯”è¾ƒä¼˜ç§€çš„åšå®¢"><a href="#é™„å½•2-ä¸€äº›æ¯”è¾ƒä¼˜ç§€çš„åšå®¢" class="headerlink" title="é™„å½•2 ä¸€äº›æ¯”è¾ƒä¼˜ç§€çš„åšå®¢"></a>é™„å½•2 ä¸€äº›æ¯”è¾ƒä¼˜ç§€çš„åšå®¢</h3><ul><li>å…³äºReact Components, Elements, å’Œ Instancesï¼Œå¦‚æœä½ è¿˜æœ‰ä¸€äº›ç–‘é—®ï¼Œå¯ä»¥çœ‹ä¸€çœ‹Reactå®˜æ–¹å›¢é˜Ÿçš„æ–‡ç« ï¼š<a href="https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html" target="_blank" rel="noopener">React Components, Elements, and Instances</a></li><li>å¦‚æœä½ å€¾å‘äºä½¿ç”¨ mixinsï¼Œä¸å¦¨çœ‹çœ‹ react å…³äºå–æ¶ˆ mixinçš„è¯´æ³•ï¼š<a href="https://reactjs.org/blog/2016/07/13/mixins-considered-harmful.html" target="_blank" rel="noopener">Mixins Considered Harmful</a></li><li>react props ç›¸å…³çš„å¼€å‘æ¨¡å¼çš„å»ºè®®ï¼Œæˆ‘è®¤ä¸ºç›®å‰åœ¨ä½¿ç”¨ react çš„ç¨‹åºå‘˜éƒ½åº”è¯¥äº†è§£ä¸€ä¸‹<a href="https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html" target="_blank" rel="noopener">You Probably Donâ€™t Need Derived State</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åæ¡ç¼–å†™ä¼˜åŒ–çš„ JavaScript ä»£ç çš„å»ºè®®</title>
      <link href="/2018/05/29/%E5%8D%81%E6%9D%A1%E7%BC%96%E5%86%99%E4%BC%98%E5%8C%96%E7%9A%84JavaScript%E4%BB%A3%E7%A0%81%E7%9A%84%E5%BB%BA%E8%AE%AE/"/>
      <url>/2018/05/29/%E5%8D%81%E6%9D%A1%E7%BC%96%E5%86%99%E4%BC%98%E5%8C%96%E7%9A%84JavaScript%E4%BB%A3%E7%A0%81%E7%9A%84%E5%BB%BA%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡æ€»ç»“äº†åæ¡ç¼–å†™ä¼˜ç§€çš„ JavaScript ä»£ç çš„ä¹ æƒ¯ï¼Œä¸»è¦é’ˆå¯¹ V8 å¼•æ“ï¼š</p><p>1.å§‹ç»ˆä»¥ç›¸åŒçš„é¡ºåºå®ä¾‹åŒ–å¯¹è±¡å±æ€§ï¼Œä»¥ä¾¿å¯ä»¥å…±äº«éšè—ç±»å’Œéšåä¼˜åŒ–çš„ä»£ç ã€‚V8 åœ¨å¯¹ js ä»£ç è§£æçš„æ—¶å€™ä¼šæœ‰æ„å»ºéšè—ç±»çš„è¿‡ç¨‹ï¼Œä»¥ç›¸åŒçš„é¡ºåºå®ä¾‹åŒ–ï¼ˆå±æ€§èµ‹å€¼ï¼‰çš„å¯¹è±¡ä¼šå…±äº«ç›¸åŒçš„éšè—ç±»ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸å¥½çš„å®è·µï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Point</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.x = x;</span><br><span class="line">    <span class="keyword">this</span>.y = y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> Point(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">p1.a = <span class="number">5</span>;</span><br><span class="line">p1.b = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> Point(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">p2.b = <span class="number">7</span>;</span><br><span class="line">p2.a = <span class="number">8</span>;</span><br><span class="line"><span class="comment">// ç”±äº a å’Œ b çš„èµ‹å€¼é¡ºåºä¸åŒï¼Œp1 å’Œ p2 æ— æ³•å…±äº«éšè—ç±»</span></span><br></pre></td></tr></table></figure><p>2.é¿å…åˆ†é…åŠ¨æ€å±æ€§ã€‚åœ¨å®ä¾‹åŒ–ä¹‹åå‘å¯¹è±¡æ·»åŠ å±æ€§å°†å¼ºåˆ¶éšè—ç±»æ›´æ”¹ï¼Œå¹¶å‡æ…¢ä¸ºå…ˆå‰éšè—ç±»ä¼˜åŒ–çš„æ‰€æœ‰æ–¹æ³•ã€‚ç›¸åï¼Œåœ¨å…¶æ„é€ å‡½æ•°ä¸­åˆ†é…æ‰€æœ‰å¯¹è±¡çš„å±æ€§ã€‚  </p><p>3.é‡å¤æ‰§è¡Œç›¸åŒæ–¹æ³•çš„ä»£ç å°†æ¯”ä»…æ‰§è¡Œä¸€æ¬¡ï¼ˆç”±äºå†…è”ç¼“å­˜ï¼‰æ‰§è¡Œè®¸å¤šä¸åŒæ–¹æ³•çš„ä»£ç è¿è¡Œå¾—æ›´å¿«ã€‚  </p><p>4.é¿å…åˆ›å»ºç¨€ç–æ•°ç»„ã€‚ç¨€ç–æ•°ç»„ç”±äºä¸æ˜¯æ‰€æœ‰çš„å…ƒç´ éƒ½å­˜åœ¨ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå› æ­¤è®¿é—®ç¨€ç–æ•°ç»„ä¸­çš„å…ƒç´ ä»£ä»·æ›´é«˜ã€‚å¦å¤–ï¼Œå°½é‡ä¸è¦é‡‡ç”¨é¢„åˆ†é…æ•°é‡çš„å¤§æ•°ç»„ï¼Œæ›´å¥½çš„åŠæ³•æ˜¯éšç€ä½ çš„éœ€è¦æŠŠå®ƒçš„å®¹é‡å¢å¤§ã€‚æœ€åï¼Œå°½é‡ä¸è¦åˆ é™¤æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå®ƒä¼šè®©æ•°ç»„å˜å¾—ç¨€ç–ã€‚  </p><p>5.æ ‡è®°å€¼ï¼šV8é‡‡ç”¨32ä½æ¥è¡¨ç¤ºå¯¹è±¡å’Œæ•°å­—ï¼Œå…¶ä¸­ç”¨ä¸€ä½æ¥åŒºåˆ«å¯¹è±¡ï¼ˆflag = 0ï¼‰æˆ–æ•°å­—ï¼ˆflag = 1ï¼‰ï¼Œå› æ­¤è¿™è¢«ç§°ä¹‹ä¸º SMI (Small Integer)å› ä¸ºå®ƒåªæœ‰31ä½ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªæ•°å­—å¤§äº31ä½ï¼ŒV8éœ€è¦å¯¹å…¶è¿›è¡ŒåŒ…è£…ï¼Œå°†å…¶å˜æˆåŒç²¾åº¦å¹¶ä¸”ç”¨ä¸€ä¸ªå¯¹è±¡æ¥å°è£…å®ƒï¼Œå› æ­¤åº”è¯¥å°½é‡ä½¿ç”¨31ä½æœ‰ç¬¦å·æ•°å­—ä»è€Œé¿å…æ˜‚è´µçš„å°è£…æ“ä½œã€‚  </p><p>6.æ£€æŸ¥ä½ çš„ä¾èµ–ï¼Œå»æ‰ä¸éœ€è¦ import çš„å†…å®¹ã€‚  </p><p>7.å°†ä½ çš„ä»£ç åˆ†å‰²æˆä¸€äº›å°çš„ chunks ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¼•å…¥ã€‚ </p><p>8.å°½å¯èƒ½ä½¿ç”¨ defer æ¥æ¨è¿ŸåŠ è½½ JavaScriptï¼Œå¦å¤–åªåŠ è½½å½“å‰è·¯ç”±éœ€è¦çš„ä»£ç æ®µã€‚</p><p>9.ä½¿ç”¨ dev tools å’Œ DeviceTiming æ¥å¯»æ‰¾ä»£ç ç“¶é¢ˆã€‚  </p><p>10.ä½¿ç”¨è¯¸å¦‚Optimize.jsè¿™æ ·çš„å·¥å…·æ¥å¸®åŠ©è§£æå™¨å†³å®šä½•æ—¶éœ€è¦æå‰è§£æä»¥åŠä½•æ—¶éœ€è¦å»¶åè§£æã€‚  </p><p>ä»¥ä¸Šå†…å®¹æ¥æºï¼š</p><ul><li><a href="https://blog.sessionstack.com/how-javascript-works-parsing-abstract-syntax-trees-asts-5-tips-on-how-to-minimize-parse-time-abfcf7e8a0c8" target="_blank" rel="noopener">How JavaScript works: Parsing, Abstract Syntax Trees (ASTs) + 5 tips on how to minimize parse time</a></li><li><a href="https://blog.sessionstack.com/how-javascript-works-inside-the-v8-engine-5-tips-on-how-to-write-optimized-code-ac089e62b12e" target="_blank" rel="noopener">How JavaScript works: inside the V8 engine + 5 tips on how to write optimized code</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµ…è°ˆå‰ç«¯ä¸­çš„äºŒè¿›åˆ¶æ•°æ®ç±»å‹</title>
      <link href="/2018/05/08/%E6%B5%85%E8%B0%88%E5%89%8D%E7%AB%AF%E4%B8%AD%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
      <url>/2018/05/08/%E6%B5%85%E8%B0%88%E5%89%8D%E7%AB%AF%E4%B8%AD%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç›®å‰åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼ŒWebSocketéƒ¨åˆ†ç”±äºåç«¯ä½¿ç”¨äº†gzipå‹ç¼©ï¼Œå‰ç«¯å¤„ç†èµ·æ¥åºŸäº†ä¸€ç‚¹æ—¶é—´ï¼Œä»è€Œå‘ç°è‡ªå·±åœ¨äºŒè¿›åˆ¶æ•°æ®ç±»å‹è¿™ä¸ªçŸ¥è¯†ç‚¹è¿˜å­˜åœ¨ä¸€å®šçš„ç›²åŒºï¼Œå› æ­¤è¿™é‡Œè¿›è¡Œæ€»ç»“ã€‚</p></blockquote><p>æœ¬æ–‡ä¸»è¦ç®€å•ä»‹ç»ArrayBufferå¯¹è±¡ã€TypedArrayå¯¹è±¡ã€DataViewå¯¹è±¡ä»¥åŠBlobåŸå§‹æ•°æ®ç±»å‹ï¼Œå’Œå®ƒä»¬ä¹‹é—´çš„äº’ç›¸è½¬æ¢æ–¹æ³•ã€‚éƒ¨åˆ†ä»£ç å‚è€ƒ<a href="http://javascript.ruanyifeng.com/stdlib/arraybuffer.html#toc4" target="_blank" rel="noopener">è¿™é‡Œ</a>è€Œéæœ¬äººåŸåˆ›ï¼Œä»…åšä¸ªäººå­¦ä¹ ä½¿ç”¨ã€‚</p><p>è¿™äº›ç±»å‹åŒ–å¯¹è±¡ï¼Œä¸€èˆ¬ä¼šåœ¨ä»¥ä¸‹åœºæ™¯ä¸­ä½¿ç”¨ï¼š</p><ul><li>WebGL ä¸­ï¼Œæµè§ˆå™¨å’Œæ˜¾å¡ä¹‹é—´éœ€è¦ä½¿ç”¨äºŒè¿›åˆ¶æ•°æ®è¿›è¡Œé€šä¿¡ã€‚</li><li>åœ¨ä¸€äº› Rest æ¥å£æˆ–è€… WebSocket ä¸­ï¼Œé‡‡ç”¨å‹ç¼©è¿‡çš„æ•°æ®è¿›è¡Œé€šä¿¡ï¼Œè¿™ä¸ªå‹ç¼©å’Œè§£å‹ç¼©çš„è¿‡ç¨‹å¯èƒ½éœ€è¦å€ŸåŠ©äºŒè¿›åˆ¶å¯¹è±¡ã€‚</li><li>åœ¨ Canvas ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦é€šè¿‡ç”Ÿæˆ Blob çš„æ–¹å¼ä¿å­˜å½“å‰å†…å®¹ã€‚</li><li>åœ¨ Img ç­‰èµ„æºæ–‡ä»¶ä¸­ï¼ŒURL å¯ä»¥ä¸º Blob åŸå§‹æ•°æ®ç±»å‹ã€‚</li><li>åœ¨è¯»å–ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¯èƒ½éœ€è¦ç”¨åˆ°äºŒè¿›åˆ¶æ•°æ®ç±»å‹è¿›è¡Œä¸­é—´è½¬æ¢ã€‚</li></ul><p>ä¸‹æ–‡åˆ†ä¸¤éƒ¨åˆ†ï¼Œå‰ä¸€éƒ¨åˆ†æ¦‚è¿°å„ä¸ªäºŒè¿›åˆ¶æ•°æ®ç±»å‹ï¼Œåä¸€éƒ¨åˆ†å°†å®ƒä»¬ä¹‹é—´çš„äº’ç›¸è½¬æ¢ã€‚</p><h3 id="äºŒè¿›åˆ¶æ•°æ®ç±»å‹æ¦‚è¿°"><a href="#äºŒè¿›åˆ¶æ•°æ®ç±»å‹æ¦‚è¿°" class="headerlink" title="äºŒè¿›åˆ¶æ•°æ®ç±»å‹æ¦‚è¿°"></a>äºŒè¿›åˆ¶æ•°æ®ç±»å‹æ¦‚è¿°</h3><h4 id="ArrayBuffer"><a href="#ArrayBuffer" class="headerlink" title="ArrayBuffer"></a>ArrayBuffer</h4><p>ArrayBufferå¯¹è±¡ä»£è¡¨å‚¨å­˜äºŒè¿›åˆ¶æ•°æ®çš„ä¸€æ®µå†…å­˜ï¼Œå®ƒä¸èƒ½ç›´æ¥è¯»å†™ï¼Œåªèƒ½é€šè¿‡è§†å›¾ï¼ˆTypedArrayè§†å›¾å’ŒDataViewè§†å›¾)æ¥è¯»å†™ï¼Œè§†å›¾çš„ä½œç”¨æ˜¯ä»¥æŒ‡å®šæ ¼å¼è§£è¯»äºŒè¿›åˆ¶æ•°æ®ã€‚</p><p>ArrayBufferä¹Ÿæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä»¥åˆ†é…ä¸€æ®µå¯ä»¥å­˜æ”¾æ•°æ®çš„è¿ç»­å†…å­˜åŒºåŸŸã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var buf = new ArrayBuffer(32);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ç”Ÿæˆäº†ä¸€æ®µ32å­—èŠ‚çš„å†…å­˜åŒºåŸŸï¼Œæ¯ä¸ªå­—èŠ‚çš„å€¼é»˜è®¤éƒ½æ˜¯0ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒArrayBufferæ„é€ å‡½æ•°çš„å‚æ•°æ˜¯æ‰€éœ€è¦çš„å†…å­˜å¤§å°ï¼ˆå•ä½å­—èŠ‚ï¼‰ã€‚</p><p>ä¸ºäº†è¯»å†™è¿™æ®µå†…å®¹ï¼Œéœ€è¦ä¸ºå®ƒæŒ‡å®šè§†å›¾ã€‚DataViewè§†å›¾çš„åˆ›å»ºï¼Œéœ€è¦æä¾›ArrayBufferå¯¹è±¡å®ä¾‹ä½œä¸ºå‚æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var buf = new ArrayBuffer(32);</span><br><span class="line">var dataView = new DataView(buf);</span><br><span class="line">dataView.getUint8(0) // 0</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å¯¹ä¸€æ®µ32å­—èŠ‚çš„å†…å­˜ï¼Œå»ºç«‹DataViewè§†å›¾ï¼Œç„¶åä»¥ä¸å¸¦ç¬¦å·çš„8ä½æ•´æ•°æ ¼å¼ï¼Œè¯»å–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç»“æœå¾—åˆ°0ï¼Œå› ä¸ºåŸå§‹å†…å­˜çš„ArrayBufferå¯¹è±¡ï¼Œé»˜è®¤æ‰€æœ‰ä½éƒ½æ˜¯0ã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥å°†ArrayBufferç”Ÿæˆçš„ç»“æœï¼Œä¼ å…¥TypedArrayä¸­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var buffer = new ArrayBuffer(12);</span><br><span class="line"></span><br><span class="line">var x1 = new Int32Array(buffer);</span><br><span class="line">x1[0] = 1;</span><br><span class="line">var x2 = new Uint8Array(buffer);</span><br><span class="line">x2[0]  = 2;</span><br><span class="line"></span><br><span class="line">x1[0] // 2</span><br></pre></td></tr></table></figure><p>ArrayBufferå®ä¾‹çš„byteLengthå±æ€§ï¼Œè¿”å›æ‰€åˆ†é…çš„å†…å­˜åŒºåŸŸçš„å­—èŠ‚é•¿åº¦ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var buffer = new ArrayBuffer(32);</span><br><span class="line">buffer.byteLength</span><br><span class="line">// 32</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦åˆ†é…çš„å†…å­˜åŒºåŸŸå¾ˆå¤§ï¼Œæœ‰å¯èƒ½åˆ†é…å¤±è´¥ï¼ˆå› ä¸ºæ²¡æœ‰é‚£ä¹ˆå¤šçš„è¿ç»­ç©ºä½™å†…å­˜ï¼‰ï¼Œæ‰€ä»¥æœ‰å¿…è¦æ£€æŸ¥æ˜¯å¦åˆ†é…æˆåŠŸã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (buffer.byteLength === n) &#123;</span><br><span class="line">  // æˆåŠŸ</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  // å¤±è´¥</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ArrayBufferå®ä¾‹æœ‰ä¸€ä¸ªsliceæ–¹æ³•ï¼Œå…è®¸å°†å†…å­˜åŒºåŸŸçš„ä¸€éƒ¨åˆ†ï¼Œæ‹·è´ç”Ÿæˆä¸€ä¸ªæ–°çš„ArrayBufferå¯¹è±¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var buffer = new ArrayBuffer(8);</span><br><span class="line">var newBuffer = buffer.slice(0, 3);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç æ‹·è´bufferå¯¹è±¡çš„å‰3ä¸ªå­—èŠ‚ï¼ˆä»0å¼€å§‹ï¼Œåˆ°ç¬¬3ä¸ªå­—èŠ‚å‰é¢ç»“æŸï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ArrayBufferå¯¹è±¡ã€‚sliceæ–¹æ³•å…¶å®åŒ…å«ä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯å…ˆåˆ†é…ä¸€æ®µæ–°å†…å­˜ï¼Œç¬¬äºŒæ­¥æ˜¯å°†åŸæ¥é‚£ä¸ªArrayBufferå¯¹è±¡æ‹·è´è¿‡å»ã€‚</p><p>sliceæ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ‹·è´å¼€å§‹çš„å­—èŠ‚åºå·ï¼ˆå«è¯¥å­—èŠ‚ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ‹·è´æˆªæ­¢çš„å­—èŠ‚åºå·ï¼ˆä¸å«è¯¥å­—èŠ‚ï¼‰ã€‚å¦‚æœçœç•¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œåˆ™é»˜è®¤åˆ°åŸArrayBufferå¯¹è±¡çš„ç»“å°¾ã€‚</p><p>é™¤äº†sliceæ–¹æ³•ï¼ŒArrayBufferå¯¹è±¡ä¸æä¾›ä»»ä½•ç›´æ¥è¯»å†™å†…å­˜çš„æ–¹æ³•ï¼Œåªå…è®¸åœ¨å…¶ä¸Šæ–¹å»ºç«‹è§†å›¾ï¼Œç„¶åé€šè¿‡è§†å›¾è¯»å†™ã€‚</p><p>ArrayBufferæœ‰ä¸€ä¸ªé™æ€æ–¹æ³•isViewï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‚æ•°æ˜¯å¦ä¸ºArrayBufferçš„è§†å›¾å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•å¤§è‡´ç›¸å½“äºåˆ¤æ–­å‚æ•°ï¼Œæ˜¯å¦ä¸ºTypedArrayå®ä¾‹æˆ–DataViewå®ä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var buffer = new ArrayBuffer(8);</span><br><span class="line">ArrayBuffer.isView(buffer) // false</span><br><span class="line"></span><br><span class="line">var v = new Int32Array(buffer);</span><br><span class="line">ArrayBuffer.isView(v) // true</span><br></pre></td></tr></table></figure><h4 id="TypedArray"><a href="#TypedArray" class="headerlink" title="TypedArray"></a>TypedArray</h4><p>ç›®å‰ï¼ŒTypedArrayå¯¹è±¡ä¸€å…±æä¾›9ç§ç±»å‹çš„è§†å›¾ï¼Œæ¯ä¸€ç§è§†å›¾éƒ½æ˜¯ä¸€ç§æ„é€ å‡½æ•°ã€‚</p><ul><li>Int8Arrayï¼š8ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦1ä¸ªå­—èŠ‚ã€‚</li><li>Uint8Arrayï¼š8ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦1ä¸ªå­—èŠ‚ã€‚</li><li>Uint8ClampedArrayï¼š8ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦1ä¸ªå­—èŠ‚ï¼Œæº¢å‡ºå¤„ç†ä¸åŒã€‚</li><li>Int16Arrayï¼š16ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦2ä¸ªå­—èŠ‚ã€‚</li><li>Uint16Arrayï¼š16ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦2ä¸ªå­—èŠ‚ã€‚</li><li>Int32Arrayï¼š32ä½æœ‰ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦4ä¸ªå­—èŠ‚ã€‚</li><li>Uint32Arrayï¼š32ä½æ— ç¬¦å·æ•´æ•°ï¼Œé•¿åº¦4ä¸ªå­—èŠ‚ã€‚</li><li>Float32Arrayï¼š32ä½æµ®ç‚¹æ•°ï¼Œé•¿åº¦4ä¸ªå­—èŠ‚ã€‚</li><li>Float64Arrayï¼š64ä½æµ®ç‚¹æ•°ï¼Œé•¿åº¦8ä¸ªå­—èŠ‚ã€‚</li></ul><p>è¿™9ä¸ªæ„é€ å‡½æ•°ç”Ÿæˆçš„å¯¹è±¡ï¼Œç»Ÿç§°ä¸ºTypedArrayå¯¹è±¡ã€‚å®ƒä»¬å¾ˆåƒæ­£å¸¸æ•°ç»„ï¼Œéƒ½æœ‰lengthå±æ€§ï¼Œéƒ½èƒ½ç”¨æ–¹æ‹¬å·è¿ç®—ç¬¦ï¼ˆ[]ï¼‰è·å–å•ä¸ªå…ƒç´ ï¼Œæ‰€æœ‰æ•°ç»„çš„æ–¹æ³•ï¼Œåœ¨ç±»å‹åŒ–æ•°ç»„ä¸Šé¢éƒ½èƒ½ä½¿ç”¨ã€‚ä¸¤è€…çš„å·®å¼‚ä¸»è¦åœ¨ä»¥ä¸‹æ–¹é¢ã€‚</p><ul><li>TypedArrayæ•°ç»„çš„æ‰€æœ‰æˆå‘˜ï¼Œéƒ½æ˜¯åŒä¸€ç§ç±»å‹å’Œæ ¼å¼ã€‚</li><li>TypedArrayæ•°ç»„çš„æˆå‘˜æ˜¯è¿ç»­çš„ï¼Œä¸ä¼šæœ‰ç©ºä½ã€‚</li><li>TypedåŒ–æ•°ç»„æˆå‘˜çš„é»˜è®¤å€¼ä¸º0ã€‚æ¯”å¦‚ï¼Œnew Array(10)è¿”å›ä¸€ä¸ªæ­£å¸¸æ•°ç»„ï¼Œé‡Œé¢æ²¡æœ‰ä»»ä½•æˆå‘˜ï¼Œåªæ˜¯10ä¸ªç©ºä½ï¼›new Uint8Array(10)è¿”å›ä¸€ä¸ªç±»å‹åŒ–æ•°ç»„ï¼Œé‡Œé¢10ä¸ªæˆå‘˜éƒ½æ˜¯0ã€‚</li><li>TypedArrayæ•°ç»„åªæ˜¯ä¸€å±‚è§†å›¾ï¼Œæœ¬èº«ä¸å‚¨å­˜æ•°æ®ï¼Œå®ƒçš„æ•°æ®éƒ½å‚¨å­˜åœ¨åº•å±‚çš„ArrayBufferå¯¹è±¡ä¹‹ä¸­ï¼Œè¦è·å–åº•å±‚å¯¹è±¡å¿…é¡»ä½¿ç”¨bufferå±æ€§ã€‚</li></ul><h5 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h5><p>TypedArrayæ•°ç»„æä¾›9ç§æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆç›¸åº”ç±»å‹çš„æ•°ç»„å®ä¾‹ã€‚</p><p>æ„é€ å‡½æ•°æœ‰å¤šç§ç”¨æ³•ã€‚</p><ul><li>TypedArray(buffer, byteOffset=0, length?)</li></ul><p>åŒä¸€ä¸ªArrayBufferå¯¹è±¡ä¹‹ä¸Šï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œå»ºç«‹å¤šä¸ªè§†å›¾ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºä¸€ä¸ª8å­—èŠ‚çš„ArrayBuffer</span><br><span class="line">var b = new ArrayBuffer(8);</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºä¸€ä¸ªæŒ‡å‘bçš„Int32è§†å›¾ï¼Œå¼€å§‹äºå­—èŠ‚0ï¼Œç›´åˆ°ç¼“å†²åŒºçš„æœ«å°¾</span><br><span class="line">var v1 = new Int32Array(b);</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºä¸€ä¸ªæŒ‡å‘bçš„Uint8è§†å›¾ï¼Œå¼€å§‹äºå­—èŠ‚2ï¼Œç›´åˆ°ç¼“å†²åŒºçš„æœ«å°¾</span><br><span class="line">var v2 = new Uint8Array(b, 2);</span><br><span class="line"></span><br><span class="line">// åˆ›å»ºä¸€ä¸ªæŒ‡å‘bçš„Int16è§†å›¾ï¼Œå¼€å§‹äºå­—èŠ‚2ï¼Œé•¿åº¦ä¸º2</span><br><span class="line">var v3 = new Int16Array(b, 2, 2);</span><br></pre></td></tr></table></figure><p>å¯¹äºä»¥ä¸Šä»£ç ï¼Œv1ã€v2å’Œv3æ˜¯é‡å çš„ï¼šv1[0]æ˜¯ä¸€ä¸ª32ä½æ•´æ•°ï¼ŒæŒ‡å‘å­—èŠ‚0ï½å­—èŠ‚3ï¼›v2[0]æ˜¯ä¸€ä¸ª8ä½æ— ç¬¦å·æ•´æ•°ï¼ŒæŒ‡å‘å­—èŠ‚2ï¼›v3[0]æ˜¯ä¸€ä¸ª16ä½æ•´æ•°ï¼ŒæŒ‡å‘å­—èŠ‚2ï½å­—èŠ‚3ã€‚åªè¦ä»»ä½•ä¸€ä¸ªè§†å›¾å¯¹å†…å­˜æœ‰æ‰€ä¿®æ”¹ï¼Œå°±ä¼šåœ¨å¦å¤–ä¸¤ä¸ªè§†å›¾ä¸Šååº”å‡ºæ¥ã€‚</p><p>æ³¨æ„ï¼ŒbyteOffsetå¿…é¡»ä¸æ‰€è¦å»ºç«‹çš„æ•°æ®ç±»å‹ä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var buffer = new ArrayBuffer(8);</span><br><span class="line">var i16 = new Int16Array(buffer, 1);</span><br><span class="line">// Uncaught RangeError: start offset of Int16Array should be a multiple of 2</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ–°ç”Ÿæˆä¸€ä¸ª8ä¸ªå­—èŠ‚çš„ArrayBufferå¯¹è±¡ï¼Œç„¶ååœ¨è¿™ä¸ªå¯¹è±¡çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå»ºç«‹å¸¦ç¬¦å·çš„16ä½æ•´æ•°è§†å›¾ï¼Œç»“æœæŠ¥é”™ã€‚å› ä¸ºï¼Œå¸¦ç¬¦å·çš„16ä½æ•´æ•°éœ€è¦ä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥byteOffsetå‚æ•°å¿…é¡»èƒ½å¤Ÿè¢«2æ•´é™¤ã€‚</p><p>å¦‚æœæƒ³ä»ä»»æ„å­—èŠ‚å¼€å§‹è§£è¯»ArrayBufferå¯¹è±¡ï¼Œå¿…é¡»ä½¿ç”¨DataViewè§†å›¾ï¼Œå› ä¸ºTypedArrayè§†å›¾åªæä¾›9ç§å›ºå®šçš„è§£è¯»æ ¼å¼ã€‚</p><ul><li>TypedArray(length)</li></ul><p>è§†å›¾è¿˜å¯ä»¥ä¸é€šè¿‡ArrayBufferå¯¹è±¡ï¼Œç›´æ¥åˆ†é…å†…å­˜è€Œç”Ÿæˆã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var f64a = new Float64Array(8);</span><br><span class="line">f64a[0] = 10;</span><br><span class="line">f64a[1] = 20;</span><br><span class="line">f64a[2] = f64a[0] + f64a[1];</span><br></pre></td></tr></table></figure><ul><li>TypedArray(typedArray)</li></ul><p>ç±»å‹åŒ–æ•°ç»„çš„æ„é€ å‡½æ•°ï¼Œå¯ä»¥æ¥å—å¦ä¸€ä¸ªè§†å›¾å®ä¾‹ä½œä¸ºå‚æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var typedArray = new Int8Array(new Uint8Array(4));</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼ŒInt8Arrayæ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªUint8Arrayå®ä¾‹ä½œä¸ºå‚æ•°ã€‚</p><p>æ³¨æ„ï¼Œæ­¤æ—¶ç”Ÿæˆçš„æ–°æ•°ç»„ï¼Œåªæ˜¯å¤åˆ¶äº†å‚æ•°æ•°ç»„çš„å€¼ï¼Œå¯¹åº”çš„åº•å±‚å†…å­˜æ˜¯ä¸ä¸€æ ·çš„ã€‚æ–°æ•°ç»„ä¼šå¼€è¾Ÿä¸€æ®µæ–°çš„å†…å­˜å‚¨å­˜æ•°æ®ï¼Œä¸ä¼šåœ¨åŸæ•°ç»„çš„å†…å­˜ä¹‹ä¸Šå»ºç«‹è§†å›¾ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var x = new Int8Array([1, 1]);</span><br><span class="line">var y = new Int8Array(x);</span><br><span class="line">x[0] // 1</span><br><span class="line">y[0] // 1</span><br><span class="line"></span><br><span class="line">x[0] = 2;</span><br><span class="line">y[0] // 1</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„yæ˜¯ä»¥æ•°ç»„xä¸ºæ¨¡æ¿è€Œç”Ÿæˆçš„ï¼Œå½“xå˜åŠ¨çš„æ—¶å€™ï¼Œyå¹¶æ²¡æœ‰å˜åŠ¨ã€‚</p><p>å¦‚æœæƒ³åŸºäºåŒä¸€æ®µå†…å­˜ï¼Œæ„é€ ä¸åŒçš„è§†å›¾ï¼Œå¯ä»¥é‡‡ç”¨ä¸‹é¢çš„å†™æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var x = new Int8Array([1, 1]);</span><br><span class="line">var y = new Int8Array(x.buffer);</span><br><span class="line">x[0] // 1</span><br><span class="line">y[0] // 1</span><br><span class="line"></span><br><span class="line">x[0] = 2;</span><br><span class="line">y[0] // 2</span><br></pre></td></tr></table></figure><ul><li>TypedArray(arrayLikeObject)</li></ul><p>æ„é€ å‡½æ•°çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šæ•°ç»„ï¼Œç„¶åç›´æ¥ç”ŸæˆTypedArrayå®ä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var typedArray = new Uint8Array([1, 2, 3, 4]);</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™æ—¶TypedArrayè§†å›¾ä¼šé‡æ–°å¼€è¾Ÿå†…å­˜ï¼Œä¸ä¼šåœ¨åŸæ•°ç»„çš„å†…å­˜ä¸Šå»ºç«‹è§†å›¾ã€‚</p><p>ä¸Šé¢ä»£ç ä»ä¸€ä¸ªæ™®é€šçš„æ•°ç»„ï¼Œç”Ÿæˆä¸€ä¸ª8ä½æ— ç¬¦å·æ•´æ•°çš„TypedArrayå®ä¾‹ã€‚</p><p>TypedArrayæ•°ç»„ä¹Ÿå¯ä»¥è½¬æ¢å›æ™®é€šæ•°ç»„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var normalArray = Array.prototype.slice.call(typedArray);</span><br></pre></td></tr></table></figure><h5 id="BYTES-PER-ELEMENTå±æ€§"><a href="#BYTES-PER-ELEMENTå±æ€§" class="headerlink" title="BYTES_PER_ELEMENTå±æ€§"></a>BYTES_PER_ELEMENTå±æ€§</h5><p>æ¯ä¸€ç§è§†å›¾çš„æ„é€ å‡½æ•°ï¼Œéƒ½æœ‰ä¸€ä¸ªBYTES_PER_ELEMENTå±æ€§ï¼Œè¡¨ç¤ºè¿™ç§æ•°æ®ç±»å‹å æ®çš„å­—èŠ‚æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Int8Array.BYTES_PER_ELEMENT // 1</span><br><span class="line">Uint8Array.BYTES_PER_ELEMENT // 1</span><br><span class="line">Int16Array.BYTES_PER_ELEMENT // 2</span><br><span class="line">Uint16Array.BYTES_PER_ELEMENT // 2</span><br><span class="line">Int32Array.BYTES_PER_ELEMENT // 4</span><br><span class="line">Uint32Array.BYTES_PER_ELEMENT // 4</span><br><span class="line">Float32Array.BYTES_PER_ELEMENT // 4</span><br><span class="line">Float64Array.BYTES_PER_ELEMENT // 8</span><br></pre></td></tr></table></figure><h5 id="ArrayBufferä¸å­—ç¬¦ä¸²çš„äº’ç›¸è½¬æ¢"><a href="#ArrayBufferä¸å­—ç¬¦ä¸²çš„äº’ç›¸è½¬æ¢" class="headerlink" title="ArrayBufferä¸å­—ç¬¦ä¸²çš„äº’ç›¸è½¬æ¢"></a>ArrayBufferä¸å­—ç¬¦ä¸²çš„äº’ç›¸è½¬æ¢</h5><p>ArrayBufferè½¬ä¸ºå­—ç¬¦ä¸²ï¼Œæˆ–è€…å­—ç¬¦ä¸²è½¬ä¸ºArrayBufferï¼Œæœ‰ä¸€ä¸ªå‰æï¼Œå³å­—ç¬¦ä¸²çš„ç¼–ç æ–¹æ³•æ˜¯ç¡®å®šçš„ã€‚å‡å®šå­—ç¬¦ä¸²é‡‡ç”¨UTF-16ç¼–ç ï¼ˆJavaScriptçš„å†…éƒ¨ç¼–ç æ–¹å¼ï¼‰ï¼Œå¯ä»¥è‡ªå·±ç¼–å†™è½¬æ¢å‡½æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// ArrayBufferè½¬ä¸ºå­—ç¬¦ä¸²ï¼Œå‚æ•°ä¸ºArrayBufferå¯¹è±¡</span><br><span class="line">function ab2str(buf) &#123;</span><br><span class="line">  return String.fromCharCode.apply(null, new Uint16Array(buf));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å­—ç¬¦ä¸²è½¬ä¸ºArrayBufferå¯¹è±¡ï¼Œå‚æ•°ä¸ºå­—ç¬¦ä¸²</span><br><span class="line">function str2ab(str) &#123;</span><br><span class="line">  var buf = new ArrayBuffer(str.length * 2); // æ¯ä¸ªå­—ç¬¦å ç”¨2ä¸ªå­—èŠ‚</span><br><span class="line">  var bufView = new Uint16Array(buf);</span><br><span class="line">  for (var i = 0, strLen = str.length; i &lt; strLen; i++) &#123;</span><br><span class="line">    bufView[i] = str.charCodeAt(i);</span><br><span class="line">  &#125;</span><br><span class="line">  return buf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="TypedArray-prototype-set"><a href="#TypedArray-prototype-set" class="headerlink" title="TypedArray.prototype.set()"></a>TypedArray.prototype.set()</h5><p>TypedArrayæ•°ç»„çš„setæ–¹æ³•ç”¨äºå¤åˆ¶æ•°ç»„ï¼ˆæ­£å¸¸æ•°ç»„æˆ–TypedArrayæ•°ç»„ï¼‰ï¼Œä¹Ÿå°±æ˜¯å°†ä¸€æ®µå†…å®¹å®Œå…¨å¤åˆ¶åˆ°å¦ä¸€æ®µå†…å­˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var a = new Uint8Array(8);</span><br><span class="line">var b = new Uint8Array(8);</span><br><span class="line"></span><br><span class="line">b.set(a);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å¤åˆ¶aæ•°ç»„çš„å†…å®¹åˆ°bæ•°ç»„ï¼Œå®ƒæ˜¯æ•´æ®µå†…å­˜çš„å¤åˆ¶ï¼Œæ¯”ä¸€ä¸ªä¸ªæ‹·è´æˆå‘˜çš„é‚£ç§å¤åˆ¶å¿«å¾—å¤šã€‚setæ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¡¨ç¤ºä»bå¯¹è±¡å“ªä¸€ä¸ªæˆå‘˜å¼€å§‹å¤åˆ¶aå¯¹è±¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var a = new Uint16Array(8);</span><br><span class="line">var b = new Uint16Array(10);</span><br><span class="line"></span><br><span class="line">b.set(a, 2)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç çš„bæ•°ç»„æ¯”aæ•°ç»„å¤šä¸¤ä¸ªæˆå‘˜ï¼Œæ‰€ä»¥ä»b[2]å¼€å§‹å¤åˆ¶ã€‚</p><h5 id="TypedArray-prototype-subarray"><a href="#TypedArray-prototype-subarray" class="headerlink" title="TypedArray.prototype.subarray()"></a>TypedArray.prototype.subarray()</h5><p>subarrayæ–¹æ³•æ˜¯å¯¹äºTypedArrayæ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œå†å»ºç«‹ä¸€ä¸ªæ–°çš„è§†å›¾ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var a = new Uint16Array(8);</span><br><span class="line">var b = a.subarray(2,3);</span><br><span class="line"></span><br><span class="line">a.byteLength // 16</span><br><span class="line">b.byteLength // 2</span><br></pre></td></tr></table></figure><p>subarrayæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯èµ·å§‹çš„æˆå‘˜åºå·ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç»“æŸçš„æˆå‘˜åºå·ï¼ˆä¸å«è¯¥æˆå‘˜ï¼‰ï¼Œå¦‚æœçœç•¥åˆ™åŒ…å«å‰©ä½™çš„å…¨éƒ¨æˆå‘˜ã€‚æ‰€ä»¥ï¼Œä¸Šé¢ä»£ç çš„a.subarray(2,3)ï¼Œæ„å‘³ç€båªåŒ…å«a[2]ä¸€ä¸ªæˆå‘˜ï¼Œå­—èŠ‚é•¿åº¦ä¸º2ã€‚</p><h5 id="TypedArray-prototype-slice"><a href="#TypedArray-prototype-slice" class="headerlink" title="TypedArray.prototype.slice()"></a>TypedArray.prototype.slice()</h5><p>TypeArrayå®ä¾‹çš„sliceæ–¹æ³•ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªæŒ‡å®šä½ç½®çš„æ–°çš„TypedArrayå®ä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let ui8 = Uint8Array.of(0, 1, 2);</span><br><span class="line">ui8.slice(-1)</span><br><span class="line">// Uint8Array [ 2 ]</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­ï¼Œui8æ˜¯8ä½æ— ç¬¦å·æ•´æ•°æ•°ç»„è§†å›¾çš„ä¸€ä¸ªå®ä¾‹ã€‚å®ƒçš„sliceæ–¹æ³•å¯ä»¥ä»å½“å‰è§†å›¾ä¹‹ä¸­ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„è§†å›¾å®ä¾‹ã€‚</p><p>sliceæ–¹æ³•çš„å‚æ•°ï¼Œè¡¨ç¤ºåŸæ•°ç»„çš„å…·ä½“ä½ç½®ï¼Œå¼€å§‹ç”Ÿæˆæ–°æ•°ç»„ã€‚è´Ÿå€¼è¡¨ç¤ºé€†å‘çš„ä½ç½®ï¼Œå³-1ä¸ºå€’æ•°ç¬¬ä¸€ä¸ªä½ç½®ï¼Œ-2è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªä½ç½®ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><h5 id="TypedArray-of"><a href="#TypedArray-of" class="headerlink" title="TypedArray.of()"></a>TypedArray.of()</h5><p>TypedArrayæ•°ç»„çš„æ‰€æœ‰æ„é€ å‡½æ•°ï¼Œéƒ½æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•ofï¼Œç”¨äºå°†å‚æ•°è½¬ä¸ºä¸€ä¸ªTypedArrayå®ä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Float32Array.of(0.151, -8, 3.7)</span><br><span class="line">// Float32Array [ 0.151, -8, 3.7 ]</span><br></pre></td></tr></table></figure><h5 id="TypedArray-from"><a href="#TypedArray-from" class="headerlink" title="TypedArray.from()"></a>TypedArray.from()</h5><p>é™æ€æ–¹æ³•fromæ¥å—ä¸€ä¸ª<strong>å¯éå†çš„æ•°æ®ç»“æ„ï¼ˆæ¯”å¦‚æ•°ç»„ï¼‰</strong>ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªåŸºäºè¿™ä¸ªç»“æ„çš„TypedArrayå®ä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Uint16Array.from([0, 1, 2])</span><br><span class="line">// Uint16Array [ 0, 1, 2 ]</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•è¿˜å¯ä»¥å°†ä¸€ç§TypedArrayå®ä¾‹ï¼Œè½¬ä¸ºå¦ä¸€ç§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var ui16 = Uint16Array.from(Uint8Array.of(0, 1, 2));</span><br><span class="line">ui16 instanceof Uint16Array // true</span><br></pre></td></tr></table></figure><p>fromæ–¹æ³•è¿˜å¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œéå†ï¼ŒåŠŸèƒ½ç±»ä¼¼mapæ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Int8Array.of(127, 126, 125).map(x =&gt; 2 * x)</span><br><span class="line">// Int8Array [ -2, -4, -6 ]</span><br><span class="line"></span><br><span class="line">Int16Array.from(Int8Array.of(127, 126, 125), x =&gt; 2 * x)</span><br><span class="line">// Int16Array [ 254, 252, 250 ]</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œfromæ–¹æ³•æ²¡æœ‰å‘ç”Ÿæº¢å‡ºï¼Œè¿™è¯´æ˜éå†æ˜¯é’ˆå¯¹æ–°ç”Ÿæˆçš„16ä½æ•´æ•°æ•°ç»„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹åŸæ¥çš„8ä½æ•´æ•°æ•°ç»„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œfromä¼šå°†ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šçš„TypedArrayæ•°ç»„ï¼Œæ‹·è´åˆ°å¦ä¸€æ®µå†…å­˜ä¹‹ä¸­ï¼ˆå ç”¨å†…å­˜ä»3å­—èŠ‚å˜ä¸º6å­—èŠ‚ï¼‰ï¼Œç„¶åå†è¿›è¡Œå¤„ç†ã€‚</p><h4 id="DataView"><a href="#DataView" class="headerlink" title="DataView"></a>DataView</h4><p>å¦‚æœä¸€æ®µæ•°æ®åŒ…æ‹¬å¤šç§ç±»å‹ï¼ˆæ¯”å¦‚æœåŠ¡å™¨ä¼ æ¥çš„HTTPæ•°æ®ï¼‰ï¼Œè¿™æ—¶é™¤äº†å»ºç«‹ArrayBufferå¯¹è±¡çš„å¤åˆè§†å›¾ä»¥å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡DataViewè§†å›¾è¿›è¡Œæ“ä½œã€‚</p><p>DataViewè§†å›¾æä¾›æ›´å¤šæ“ä½œé€‰é¡¹ï¼Œè€Œä¸”æ”¯æŒè®¾å®šå­—èŠ‚åºã€‚æœ¬æ¥ï¼Œåœ¨è®¾è®¡ç›®çš„ä¸Šï¼ŒArrayBufferå¯¹è±¡çš„å„ç§TypedArrayè§†å›¾ï¼Œæ˜¯ç”¨æ¥å‘ç½‘å¡ã€å£°å¡ä¹‹ç±»çš„æœ¬æœºè®¾å¤‡ä¼ é€æ•°æ®ï¼Œæ‰€ä»¥ä½¿ç”¨æœ¬æœºçš„å­—èŠ‚åºå°±å¯ä»¥äº†ï¼›è€ŒDataViewè§†å›¾çš„è®¾è®¡ç›®çš„ï¼Œæ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œè®¾å¤‡ä¼ æ¥çš„æ•°æ®ï¼Œæ‰€ä»¥å¤§ç«¯å­—èŠ‚åºæˆ–å°ç«¯å­—èŠ‚åºæ˜¯å¯ä»¥è‡ªè¡Œè®¾å®šçš„ã€‚</p><p>DataViewè§†å›¾æœ¬èº«ä¹Ÿæ˜¯æ„é€ å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªArrayBufferå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç”Ÿæˆè§†å›¾ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DataView(ArrayBuffer buffer [, å­—èŠ‚èµ·å§‹ä½ç½® [, é•¿åº¦]]);</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var buffer = new ArrayBuffer(24);</span><br><span class="line">var dv = new DataView(buffer);</span><br></pre></td></tr></table></figure><p>DataViewå®ä¾‹æœ‰ä»¥ä¸‹å±æ€§ï¼Œå«ä¹‰ä¸TypedArrayå®ä¾‹çš„åŒåæ–¹æ³•ç›¸åŒã€‚</p><ul><li>DataView.prototype.bufferï¼šè¿”å›å¯¹åº”çš„ArrayBufferå¯¹è±¡</li><li>DataView.prototype.byteLengthï¼šè¿”å›å æ®çš„å†…å­˜å­—èŠ‚é•¿åº¦</li><li>DataView.prototype.byteOffsetï¼šè¿”å›å½“å‰è§†å›¾ä»å¯¹åº”çš„ArrayBufferå¯¹è±¡çš„å“ªä¸ªå­—èŠ‚å¼€å§‹</li></ul><p>DataViewå®ä¾‹æä¾›8ä¸ªæ–¹æ³•è¯»å–å†…å­˜ã€‚</p><ul><li>getInt8ï¼šè¯»å–1ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª8ä½æ•´æ•°ã€‚</li><li>getUint8ï¼šè¯»å–1ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ªæ— ç¬¦å·çš„8ä½æ•´æ•°ã€‚</li><li>getInt16ï¼šè¯»å–2ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª16ä½æ•´æ•°ã€‚</li><li>getUint16ï¼šè¯»å–2ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ªæ— ç¬¦å·çš„16ä½æ•´æ•°ã€‚</li><li>getInt32ï¼šè¯»å–4ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª32ä½æ•´æ•°ã€‚</li><li>getUint32ï¼šè¯»å–4ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ªæ— ç¬¦å·çš„32ä½æ•´æ•°ã€‚</li><li>getFloat32ï¼šè¯»å–4ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª32ä½æµ®ç‚¹æ•°ã€‚</li><li>getFloat64ï¼šè¯»å–8ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸€ä¸ª64ä½æµ®ç‚¹æ•°ã€‚</li></ul><p>è¿™ä¸€ç³»åˆ—getæ–¹æ³•çš„å‚æ•°éƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚åºå·ï¼ˆä¸èƒ½æ˜¯è´Ÿæ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼‰ï¼Œè¡¨ç¤ºä»å“ªä¸ªå­—èŠ‚å¼€å§‹è¯»å–ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var buffer = new ArrayBuffer(24);</span><br><span class="line">var dv = new DataView(buffer);</span><br><span class="line"></span><br><span class="line">// ä»ç¬¬1ä¸ªå­—èŠ‚è¯»å–ä¸€ä¸ª8ä½æ— ç¬¦å·æ•´æ•°</span><br><span class="line">var v1 = dv.getUint8(0);</span><br><span class="line"></span><br><span class="line">// ä»ç¬¬2ä¸ªå­—èŠ‚è¯»å–ä¸€ä¸ª16ä½æ— ç¬¦å·æ•´æ•°</span><br><span class="line">var v2 = dv.getUint16(1);</span><br><span class="line"></span><br><span class="line">// ä»ç¬¬4ä¸ªå­—èŠ‚è¯»å–ä¸€ä¸ª16ä½æ— ç¬¦å·æ•´æ•°</span><br><span class="line">var v3 = dv.getUint16(3);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç è¯»å–äº†ArrayBufferå¯¹è±¡çš„å‰5ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª8ä½æ•´æ•°å’Œä¸¤ä¸ªåå…­ä½æ•´æ•°ã€‚</p><p>å¦‚æœä¸€æ¬¡è¯»å–ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šå­—èŠ‚ï¼Œå°±å¿…é¡»æ˜ç¡®æ•°æ®çš„å­˜å‚¨æ–¹å¼ï¼Œåˆ°åº•æ˜¯å°ç«¯å­—èŠ‚åºè¿˜æ˜¯å¤§ç«¯å­—èŠ‚åºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDataViewçš„getæ–¹æ³•ä½¿ç”¨å¤§ç«¯å­—èŠ‚åºè§£è¯»æ•°æ®ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å°ç«¯å­—èŠ‚åºè§£è¯»ï¼Œå¿…é¡»åœ¨getæ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®štrueã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// å°ç«¯å­—èŠ‚åº</span><br><span class="line">var v1 = dv.getUint16(1, true);</span><br><span class="line"></span><br><span class="line">// å¤§ç«¯å­—èŠ‚åº</span><br><span class="line">var v2 = dv.getUint16(3, false);</span><br><span class="line"></span><br><span class="line">// å¤§ç«¯å­—èŠ‚åº</span><br><span class="line">var v3 = dv.getUint16(3);</span><br></pre></td></tr></table></figure><p>DataViewè§†å›¾æä¾›8ä¸ªæ–¹æ³•å†™å…¥å†…å­˜ã€‚</p><ul><li>setInt8ï¼šå†™å…¥1ä¸ªå­—èŠ‚çš„8ä½æ•´æ•°ã€‚</li><li>setUint8ï¼šå†™å…¥1ä¸ªå­—èŠ‚çš„8ä½æ— ç¬¦å·æ•´æ•°ã€‚</li><li>setInt16ï¼šå†™å…¥2ä¸ªå­—èŠ‚çš„16ä½æ•´æ•°ã€‚</li><li>setUint16ï¼šå†™å…¥2ä¸ªå­—èŠ‚çš„16ä½æ— ç¬¦å·æ•´æ•°ã€‚</li><li>setInt32ï¼šå†™å…¥4ä¸ªå­—èŠ‚çš„32ä½æ•´æ•°ã€‚</li><li>setUint32ï¼šå†™å…¥4ä¸ªå­—èŠ‚çš„32ä½æ— ç¬¦å·æ•´æ•°ã€‚</li><li>setFloat32ï¼šå†™å…¥4ä¸ªå­—èŠ‚çš„32ä½æµ®ç‚¹æ•°ã€‚</li><li>setFloat64ï¼šå†™å…¥8ä¸ªå­—èŠ‚çš„64ä½æµ®ç‚¹æ•°ã€‚</li></ul><p>è¿™ä¸€ç³»åˆ—setæ–¹æ³•ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—èŠ‚åºå·ï¼Œè¡¨ç¤ºä»å“ªä¸ªå­—èŠ‚å¼€å§‹å†™å…¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå†™å…¥çš„æ•°æ®ã€‚å¯¹äºé‚£äº›å†™å…¥ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šå­—èŠ‚çš„æ–¹æ³•ï¼Œéœ€è¦æŒ‡å®šç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œfalseæˆ–è€…undefinedè¡¨ç¤ºä½¿ç”¨å¤§ç«¯å­—èŠ‚åºå†™å…¥ï¼Œtrueè¡¨ç¤ºä½¿ç”¨å°ç«¯å­—èŠ‚åºå†™å…¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨ç¬¬1ä¸ªå­—èŠ‚ï¼Œä»¥å¤§ç«¯å­—èŠ‚åºå†™å…¥å€¼ä¸º25çš„32ä½æ•´æ•°</span><br><span class="line">dv.setInt32(0, 25, false);</span><br><span class="line"></span><br><span class="line">// åœ¨ç¬¬5ä¸ªå­—èŠ‚ï¼Œä»¥å¤§ç«¯å­—èŠ‚åºå†™å…¥å€¼ä¸º25çš„32ä½æ•´æ•°</span><br><span class="line">dv.setInt32(4, 25);</span><br><span class="line"></span><br><span class="line">// åœ¨ç¬¬9ä¸ªå­—èŠ‚ï¼Œä»¥å°ç«¯å­—èŠ‚åºå†™å…¥å€¼ä¸º2.5çš„32ä½æµ®ç‚¹æ•°</span><br><span class="line">dv.setFloat32(8, 2.5, true);</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸ç¡®å®šæ­£åœ¨ä½¿ç”¨çš„è®¡ç®—æœºçš„å­—èŠ‚åºï¼Œå¯ä»¥é‡‡ç”¨ä¸‹é¢çš„åˆ¤æ–­æ–¹å¼ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var littleEndian = (function() &#123;</span><br><span class="line">  var buffer = new ArrayBuffer(2);</span><br><span class="line">  new DataView(buffer).setInt16(0, 256, true);</span><br><span class="line">  return new Int16Array(buffer)[0] === 256;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><h4 id="Blob"><a href="#Blob" class="headerlink" title="Blob"></a>Blob</h4><p>Blob å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªä¸å¯å˜ã€åŸå§‹æ•°æ®çš„ç±»æ–‡ä»¶å¯¹è±¡ã€‚Blob è¡¨ç¤ºçš„ä¸ä¸€å®šæ˜¯JavaScriptåŸç”Ÿæ ¼å¼çš„æ•°æ®ã€‚File æ¥å£åŸºäºBlobï¼Œç»§æ‰¿äº† blob çš„åŠŸèƒ½å¹¶å°†å…¶æ‰©å±•ä½¿å…¶æ”¯æŒç”¨æˆ·ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚</p><p>è¦ä»å…¶ä»–éblobå¯¹è±¡å’Œæ•°æ®æ„é€ ä¸€ä¸ªBlobï¼Œè¯·ä½¿ç”¨ Blob() æ„é€ å‡½æ•°ã€‚è¦åˆ›å»ºåŒ…å«å¦ä¸€ä¸ªblobæ•°æ®çš„å­é›†blobï¼Œè¯·ä½¿ç”¨ slice()æ–¹æ³•ã€‚è¦è·å–ç”¨æˆ·æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶å¯¹åº”çš„Blobå¯¹è±¡ï¼Œè¯·å‚é˜… Fileæ–‡æ¡£ã€‚</p><p>ä»Blobä¸­è¯»å–å†…å®¹çš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿ç”¨ FileReaderã€‚ä»¥ä¸‹ä»£ç å°† Blob çš„å†…å®¹ä½œä¸ºç±»å‹æ•°ç»„è¯»å–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var reader = new FileReader();</span><br><span class="line">reader.addEventListener(&quot;loadend&quot;, function() &#123;</span><br><span class="line">   // reader.result åŒ…å«è½¬åŒ–ä¸ºç±»å‹æ•°ç»„çš„blob</span><br><span class="line">&#125;);</span><br><span class="line">reader.readAsArrayBuffer(blob);</span><br></pre></td></tr></table></figure><p>æ›´å¤šå…³äºBlobçš„å†…å®¹ï¼Œè¯·ç›´æ¥æŸ¥çœ‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob" target="_blank" rel="noopener">è¿™é‡Œ</a></p><h3 id="æ•°æ®æ ¼å¼è½¬æ¢"><a href="#æ•°æ®æ ¼å¼è½¬æ¢" class="headerlink" title="æ•°æ®æ ¼å¼è½¬æ¢"></a>æ•°æ®æ ¼å¼è½¬æ¢</h3><h4 id="Stringè½¬Blob"><a href="#Stringè½¬Blob" class="headerlink" title="Stringè½¬Blob"></a>Stringè½¬Blob</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//å°†å­—ç¬¦ä¸² è½¬æ¢æˆ Blob å¯¹è±¡</span><br><span class="line">var blob = new Blob([&quot;Hello World!&quot;], &#123;</span><br><span class="line">    type: &apos;text/plain&apos;</span><br><span class="line">&#125;);</span><br><span class="line">console.info(blob);</span><br><span class="line">console.info(blob.slice(1, 3, &apos;text/plain&apos;));</span><br></pre></td></tr></table></figure><h4 id="TypeArrayè½¬Blob"><a href="#TypeArrayè½¬Blob" class="headerlink" title="TypeArrayè½¬Blob"></a>TypeArrayè½¬Blob</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//å°† TypeArray  è½¬æ¢æˆ Blob å¯¹è±¡</span><br><span class="line">var array = new Uint16Array([97, 32, 72, 101, 108, 108, 111, 32, 119, 111, 114, 108, 100, 33]);</span><br><span class="line">//æµ‹è¯•æˆåŠŸ</span><br><span class="line">//var blob = new Blob([array], &#123; type: &quot;application/octet-binary&quot; &#125;);</span><br><span class="line">//æµ‹è¯•æˆåŠŸï¼Œ æ³¨æ„å¿…é¡»[]çš„åŒ…è£¹</span><br><span class="line">var blob = new Blob([array]);</span><br><span class="line">//å°† Blobå¯¹è±¡ è¯»æˆå­—ç¬¦ä¸²</span><br><span class="line">var reader = new FileReader();</span><br><span class="line">reader.readAsText(blob, &apos;utf-8&apos;);</span><br><span class="line">reader.onload = function (e) &#123;</span><br><span class="line">    console.info(reader.result); //a Hello world!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ArrayBufferè½¬Blob"><a href="#ArrayBufferè½¬Blob" class="headerlink" title="ArrayBufferè½¬Blob"></a>ArrayBufferè½¬Blob</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var buffer = new ArrayBuffer(32);</span><br><span class="line">var blob = new Blob([buffer]);       // æ³¨æ„å¿…é¡»åŒ…è£¹[]</span><br></pre></td></tr></table></figure><h4 id="Blobè½¬String"><a href="#Blobè½¬String" class="headerlink" title="Blobè½¬String"></a>Blobè½¬String</h4><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯readAsTextæ–¹æ³•çš„ä½¿ç”¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//å°†å­—ç¬¦ä¸²è½¬æ¢æˆ Blobå¯¹è±¡</span><br><span class="line">var blob = new Blob([&apos;ä¸­æ–‡å­—ç¬¦ä¸²&apos;], &#123;</span><br><span class="line">    type: &apos;text/plain&apos;</span><br><span class="line">&#125;);</span><br><span class="line">//å°†Blob å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²</span><br><span class="line">var reader = new FileReader();</span><br><span class="line">reader.readAsText(blob, &apos;utf-8&apos;);</span><br><span class="line">reader.onload = function (e) &#123;</span><br><span class="line">    console.info(reader.result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Blobè½¬ArrayBuffer"><a href="#Blobè½¬ArrayBuffer" class="headerlink" title="Blobè½¬ArrayBuffer"></a>Blobè½¬ArrayBuffer</h4><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯readAsArrayBufferæ–¹æ³•çš„ä½¿ç”¨ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//å°†å­—ç¬¦ä¸²è½¬æ¢æˆ Blobå¯¹è±¡</span><br><span class="line">var blob = new Blob([&apos;ä¸­æ–‡å­—ç¬¦ä¸²&apos;], &#123;</span><br><span class="line">    type: &apos;text/plain&apos;</span><br><span class="line">&#125;);</span><br><span class="line">//å°†Blob å¯¹è±¡è½¬æ¢æˆ ArrayBuffer</span><br><span class="line">var reader = new FileReader();</span><br><span class="line">reader.readAsArrayBuffer(blob);</span><br><span class="line">reader.onload = function (e) &#123;</span><br><span class="line">    console.info(reader.result); //ArrayBuffer &#123;&#125;</span><br><span class="line">    //ç»å¸¸ä¼šé‡åˆ°çš„å¼‚å¸¸ Uncaught RangeError: byte length of Int16Array should be a multiple of 2</span><br><span class="line">    //var buf = new int16array(reader.result);</span><br><span class="line">    //console.info(buf);</span><br><span class="line"></span><br><span class="line">    //å°† ArrayBufferView  è½¬æ¢æˆBlob</span><br><span class="line">    var buf = new Uint8Array(reader.result);</span><br><span class="line">    console.info(buf); //[228, 184, 173, 230, 150, 135, 229, 173, 151, 231, 172, 166, 228, 184, 178]</span><br><span class="line">    reader.readAsText(new Blob([buf]), &apos;utf-8&apos;);</span><br><span class="line">    reader.onload = function () &#123;</span><br><span class="line">        console.info(reader.result); //ä¸­æ–‡å­—ç¬¦ä¸²</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    //å°† ArrayBufferView  è½¬æ¢æˆBlob</span><br><span class="line">    var buf = new DataView(reader.result);</span><br><span class="line">    console.info(buf); //DataView &#123;&#125;</span><br><span class="line">    reader.readAsText(new Blob([buf]), &apos;utf-8&apos;);</span><br><span class="line">    reader.onload = function () &#123;</span><br><span class="line">        console.info(reader.result); //ä¸­æ–‡å­—ç¬¦ä¸²</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinuxæœåŠ¡å™¨åˆå§‹åŒ–è®¾ç½®ç”¨æˆ·å’Œsshå…¬ç§é’¥ç™»é™†</title>
      <link href="/2018/04/11/Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E5%92%8Cssh%E5%85%AC%E7%A7%81%E9%92%A5%E7%99%BB%E9%99%86/"/>
      <url>/2018/04/11/Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E8%AE%BE%E7%BD%AE%E7%94%A8%E6%88%B7%E5%92%8Cssh%E5%85%AC%E7%A7%81%E9%92%A5%E7%99%BB%E9%99%86/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å½“æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ä¸€ä¸ªæ–°çš„æœåŠ¡å™¨çš„æ—¶å€™ï¼Œé¦–å…ˆä¸€å®šè¦å¯¹æœåŠ¡å™¨çš„ç™»é™†ç­‰åšä¸€äº›ä¿®æ”¹å·¥ä½œï¼Œç¬”è€…æ›¾ç»å°±å› ä¸ºå¯¹æœåŠ¡å™¨ç™»é™†å®‰å…¨æ²¡æœ‰é‡è§†ï¼Œå¯¼è‡´æœåŠ¡å™¨æ•°æ®å…¨éƒ¨ä¸¢å¤±ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æŒ‰ç…§æ­¥éª¤ï¼Œç½—åˆ—å‡ºåº”è¯¥åšçš„ä¸€äº›äº‹æƒ…ã€‚</p></blockquote><h3 id="ä¿®æ”¹sshç«¯å£å·"><a href="#ä¿®æ”¹sshç«¯å£å·" class="headerlink" title="ä¿®æ”¹sshç«¯å£å·"></a>ä¿®æ”¹sshç«¯å£å·</h3><p>ç¬¬ä¸€ä»¶äº‹æƒ…ï¼š</p><p>ä¿®æ”¹sshç«¯å£å·ï¼š ä¹‹ååŠ ä¸Šä¸€ä¸ªç«¯å£æ¯”å¦‚è¯´50000</p><p><code>vi /etc/ssh/sshd_config</code>ä¹‹ååœ¨portå­—æ®µåŠ ä¸Šä¸€ä¸ªç«¯å£æ¯”å¦‚è¯´50000ï¼ŒåŸæ¥çš„ç«¯å£å·å­—æ®µå¯èƒ½æ˜¯è¢«æ³¨é‡Šæ‰çš„ï¼Œè¦å…ˆè§£é™¤æ³¨é‡Šã€‚</p><p>ç„¶åæ‰§è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service sshd restart</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™å¯èƒ½è¿˜è¦é‡æ–°é…ç½®ä¸€ä¸‹é˜²ç«å¢™ï¼Œå¼€æ”¾50000ç«¯å£ï¼Œå…·ä½“å¦‚ä½•é…ç½®ä¹Ÿå¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/ul646691993/article/details/52104082" target="_blank" rel="noopener">è¿™é‡Œ</a>çš„ååŠéƒ¨åˆ†ã€‚ä½†æ˜¯ç›®å‰ï¼Œé˜¿é‡Œäº‘çš„æœåŠ¡å™¨å®æµ‹æ˜¯ä¸éœ€è¦å†é…ç½®é˜²ç«å¢™çš„ï¼Œä½†æ˜¯éœ€è¦å»ç™»é™†åˆ°ç½‘é¡µåå°ä¿®æ”¹å®‰å…¨ç»„ã€‚</p><p>ä¹‹åå°±å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼ç™»å½•äº†ï¼š(æ³¨æ„ç™»å½•æ–¹å¼ä¸€å®šè¦å†™å¯¹)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@115.29.102.81 -p 50000</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h3><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜æ˜¯ç”¨rootè¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸‹æ¥è¦ç»™è‡ªå·±åˆ›å»ºä¸€ä¸ªè´¦æˆ·ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªå¦‚ä¸‹çš„ç”¨æˆ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd xiaotao</span><br><span class="line">passwd xiaotao</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨<code>ls -al /home/`</code>æŸ¥çœ‹ä¸€ä¸‹è´¦æˆ·</p><p>å¯¹åˆ›å»ºçš„è¿™ä¸ªç”¨æˆ·å¢åŠ sudoæƒé™ï¼š ç›¸å…³é…ç½®æ–‡ä»¶/etc/sudoersä¸­ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶æ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥è¦æ›´æ”¹ä¸€ä¸‹æƒé™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u+w sudoers</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›å…¥è¿™ä¸ªæ–‡ä»¶åœ¨è¿™é‡Œè¿›è¡Œæ›´æ”¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root    ALL=(ALL)       ALL</span><br><span class="line">xiaotao  ALL=(ALL)       ALL</span><br></pre></td></tr></table></figure><p>ç„¶åå†æ”¹å›æƒé™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u-w sudoers</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸€ç‚¹ï¼ŒCentOS 7é¢„è®¾å®¹è®¸ä»»ä½•å¸å·é€è¿‡sshç™»å…¥ï¼ˆä¹Ÿå°±æ˜¯è¯´è‡ªå·±æ ¹æœ¬ä¸ç”¨æ”¹æ”¹ï¼Œç›´æ¥æ–°å»ºå¸å·ç™»å½•å³å¯ï¼‰ï¼ŒåŒ…æ‹¬æ ¹å’Œä¸€èˆ¬å¸å·ï¼Œä¸ºäº†ä¸å—æ ¹å¸å·è¢«é»‘å®¢æš´åŠ›å…¥ä¾µï¼Œæˆ‘ä»¬å¿…é¡»ç¦æ­¢ rootå¸å·çš„sshåŠŸèƒ½ï¼Œäº‹å®ä¸Šrootä¹Ÿæ²¡æœ‰å¿…è¦sshç™»å…¥ä¼ºæœå™¨ï¼Œå› ä¸ºåªè¦ä½¿ç”¨suæˆ–sudoï¼ˆå½“ç„¶éœ€è¦è¾“å…¥rootçš„å¯†ç ï¼‰æ™®é€šå¸å·ä¾¿å¯ä»¥æ‹¥æœ‰rootçš„æƒé™ã€‚ä½¿ç”¨vimï¼ˆæˆ–ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨ï¼‰å¼€å¯çš„/ etc/ SSH/ sshd_configä¸­ï¼Œå¯»æ‰¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ï¼ƒPermitRootLogin yes</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin no</span><br></pre></td></tr></table></figure><h3 id="é…ç½®å…¬ç§é’¥åŠ å¯†ç™»å½•"><a href="#é…ç½®å…¬ç§é’¥åŠ å¯†ç™»å½•" class="headerlink" title="é…ç½®å…¬ç§é’¥åŠ å¯†ç™»å½•"></a>é…ç½®å…¬ç§é’¥åŠ å¯†ç™»å½•</h3><p><strong>è¿™ä¸€æ­¥éª¤è¦åˆ‡æ¢åˆ°è‡ªå·±æ–°å»ºçš„ç”¨æˆ·ï¼Œä¸èƒ½å†ç”¨ root ç”¨æˆ·äº†ï¼Œå¦åˆ™å¯èƒ½æ— æ³•æ­£å¸¸ç™»é™†ã€‚</strong></p><p>å¾ˆå¤šæ—¶å€™ä»¥ä¸Šæ‰€è¯´çš„è¿˜æ˜¯ä¸å¤Ÿå®‰å…¨ï¼Œä¸ºäº†æ›´åŠ å®‰å…¨æ–¹ä¾¿ï¼Œæˆ‘ä»¬é‡‡ç”¨å…¬ç§é’¥å¯¹ç§°åŠ å¯†ç™»å½•ï¼Œç®€å•çš„è®²åšæ³•å°±æ˜¯å†å®¢æˆ·ç«¯ç”Ÿæˆä¸€æŠŠç§é’¥ä¸€æŠŠå…¬é’¥ï¼Œç§é’¥æ˜¯åœ¨å®¢æˆ·ç«¯çš„ï¼Œå…¬é’¥ä¸Šä¼ åˆ°æœåŠ¡ç«¯ï¼Œå¯¹ç§°åŠ å¯†è¿›è¡Œç™»å½•ã€‚</p><p>åœ¨å®¢æˆ·ç«¯å…ˆè¿›åˆ°è¿™ä¸ªç›®å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.ssh</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼ˆå®é™…ä¸Šå¦‚æœä¹‹å‰æœ‰çš„è¯å°±ä¸ç”¨é‡æ–°ç”Ÿæˆäº†ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æŠŠå…¬é’¥ä¸Šä¼ åˆ°æœåŠ¡ç«¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ~/.ssh/id_rsa.pub xiaotao@&lt;ssh_server_ip&gt;:~</span><br></pre></td></tr></table></figure><p>åœ¨æœåŠ¡ç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤(å¦‚æœæ²¡æœ‰ç›¸å…³çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹è¦å…ˆè¿›è¡Œåˆ›å»ºï¼Œæ³¨æ„ä¸è¦ä½¿ç”¨ sudo )</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat  id_rsa.pub &gt;&gt; ï½/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>é…ç½®æœåŠ¡å™¨çš„/etc/ssh/sshd_configï¼Œä¸‹é¢æ˜¯ä¸€äº›å»ºè®®çš„é…ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"># ç¦ç”¨rootè´¦æˆ·ç™»å½•ï¼Œéå¿…è¦ï¼Œä½†ä¸ºäº†å®‰å…¨æ€§ï¼Œè¯·é…ç½®</span><br><span class="line">PermitRootLogin no</span><br><span class="line"></span><br><span class="line"># æ˜¯å¦è®© sshd å»æ£€æŸ¥ç”¨æˆ·å®¶ç›®å½•æˆ–ç›¸å…³æ¡£æ¡ˆçš„æƒé™æ•°æ®ï¼Œ</span><br><span class="line"># è¿™æ˜¯ä¸ºäº†æ‹…å¿ƒä½¿ç”¨è€…å°†æŸäº›é‡è¦æ¡£æ¡ˆçš„æƒé™è®¾é”™ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜æ‰€è‡´ã€‚</span><br><span class="line"># ä¾‹å¦‚ä½¿ç”¨è€…çš„ ~.ssh/ æƒé™è®¾é”™æ—¶ï¼ŒæŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ä¼šä¸è®¸ç”¨æˆ·ç™»å…¥</span><br><span class="line">StrictModes no</span><br><span class="line"></span><br><span class="line"># æ˜¯å¦å…è®¸ç”¨æˆ·è‡ªè¡Œä½¿ç”¨æˆå¯¹çš„å¯†é’¥ç³»ç»Ÿè¿›è¡Œç™»å…¥è¡Œä¸ºï¼Œä»…é’ˆå¯¹ version 2ã€‚</span><br><span class="line"># è‡³äºè‡ªåˆ¶çš„å…¬é’¥æ•°æ®å°±æ”¾ç½®äºç”¨æˆ·å®¶ç›®å½•ä¸‹çš„ .ssh/authorized_keys å†…</span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line">AuthorizedKeysFile      %h/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line">#æœ‰äº†è¯ä¹¦ç™»å½•äº†ï¼Œå°±ç¦ç”¨å¯†ç ç™»å½•å§ï¼Œå®‰å…¨è¦ç´§</span><br><span class="line">PasswordAuthentication no</span><br></pre></td></tr></table></figure><p>ç„¶åä¸è¦å¿˜è®° <code>sudo service sshd restart</code></p><p>ä¸€èˆ¬æ¥è®²ï¼Œè¿™æ ·å°±ç®—æ˜¯æˆåŠŸäº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å®¢æˆ·ç«¯å°è¯•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i ~/.ssh/id_rsa remote_username@remote_ip</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸è¡Œï¼Œå¯èƒ½æ˜¯æœåŠ¡ç«¯æˆ–å®¢æˆ·ç«¯ç›¸å…³ <code>.ssh</code> æ–‡ä»¶æƒé™ä¸å¯¹ï¼Œå¯ä»¥è¿›è¡Œå¦‚ä¸‹å°è¯•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">æœåŠ¡ç«¯</span><br><span class="line">chown -R 0700  ~/.ssh</span><br><span class="line">chown -R 0644  ~/.ssh/authorized_keys</span><br><span class="line"></span><br><span class="line">å®¢æˆ·ç«¯æ”¹ä¸€ä¸‹</span><br><span class="line">chmod 600 id_rsa</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> ssh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ„å»ºåˆ©ç”¨Proxyå’ŒReflectå®ç°åŒå‘æ•°æ®ç»‘å®šçš„å¾®æ¡†æ¶</title>
      <link href="/2018/04/08/%E6%9E%84%E5%BB%BA%E5%88%A9%E7%94%A8Proxy%E5%92%8CReflect%E5%AE%9E%E7%8E%B0%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E7%9A%84%E5%BE%AE%E6%A1%86%E6%9E%B6/"/>
      <url>/2018/04/08/%E6%9E%84%E5%BB%BA%E5%88%A9%E7%94%A8Proxy%E5%92%8CReflect%E5%AE%9E%E7%8E%B0%E5%8F%8C%E5%90%91%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E7%9A%84%E5%BE%AE%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å†™åœ¨å‰é¢ï¼šè¿™ç¯‡æ–‡ç« è®²è¿°äº†å¦‚ä½•åˆ©ç”¨Proxyå’ŒReflectå®ç°åŒå‘æ•°æ®ç»‘å®šï¼Œä¸ªäººç³»Vueæ—©æœŸç©å®¶ï¼Œå†™è¿™ä¸ªå°æ¡†æ¶çš„æ—¶å€™ä¹Ÿæ²¡æœ‰å‚è€ƒVueç­‰æºä»£ç ï¼Œä¹‹å‰äº†è§£è¿‡å…¶ä»–å®ç°ï¼Œä½†æ²¡æœ‰ç›´æ¥å‚è€ƒå…¶ä»–ä»£ç ï¼Œå¦‚æœ‰é›·åŒï¼Œçº¯å±å·§åˆã€‚</p></blockquote><p>ä»£ç ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/aircloud/Polar.js" target="_blank" rel="noopener">è¿™é‡Œä¸‹è½½</a></p><h3 id="ç»¼è¿°"><a href="#ç»¼è¿°" class="headerlink" title="ç»¼è¿°"></a>ç»¼è¿°</h3><p><em>å…³äºProxyå’ŒReflectçš„èµ„æ–™æ¨èé˜®è€å¸ˆçš„æ•™ç¨‹:<a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener">http://es6.ruanyifeng.com/</a> è¿™é‡Œä¸åšè¿‡å¤šä»‹ç»ã€‚</em></p><p>å®ç°åŒå‘æ•°æ®ç»‘å®šçš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¹Ÿå¯ä»¥å‚è€ƒæœ¬ä¸“æ ä¹‹å‰çš„å…¶ä»–å®ç°ï¼Œæˆ‘ä¹‹æ‰€ä»¥é€‰æ‹©ç”¨Proxyå’ŒReflectï¼Œä¸€æ–¹é¢æ˜¯å› ä¸ºå¯ä»¥å¤§é‡èŠ‚çº¦ä»£ç ï¼Œå¹¶ä¸”ç®€åŒ–é€»è¾‘ï¼Œå¯ä»¥è®©æˆ‘æŠŠæ›´å¤šçš„ç»å†æ”¾åœ¨å…¶ä»–å†…å®¹çš„æ„å»ºä¸Šé¢ï¼Œå¦å¤–ä¸€æ–¹é¢æœ¬é¡¹ç›®ç›´æ¥åŸºäºES6ï¼Œç”¨è¿™äº›å†…å®¹ä¹Ÿç¬¦åˆé¢å‘æœªæ¥çš„JSç¼–ç¨‹è§„èŒƒï¼Œç¬¬ä¸‰ç‚¹æœ€åè¯´ã€‚</p><p>ç”±äºè¿™ä¸ªå°æ¡†æ¶æ˜¯è‡ªå·±åœ¨PolarBearè¿™ä¸ªå’–å•¡é¦†åœ¨ä¸€ä¸ªå®‰é™çš„åˆåå¼€å§‹å†™æˆï¼Œæš‚ä¸”èµ·åPolarï¼Œæ—¥åå¸Œæœ›æˆ‘èƒ½ç»§ç»­å®Œå–„è¿™ä¸ªå°æ¡†æ¶ï¼Œç»™æ·»åŠ ä¸Šæ›´å¤šæœ‰è¶£çš„åŠŸèƒ½ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥çœ‹æ•´ä½“åŠŸèƒ½æ¼”ç¤ºï¼š<br>[ä¸€ä¸ªgifåŠ¨å›¾ï¼Œå¦‚æœä¸èƒ½çœ‹ï¼Œè¯·ç‚¹å‡»<a href="https://www.10000h.top/images/data_img/gif1.gif" target="_blank" rel="noopener">è¿™é‡Œçš„é“¾æ¥</a>]</p><p><img src="https://www.10000h.top/images/data_img/gif1.gif" alt></p><h3 id="ä»£ç åˆ†æ"><a href="#ä»£ç åˆ†æ" class="headerlink" title="ä»£ç åˆ†æ"></a>ä»£ç åˆ†æ</h3><p>æˆ‘ä»¬è¦åšè¿™æ ·ä¸€ä¸ªå°æ¡†æ¶ï¼Œæ ¸å¿ƒæ˜¯è¦ç›‘å¬æ•°æ®çš„æ”¹å˜ï¼Œå¹¶ä¸”åœ¨æ•°æ®çš„æ”¹å˜çš„æ—¶å€™è¿›è¡Œä¸€äº›æ“ä½œï¼Œä»è€Œç»´æŒæ•°æ®çš„ä¸€è‡´ã€‚</p><p>æˆ‘çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>å°†æ‰€æœ‰çš„æ•°æ®ä¿¡æ¯æ”¾åœ¨ä¸€ä¸ªå±æ€§å¯¹è±¡ä¸­(this._data),ä¹‹åç»™è¿™ä¸ªå±æ€§å¯¹è±¡ç”¨ProxyåŒ…è£…set,åœ¨ä»£ç†å‡½æ•°ä¸­æˆ‘ä»¬æ›´æ–°å±æ€§å¯¹è±¡çš„å…·ä½“å†…å®¹ï¼ŒåŒæ—¶é€šçŸ¥æ‰€æœ‰ç›‘å¬è€…ï¼Œä¹‹åè¿”å›æ–°çš„ä»£ç†å¯¹è±¡(this.data)ï¼Œæˆ‘ä»¬ä¹‹åæ“ä½œçš„éƒ½æ˜¯æ–°çš„ä»£ç†å¯¹è±¡ã€‚</li><li>å¯¹äºinputç­‰è¡¨å•ï¼Œæˆ‘ä»¬éœ€è¦ç›‘å¬inputäº‹ä»¶ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­ç›´æ¥è®¾ç½®æˆ‘ä»¬ä»£ç†å¥½çš„æ•°æ®å¯¹è±¡ï¼Œä»è€Œè§¦å‘æˆ‘ä»¬çš„ä»£ç†å‡½æ•°ã€‚</li><li>æˆ‘ä»¬åŒæ—¶ä¹Ÿåº”è¯¥æ”¯æŒäº‹ä»¶æœºåˆ¶ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥æœ€å¸¸ç”¨çš„clickæ–¹æ³•ä½œä¸ºä¾‹å­å®ç°ã€‚</li></ul><p>ä¸‹é¢å¼€å§‹ç¬¬ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬ä¹‹åä½¿ç”¨è¿™ä¸ªåº“çš„æ—¶å€™å¯ä»¥è¿™æ ·è°ƒç”¨:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;form&gt;</span><br><span class="line">        &lt;label&gt;name:&lt;/label&gt;</span><br><span class="line">        &lt;input p-model = &quot;name&quot; /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;div&gt;name:&#123;&#123;name&#125;&#125; age:&#123;&#123;age&#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;i&gt;note:&#123;&#123;note&#125;&#125;&lt;/i&gt;&lt;br/&gt;</span><br><span class="line">    &lt;button p-click=&quot;test(2)&quot;&gt;button1&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line"> var myPolar = new Polar(&#123;</span><br><span class="line">        el:&quot;#app&quot;,</span><br><span class="line">        data: &#123;</span><br><span class="line">            name: &quot;niexiaotao&quot;,</span><br><span class="line">            age:16,</span><br><span class="line">            note:&quot;Student of Zhejiang University&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line">            test:function(e,addNumber)&#123;</span><br><span class="line">                console.log(&quot;e:&quot;,e);</span><br><span class="line">                this.data.age+=Number(addNumber);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>æ²¡é”™ï¼Œå’ŒVueç¥ä¼¼å§ï¼Œæ‰€ä»¥è¿™ç§è°ƒç”¨æ–¹å¼åº”å½“ä¸ºæˆ‘ä»¬æ‰€ç†Ÿæ‚‰ã€‚</p><p>æˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªPolarç±»ï¼Œè¿™ä¸ªç±»çš„æ„é€ å‡½æ•°åº”è¯¥è¿›è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> constructor(configs)&#123;</span><br><span class="line">        this.root = this.el = document.querySelector(configs.el);</span><br><span class="line">        this._data = configs.data;</span><br><span class="line">        this._data.__bindings = &#123;&#125;;</span><br><span class="line">        //åˆ›å»ºä»£ç†å¯¹è±¡</span><br><span class="line">        this.data = new Proxy(this._data, &#123;set&#125;);</span><br><span class="line">        this.methods = configs.methods;</span><br><span class="line"></span><br><span class="line">        this._compile(this.root);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé¢çš„ä¸€éƒ¨ä»½å†…å®¹æ˜¯ç›´æ¥å°†æˆ‘ä»¬ä¼ å…¥çš„configsæŒ‰ç…§å±æ€§åˆ†åˆ«èµ‹å€¼ï¼Œå¦å¤–å°±æ˜¯æˆ‘ä»¬åˆ›å»ºä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ï¼Œæœ€åçš„<code>_compile</code>æ–¹æ³•å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç§æœ‰çš„åˆå§‹åŒ–æ–¹æ³•ã€‚</p><p>å®é™…ä¸Šæˆ‘æŠŠå‰©ä¸‹çš„å†…å®¹å‡ ä¹éƒ½æ”¾åœ¨<code>_compile</code>æ–¹æ³•é‡Œé¢äº†ï¼Œè¿™æ ·ç†è§£èµ·æ¥æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹‹åå¯èƒ½è¦æ”¹åŠ¨ã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯å…ˆä¸èƒ½çœ‹æˆ‘ä»¬ä»£ç†çš„setè¯¥æ€ä¹ˆå†™ï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜è¦å…ˆç»§ç»­æ¢³ç†æ€è·¯ï¼š</p><p>å‡è®¾æˆ‘ä»¬è¿™æ ·<code>&lt;div&gt;name:&lt;/div&gt;</code>å°†æ•°æ®ç»‘å®šåˆ°domèŠ‚ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦åšä»€ä¹ˆå‘¢ï¼Œæˆ–è€…è¯´ï¼Œæˆ‘ä»¬é€šè¿‡ä»€ä¹ˆæ–¹å¼è®©domèŠ‚ç‚¹å’Œæ•°æ®å¯¹åº”èµ·æ¥ï¼Œéšç€æ•°æ®æ”¹å˜è€Œæ”¹å˜ã€‚</p><p>çœ‹ä¸Šæ–‡çš„<code>__bindings</code>ã€‚è¿™ä¸ªå¯¹è±¡ç”¨æ¥å­˜å‚¨æ‰€æœ‰ç»‘å®šçš„domèŠ‚ç‚¹ä¿¡æ¯ï¼Œ<code>__bindings</code>æœ¬èº«æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯ä¸€ä¸ªæœ‰å¯¹åº”domèŠ‚ç‚¹ç»‘å®šçš„æ•°æ®åç§°éƒ½æ˜¯å®ƒçš„å±æ€§ï¼Œå¯¹åº”ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå†…å®¹éƒ½æ˜¯ä¸€ä¸ªç»‘å®šä¿¡æ¯ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬åœ¨è‡ªå·±å†™çš„setä»£ç†å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªè°ƒç”¨è¿‡å»ï¼Œå°±å¯ä»¥æ›´æ–°å†…å®¹äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataSet.__bindings[key].forEach(function(item)&#123;</span><br><span class="line">       //do something to update...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªç”¨äºæ„é€ è°ƒç”¨çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ç”¨äºåˆ›å»ºå­˜å‚¨ç»‘å®šä¿¡æ¯çš„å¯¹è±¡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function Directive(el,polar,attr,elementValue)&#123;</span><br><span class="line">    this.el=el;//å…ƒç´ æœ¬èº«domèŠ‚ç‚¹</span><br><span class="line">    this.polar = polar;//å¯¹åº”çš„polarå®ä¾‹</span><br><span class="line">    this.attr = attr;//å…ƒç´ çš„è¢«ç»‘å®šçš„å±æ€§å€¼ï¼Œæ¯”å¦‚å¦‚æœæ˜¯æ–‡æœ¬èŠ‚ç‚¹å°±å¯ä»¥æ˜¯nodeValue</span><br><span class="line">    this.el[this.attr] = this.elementValue = elementValue;//åˆå§‹åŒ–</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„setå¯ä»¥è¿™æ ·å†™:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function set(target, key, value, receiver) &#123;</span><br><span class="line">    const result = Reflect.set(target, key, value, receiver);</span><br><span class="line">    var dataSet = receiver || target;</span><br><span class="line">    dataSet.__bindings[key].forEach(function(item)&#123;</span><br><span class="line">        item.el[item.attr] = item.elementValue = value;</span><br><span class="line">    &#125;);</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¯èƒ½è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬çš„<code></code>å®é™…ä¸Šåªæ˜¯èŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†ï¼Œè¿™å¹¶ä¸æ˜¯èŠ‚ç‚¹å•Šï¼Œå¦å¤–æˆ‘ä»¬æ˜¯ä¸æ˜¯è¿˜å¯ä»¥è¿™ä¹ˆå†™ï¼š<code>&lt;div&gt;name: age:&lt;/div&gt;</code>ï¼Ÿ</p><p>å…³äºè¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå‰è€…çš„ç­”æ¡ˆæ˜¯æˆ‘ä»¬å°†<code></code>æ›¿æ¢æˆä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ï¼Œè€Œä¸ºäº†åº”å¯¹åè€…çš„æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸¤ä¸ªè¢«ç»‘å®šæ•°æ®ä¸­é—´å’Œå‰åçš„å†…å®¹ï¼Œéƒ½å˜æˆæ–°çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œç„¶åè¿™äº›æ–‡æœ¬èŠ‚ç‚¹ç»„æˆæ–‡æœ¬èŠ‚ç‚¹ä¸²ã€‚(è¿™é‡Œå¤šè¯´ä¸€å¥ï¼Œhtml5çš„normalizeæ–¹æ³•å¯ä»¥å°†å¤šä¸ªæ–‡æœ¬èŠ‚ç‚¹åˆå¹¶æˆä¸€ä¸ªï¼Œå¦‚æœä¸å°å¿ƒè°ƒç”¨äº†å®ƒï¼Œé‚£æˆ‘ä»¬çš„ç¨‹åºå°±è¦GGäº†)</p><p>æ‰€ä»¥æˆ‘ä»¬åœ¨<code>_compile</code>å‡½æ•°é¦–å…ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">var _this = this;</span><br><span class="line"></span><br><span class="line">        var nodes = root.children;</span><br><span class="line"></span><br><span class="line">        var bindDataTester = new RegExp(&quot;&#123;&#123;(.*?)&#125;&#125;&quot;,&quot;ig&quot;);</span><br><span class="line"></span><br><span class="line">        for(let i=0;i&lt;nodes.length;i++)&#123;</span><br><span class="line">            var node=nodes[i];</span><br><span class="line"></span><br><span class="line">            //å¦‚æœè¿˜æœ‰htmlå­—èŠ‚ç‚¹ï¼Œåˆ™é€’å½’</span><br><span class="line">            if(node.children.length)&#123;</span><br><span class="line">                this._compile(node);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            var matches = node.innerHTML.match(bindDataTester);</span><br><span class="line">            if(matches)&#123;</span><br><span class="line">                var newMatches = matches.map(function (item) &#123;</span><br><span class="line">                    return  item.replace(/&#123;&#123;(.*?)&#125;&#125;/,&quot;$1&quot;)</span><br><span class="line">                &#125;);</span><br><span class="line">                var splitTextNodes  = node.innerHTML.split(/&#123;&#123;.*?&#125;&#125;/);</span><br><span class="line">                node.innerHTML=null;</span><br><span class="line">                //æ›´æ–°DOMï¼Œå¤„ç†åŒä¸€ä¸ªtextnodeé‡Œé¢å¤šæ¬¡ç»‘å®šæƒ…å†µ</span><br><span class="line">                if(splitTextNodes[0])&#123;</span><br><span class="line">                    node.append(document.createTextNode(splitTextNodes[0]));</span><br><span class="line">                &#125;</span><br><span class="line">                for(let ii=0;ii&lt;newMatches.length;ii++)&#123;</span><br><span class="line">                    var el = document.createTextNode(&apos;&apos;);</span><br><span class="line">                    node.appendChild(el);</span><br><span class="line">                    if(splitTextNodes[ii+1])&#123;</span><br><span class="line">                        node.append(document.createTextNode(splitTextNodes[ii+1]));</span><br><span class="line">                    &#125;</span><br><span class="line">                //å¯¹æ•°æ®å’Œdomè¿›è¡Œç»‘å®š</span><br><span class="line">                let returnCode = !this._data.__bindings[newMatches[ii]]?</span><br><span class="line">                    this._data.__bindings[newMatches[ii]] = [new Directive(el,this,&quot;nodeValue&quot;,this.data[newMatches[ii]])]</span><br><span class="line">                    :this._data.__bindings[newMatches[ii]].push(new Directive(el,this,&quot;nodeValue&quot;,this.data[newMatches[ii]]))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„æ•°æ®ç»‘å®šé˜¶æ®µå°±å†™å¥½äº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¤„ç†<code>&lt;input p-model = &quot;name&quot; /&gt;</code>è¿™æ ·çš„æƒ…å†µã€‚</p><p>è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡ä»¤ï¼Œæˆ‘ä»¬åªéœ€è¦å½“è¯†åˆ«åˆ°è¿™ä¸€ä¸ªæŒ‡ä»¤çš„æ—¶å€™ï¼Œåšä¸€äº›å¤„ç†ï¼Œå³å¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">if(node.hasAttribute((&quot;p-model&quot;))</span><br><span class="line">                &amp;&amp; node.tagName.toLocaleUpperCase()==&quot;INPUT&quot; || node.tagName.toLocaleUpperCase()==&quot;TEXTAREA&quot;)&#123;</span><br><span class="line">                node.addEventListener(&quot;input&quot;, (function () &#123;</span><br><span class="line"></span><br><span class="line">                    var attributeValue = node.getAttribute(&quot;p-model&quot;);</span><br><span class="line"></span><br><span class="line">                    if(_this._data.__bindings[attributeValue]) _this._data.__bindings[attributeValue].push(new Directive(node,_this,&quot;value&quot;,_this.data[attributeValue])) ;</span><br><span class="line">                    else _this._data.__bindings[attributeValue] = [new Directive(node,_this,&quot;value&quot;,_this.data[attributeValue])];</span><br><span class="line"></span><br><span class="line">                    return function (event) &#123;</span><br><span class="line">                        _this.data[attributeValue]=event.target.value</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œä¸Šé¢è°ƒç”¨äº†ä¸€ä¸ª<code>IIFE</code>ï¼Œå®é™…ç»‘å®šçš„å‡½æ•°åªæœ‰è¿”å›çš„å‡½æ•°é‚£ä¸€å°éƒ¨åˆ†ã€‚</p><p>æœ€åæˆ‘ä»¬å¤„ç†äº‹ä»¶çš„æƒ…å†µï¼š<code>&lt;button p-click=&quot;test(2)&quot;&gt;button1&lt;/button&gt;</code></p><p>å®é™…ä¸Šè¿™æ¯”å¤„ç†<code>p-model</code>è¿˜ç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ºäº†æ”¯æŒå‡½æ•°å‚æ•°çš„æƒ…å†µï¼Œå¤„ç†äº†ä¸€ä¸‹ä¼ å…¥å‚æ•°ï¼Œå¦å¤–æˆ‘å®é™…ä¸Šå°†<code>event</code>å§‹ç»ˆä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ï¼Œè¿™ä¹Ÿè®¸å¹¶ä¸æ˜¯å¥½çš„å®è·µï¼Œå› ä¸ºä½¿ç”¨çš„æ—¶å€™è¿˜è¦å¤šæ³¨æ„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">if(node.hasAttribute(&quot;p-click&quot;)) &#123;</span><br><span class="line">                node.addEventListener(&quot;click&quot;,function()&#123;</span><br><span class="line">                    var attributeValue=node.getAttribute(&quot;p-click&quot;);</span><br><span class="line">                    var args=/\(.*\)/.exec(attributeValue);</span><br><span class="line">                    //å…è®¸å‚æ•°</span><br><span class="line">                    if(args) &#123;</span><br><span class="line">                        args=args[0];</span><br><span class="line">                        attributeValue=attributeValue.replace(args,&quot;&quot;);</span><br><span class="line">                        args=args.replace(/[\(\)\&apos;\&quot;]/g,&apos;&apos;).split(&quot;,&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                    else args=[];</span><br><span class="line">                    return function (event) &#123;</span><br><span class="line">                        _this.methods[attributeValue].apply(_this,[event,...args]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å·²ç»å°†æ‰€æœ‰çš„ä»£ç åˆ†æå®Œäº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ¸…çˆ½ï¼Ÿä»£ç é™¤å»æ³¨é‡Šçº¦100è¡Œï¼Œæ‰€æœ‰æºä»£ç å¯ä»¥åœ¨<a href="https://github.com/aircloud/Polar.js" target="_blank" rel="noopener">è¿™é‡Œä¸‹è½½</a>ã€‚è¿™å½“ç„¶ä¸èƒ½ç®—ä½œä¸€ä¸ªæ¡†æ¶äº†ï¼Œä¸è¿‡å¯ä»¥å­¦ä¹ å­¦ä¹ ï¼Œè¿™å­¦æœŸæœ‰æ—¶é—´çš„è¯ï¼Œè¿˜è¦ç»§ç»­å®Œå–„ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶ä¸€èµ·æ¢è®¨ã€‚</p><p>ä¸€èµ·å­¦ä¹ ï¼Œä¸€èµ·æé«˜ï¼ŒåšæŠ€æœ¯åº”å½“æ˜¯ç›´æ¥çš„ï¼Œæœ‰é—®é¢˜æ¬¢è¿æŒ‡å‡ºï½</p><hr><p>æœ€åè¯´çš„ç¬¬ä¸‰ç‚¹ï¼šæ˜¯è‡ªå·±è¿˜æ˜¯ä¸€ä¸ªå­¦ç”Ÿï¼Œåšè¿™äº›å†…å®¹ä¹Ÿä»…ä»…æ˜¯å‡ºäºå…´è¶£ï¼Œå› ä¸ºæ‰¾æš‘æœŸå®ä¹ æ¯”è¾ƒè‰°éš¾ï¼Œåœ¨ç­‰å¾…é¹…å‚é¢è¯•é—´éš™å†™çš„è¿™ä¸ªç¨‹åºï¼Œå‹å‹æƒŠ(ç„¶è€Œå¹¶æ²¡æœ‰æ¶ˆæ¯)ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> MVVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[PWAå®è·µ]serviceWorkerç”Ÿå‘½å‘¨æœŸã€è¯·æ±‚ä»£ç†ä¸é€šä¿¡</title>
      <link href="/2018/02/10/PWA%E5%AE%9E%E8%B7%B5-serviceWorker%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E3%80%81%E8%AF%B7%E6%B1%82%E4%BB%A3%E7%90%86%E4%B8%8E%E9%80%9A%E4%BF%A1/"/>
      <url>/2018/02/10/PWA%E5%AE%9E%E8%B7%B5-serviceWorker%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E3%80%81%E8%AF%B7%E6%B1%82%E4%BB%A3%E7%90%86%E4%B8%8E%E9%80%9A%E4%BF%A1/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡ä¸»è¦è®² serviceWorker ç”Ÿå‘½å‘¨æœŸå’ŒæŒ‚è½½ã€å¸è½½ç­‰é—®é¢˜ï¼Œé€‚åˆå¯¹ serviceWorker çš„ä½œç”¨æœ‰æ‰€äº†è§£ä½†æ˜¯å…·ä½“ç»†èŠ‚ä¸æ˜¯ç‰¹åˆ«æ¸…æ¥šçš„è¯»è€…</p><p><strong>ä»¥ä¸‹æ‰€æœ‰åˆ†æåŸºäº Chrome V63</strong></p><h3 id="serviceWorkerçš„æŒ‚è½½"><a href="#serviceWorkerçš„æŒ‚è½½" class="headerlink" title="serviceWorkerçš„æŒ‚è½½"></a>serviceWorkerçš„æŒ‚è½½</h3><p>å…ˆæ¥ä¸€æ®µä»£ç æ„Ÿå—serviceWorkeræ³¨å†Œ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">if (&apos;serviceWorker&apos; in navigator) &#123;</span><br><span class="line">      window.addEventListener(&apos;load&apos;, function () &#123;</span><br><span class="line">          navigator.serviceWorker.register(&apos;/sw.js&apos;, &#123;scope: &apos;/&apos;&#125;)</span><br><span class="line">              .then(function (registration) &#123;</span><br><span class="line">                  // æ³¨å†ŒæˆåŠŸ</span><br><span class="line">                  console.log(&apos;ServiceWorker registration successful with scope: &apos;, registration.scope);</span><br><span class="line">              &#125;)</span><br><span class="line">              .catch(function (err) &#123;</span><br><span class="line">                  // æ³¨å†Œå¤±è´¥:(</span><br><span class="line">                  console.log(&apos;ServiceWorker registration failed: &apos;, err);</span><br><span class="line">              &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å®šä¹‰åœ¨<code>/sw.js</code>é‡Œçš„å†…å®¹å°±ä¼šç”Ÿæ•ˆ(å¯¹äºå½“å‰é¡µé¢ä¹‹å‰æ²¡æœ‰ serviceWorker çš„æƒ…å†µè€Œè¨€ï¼Œæˆ‘ä»¬æ³¨å†Œçš„ serviceWorker è‚¯å®šä¼šç”Ÿæ•ˆï¼Œå¦‚æœå½“å‰é¡µé¢å·²ç»æœ‰äº†æˆ‘ä»¬ä¹‹å‰æ³¨å†Œçš„ serviceWorkerï¼Œè¿™ä¸ªæ—¶å€™æ¶‰åŠåˆ° serviceWorkerçš„æ›´æ–°æœºåˆ¶ï¼Œä¸‹æ–‡è¯¦è¿°)</p><p>å¦‚æœæˆ‘ä»¬åœ¨<code>sw.js</code>æ²¡æœ‰å˜åŒ–çš„æƒ…å†µä¸‹åˆ·æ–°è¿™ä¸ªé¡µé¢ï¼Œæ¯æ¬¡è¿˜æ˜¯ä¼šæœ‰æ³¨å†ŒæˆåŠŸçš„å›è°ƒä»¥åŠç›¸åº”çš„logè¾“å‡ºï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™æµè§ˆå™¨å‘ç°æˆ‘ä»¬çš„ serviceWorker å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¹¶ä¸ä¼šé‡ç½®ä¸€é serviceWorker</p><h3 id="serviceWorkeræ›´æ–°"><a href="#serviceWorkeræ›´æ–°" class="headerlink" title="serviceWorkeræ›´æ–°"></a>serviceWorkeræ›´æ–°</h3><p>æˆ‘ä»¬å¦‚æœæƒ³æ›´æ–°ä¸€ä¸ª serviceWorkerï¼Œæ ¹æ®æˆ‘ä»¬çš„ä¸€èˆ¬webå¼€å‘ç­–ç•¥ï¼Œå¯èƒ½ä¼šæƒ³åˆ°ä»¥ä¸‹å‡ ç§ç­–ç•¥ï¼š</p><ul><li>ä»…å˜æ›´æ–‡ä»¶å(æ¯”å¦‚æŠŠ<code>sw.js</code>å˜æˆ<code>sw-v2.js</code>æˆ–è€…åŠ ä¸€ä¸ªhash)</li><li>ä»…å˜æ›´æ–‡ä»¶å†…å®¹(ä»…ä»…æ›´æ–°<code>sw.js</code>çš„å†…å®¹ï¼Œæ–‡ä»¶åä¸å˜)</li><li>åŒæ—¶å˜æ›´ï¼šåŒæ—¶æ‰§è¡Œä»¥ä¸Šä¸¤æ¡</li></ul><p>åœ¨è¿™é‡Œï¼Œæˆ‘å¯ä»¥å¾ˆè´Ÿè´£çš„å‘Šè¯‰ä½ ï¼Œ<strong>å˜æ›´serviceWorkeræ–‡ä»¶åç»å¯¹ä¸æ˜¯ä¸€ä¸ªå¥½çš„å®è·µ</strong>ï¼Œæµè§ˆå™¨åˆ¤æ–­ serviceWorker æ˜¯å¦ç›¸åŒåŸºæœ¬å’Œæ–‡ä»¶åæ²¡æœ‰å…³ç³»ï¼Œç”šè‡³æœ‰å¯èƒ½è¿˜ä¼šé€ æˆæµè§ˆå™¨æŠ›å‡º404å¼‚å¸¸(å› ä¸ºæ‰¾ä¸åˆ°åŸæ¥çš„æ–‡ä»¶åå¯¹åº”çš„æ–‡ä»¶äº†)ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å˜æ›´å†…å®¹å³å¯ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬æ¯æ¬¡æ‰“å¼€æˆ–è€…åˆ·æ–°è¯¥é¡µé¢ï¼Œæµè§ˆå™¨éƒ½ä¼šé‡æ–°è¯·æ±‚ä¸€é serviceWorker çš„å®šä¹‰æ–‡ä»¶ï¼Œå¦‚æœå‘ç°æ–‡ä»¶å†…å®¹å’Œä¹‹å‰çš„ä¸åŒäº†ï¼Œè¿™ä¸ªæ—¶å€™:</p><p>(<em>ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨â€œæœ‰å…³ tabâ€æ¥è¡¨ç¤ºå— serviceWorker æ§åˆ¶çš„é¡µé¢</em>ï¼Œåˆ·æ–°å‡æŒ‡æ™®é€šåˆ·æ–°(F5/CommandR)å¹¶ä¸æŒ‡Hard Reload)</p><ul><li><p>è¿™ä¸ªæ–°çš„ serviceWorker å°±ä¼šè¿›å…¥åˆ°ä¸€ä¸ª â€œwaiting to activateâ€ çš„çŠ¶æ€ï¼Œå¹¶ä¸”åªè¦æˆ‘ä»¬ä¸å…³é—­è¿™ä¸ªç½‘ç«™çš„æ‰€æœ‰tab(æ›´å‡†ç¡®åœ°è¯´ï¼Œæ˜¯è¿™ä¸ª serviceWorker æ§åˆ¶çš„æ‰€æœ‰é¡µé¢)ï¼Œæ–°çš„ serviceWorker å§‹ç»ˆä¸ä¼šè¿›å…¥æ›¿æ¢åŸæœ‰çš„è¿›å…¥åˆ° running çŠ¶æ€(å°±ç®—æˆ‘ä»¬åªæ‰“å¼€äº†ä¸€ä¸ªæœ‰å…³ tabï¼Œç›´æ¥åˆ·æ–°ä¹Ÿä¸ä¼šè®©æ–°çš„æ›¿æ¢æ—§çš„)ã€‚</p></li><li><p>å¦‚æœæˆ‘ä»¬å¤šæ¬¡æ›´æ–°äº† serviceWorker å¹¶ä¸”æ²¡æœ‰å…³é—­å½“å‰çš„ tab é¡µé¢ï¼Œé‚£ä¹ˆæ–°çš„ serviceWorker å°±ä¼šæŒ¤æ‰åŸå…ˆå¤„äºç¬¬äºŒé¡ºä½(waiting to activate)çš„serviceWorkerï¼Œå˜æˆ<code>waiting to activate</code>çŠ¶æ€</p></li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªæœ‰å…³é—­å½“å‰æ—§çš„ serviceWorker æ§åˆ¶çš„æ‰€æœ‰é¡µé¢ çš„æ‰€æœ‰tabï¼Œä¹‹åæµè§ˆå™¨æ‰ä¼šæŠŠæ—§çš„ serviveWorker ç§»é™¤æ‰ï¼Œæ¢æˆæ–°çš„ï¼Œå†æ‰“å¼€ç›¸åº”çš„é¡µé¢å°±ä¼šä½¿ç”¨æ–°çš„äº†ã€‚</p><p>å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼šå¦‚æœæˆ‘ä»¬åœ¨æ–°çš„ serviceWorker ä½¿ç”¨äº†<code>self.skipWaiting();</code>ï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(&apos;install&apos;, function(event) &#123;</span><br><span class="line">    self.skipWaiting();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ï¼Œè¦åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœå½“å‰æˆ‘ä»¬åªæ‰“å¼€äº†ä¸€ä¸ªæœ‰å…³ tabï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥åˆ·æ–°ï¼Œå‘ç°æ–°çš„å·²ç»æ›¿æ¢æ‰æ—§çš„äº†ã€‚</li><li>å¦‚æœæˆ‘ä»¬å½“å‰æ‰“å¼€äº†è‹¥å¹²æœ‰å…³ tabï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæ— è®ºæˆ‘ä»¬åˆ·æ–°å¤šå°‘æ¬¡ï¼Œæ–°çš„ä¹Ÿä¸ä¼šæ›¿æ¢æ‰æ—§çš„ï¼Œåªæœ‰æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªå…³æ‰tab(æˆ–è€…è·³è½¬èµ°)åªå‰©ä¸‹æœ€åä¸€ä¸ªäº†ï¼Œè¿™ä¸ªæ—¶å€™åˆ·æ–°ï¼Œä¼šè®©æ–°çš„æ›¿æ¢æ—§çš„(ä¹Ÿå°±æ˜¯ä¸Šä¸€ç§æƒ…å†µ)</li></ul><p>Chrome çš„è¿™ç§æœºåˆ¶ï¼Œé˜²æ­¢äº†åŒä¸€ä¸ªé¡µé¢å…ˆåè¢«æ–°æ—§ä¸¤ä¸ªä¸åŒçš„ serviceWorker æ¥ç®¡çš„æƒ…å†µå‡ºç°ã€‚</p><h4 id="æ‰‹åŠ¨æ›´æ–°"><a href="#æ‰‹åŠ¨æ›´æ–°" class="headerlink" title="æ‰‹åŠ¨æ›´æ–°"></a>æ‰‹åŠ¨æ›´æ–°</h4><p>è™½ç„¶è¯´ï¼Œåœ¨é¡µé¢æ¯æ¬¡è¿›å…¥çš„æ—¶å€™æµè§ˆå™¨éƒ½ä¼šæ£€æŸ¥ä¸€é serviceWorker æ˜¯å¦æ›´æ–°ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³è¦æ‰‹åŠ¨æ›´æ–° serviceWorker ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">navigator.serviceWorker.register(&quot;/sw.js&quot;).then(reg =&gt; &#123;</span><br><span class="line">  reg.update();</span><br><span class="line">  // æˆ–è€… ä¸€æ®µæ—¶é—´ä¹‹åæ›´æ–°</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™å¦‚æœ serviceWorker å˜åŒ–äº†ï¼Œé‚£ä¹ˆä¼šé‡æ–°è§¦å‘ install æ‰§è¡Œä¸€é install çš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å˜ï¼Œå°±ä¸ä¼šè§¦å‘è¿™ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</p><h4 id="install-ç”Ÿå‘½å‘¨æœŸé’©å­"><a href="#install-ç”Ÿå‘½å‘¨æœŸé’©å­" class="headerlink" title="install ç”Ÿå‘½å‘¨æœŸé’©å­"></a>install ç”Ÿå‘½å‘¨æœŸé’©å­</h4><p>æˆ‘ä»¬ä¸€èˆ¬ä¼šåœ¨ sw.js ä¸­ï¼Œæ·»åŠ <code>install</code>çš„å›è°ƒï¼Œä¸€èˆ¬åœ¨å›è°ƒä¸­ï¼Œæˆ‘ä»¬ä¼šè¿›è¡Œç¼“å­˜å¤„ç†æ“ä½œï¼Œåƒè¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(&apos;install&apos;, function(event) &#123;</span><br><span class="line">    console.log(&apos;[sw2] serviceWorker Installed successfully&apos;, event)</span><br><span class="line"></span><br><span class="line">    event.waitUntil(</span><br><span class="line">        caches.open(&apos;mysite-static-v1&apos;).then(function(cache) &#123;</span><br><span class="line">            return cache.addAll([</span><br><span class="line">                &apos;/stylesheets/style.css&apos;,</span><br><span class="line">                &apos;/javascripts/common.39c462651d449a73b5bb.js&apos;,</span><br><span class="line">            ]);</span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æ–°æ‰“å¼€ä¸€ä¸ªé¡µé¢ï¼Œå¦‚æœä¹‹å‰æœ‰ serviceWorkerï¼Œé‚£ä¹ˆä¼šè§¦å‘<code>install</code>ï¼Œå¦‚æœä¹‹å‰æ²¡æœ‰ï¼Œ é‚£ä¹ˆåœ¨ serviceWorker è£…è½½åä¼šè§¦å‘ <code>install</code>ã€‚</p><p>å¦‚æœæˆ‘ä»¬åˆ·æ–°é¡µé¢ï¼ŒserviceWorker å’Œä¹‹å‰æ²¡æœ‰å˜åŒ–æˆ–è€… serviceWorker å·²ç»å¤„åœ¨ <code>waiting to activate</code>ï¼Œä¸ä¼šè§¦å‘<code>install</code>ï¼Œå¦‚æœæœ‰å˜åŒ–ï¼Œä¼šè§¦å‘<code>install</code>ï¼Œä½†ä¸ä¼šæ¥ç®¡é¡µé¢(ä¸Šæ–‡ä¸­æåˆ°)ã€‚</p><h4 id="activate-ç”Ÿå‘½å‘¨æœŸé’©å­"><a href="#activate-ç”Ÿå‘½å‘¨æœŸé’©å­" class="headerlink" title="activate ç”Ÿå‘½å‘¨æœŸé’©å­"></a>activate ç”Ÿå‘½å‘¨æœŸé’©å­</h4><p>activate åœ¨ä»€ä¹ˆæ—¶å€™è¢«è§¦å‘å‘¢ï¼Ÿ</p><p>å¦‚æœå½“å‰é¡µé¢æ²¡æœ‰ serviceworker ï¼Œé‚£ä¹ˆä¼šåœ¨ install ä¹‹åè§¦å‘ã€‚</p><p>å¦‚æœå½“å‰é¡µé¢æœ‰ serviceWorkerï¼Œå¹¶ä¸”æœ‰ serviceWorkeræ›´æ–°ï¼Œæ–°çš„ serviceWorker åªä¼šè§¦å‘ install ï¼Œä¸ä¼šè§¦å‘ activate</p><p>æ¢å¥è¯è¯´ï¼Œå½“å‰å˜æˆ active çš„ serviceWorker æ‰ä¼šè¢«è§¦å‘è¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­</p><h3 id="serviceWorker-ä»£ç†è¯·æ±‚"><a href="#serviceWorker-ä»£ç†è¯·æ±‚" class="headerlink" title="serviceWorker ä»£ç†è¯·æ±‚"></a>serviceWorker ä»£ç†è¯·æ±‚</h3><p>serviceWorker ä»£ç†è¯·æ±‚ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¥½ç†è§£ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">self.addEventListener(&apos;install&apos;, function(event) &#123;</span><br><span class="line">    console.log(&apos;[sw2] serviceWorker Installed successfully&apos;, event)</span><br><span class="line"></span><br><span class="line">    event.waitUntil(</span><br><span class="line">        caches.open(&apos;mysite-static-v1&apos;).then(function(cache) &#123;</span><br><span class="line">            return cache.addAll([</span><br><span class="line">                &apos;/stylesheets/style.css&apos;,</span><br><span class="line">                &apos;/javascripts/common.39c462651d449a73b5bb.js&apos;,</span><br><span class="line">            ]);</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">self.addEventListener(&apos;fetch&apos;, function(event) &#123;</span><br><span class="line">    console.log(&apos;Handling fetch event for&apos;, event.request.url);</span><br><span class="line">    // console.log(&apos;[sw2]fetch but do nothing&apos;)</span><br><span class="line"></span><br><span class="line">    event.respondWith(</span><br><span class="line">        // caches.match() will look for a cache entry in all of the caches available to the service worker.</span><br><span class="line">        // It&apos;s an alternative to first opening a specific named cache and then matching on that.</span><br><span class="line">        caches.match(event.request).then(function(response) &#123;</span><br><span class="line">            if (response) &#123;</span><br><span class="line">                console.log(&apos;Found response in cache:&apos;, response);</span><br><span class="line"></span><br><span class="line">                return response;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            console.log(&apos;No response found in cache. About to fetch from network...&apos;);</span><br><span class="line"></span><br><span class="line">            // event.request will always have the proper mode set (&apos;cors, &apos;no-cors&apos;, etc.) so we don&apos;t</span><br><span class="line">            // have to hardcode &apos;no-cors&apos; like we do when fetch()ing in the install handler.</span><br><span class="line">            return fetch(event.request).then(function(response) &#123;</span><br><span class="line">                console.log(&apos;Response from network is:&apos;, response);</span><br><span class="line"></span><br><span class="line">                return response;</span><br><span class="line">            &#125;).catch(function(error) &#123;</span><br><span class="line">                // This catch() will handle exceptions thrown from the fetch() operation.</span><br><span class="line">                // Note that a HTTP error response (e.g. 404) will NOT trigger an exception.</span><br><span class="line">                // It will return a normal response object that has the appropriate error code set.</span><br><span class="line">                console.error(&apos;Fetching failed:&apos;, error);</span><br><span class="line"></span><br><span class="line">                throw error;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æœ‰ä¸¤ç‚¹è¦æ³¨æ„çš„ï¼š</p><p>æˆ‘ä»¬å¦‚æœè¿™æ ·ä»£ç†äº†ï¼Œå“ªæ€•æ²¡æœ‰ cache å‘½ä¸­ï¼Œå®é™…ä¸Šä¹Ÿä¼šåœ¨æ§åˆ¶å°å†™from serviceWorkerï¼Œè€Œé‚£äº›çœŸæ­£ç”±serviceWorkerå‘å‡ºçš„è¯·æ±‚ä¹Ÿä¼šæ˜¾ç¤ºï¼Œæœ‰ä¸€ä¸ªé½¿è½®å›¾æ ‡ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://www.10000h.top/images/sw_1.png" alt></p><p>ç¬¬äºŒç‚¹å°±æ˜¯æˆ‘ä»¬å¦‚æœåœ¨ fetch çš„ listener é‡Œé¢ do nothingï¼Œ ä¹Ÿä¸ä¼šå¯¼è‡´è¿™ä¸ªè¯·æ±‚ç›´æ¥å‡æ­»æ‰çš„ã€‚</p><p>å¦å¤–ï¼Œé€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å‘ç°ï¼Œå®é™…ä¸Šç”±äºç°åœ¨æˆ‘ä»¬ä¹ æƒ¯ç»™æˆ‘ä»¬çš„æ–‡ä»¶èµ„æºåŠ ä¸Š hashï¼Œæ‰€ä»¥æˆ‘ä»¬åŸºæœ¬ä¸Šä¸å¯èƒ½æ‰‹åŠ¨è¾“å…¥éœ€è¦ç¼“å­˜çš„æ–‡ä»¶åˆ—è¡¨ï¼Œç°åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯å€ŸåŠ© webpack æ’ä»¶ï¼Œå®Œæˆè¿™éƒ¨åˆ†å·¥ä½œã€‚</p><h3 id="serviceWorker-å’Œ-é¡µé¢ä¹‹é—´çš„é€šä¿¡"><a href="#serviceWorker-å’Œ-é¡µé¢ä¹‹é—´çš„é€šä¿¡" class="headerlink" title="serviceWorker å’Œ é¡µé¢ä¹‹é—´çš„é€šä¿¡"></a>serviceWorker å’Œ é¡µé¢ä¹‹é—´çš„é€šä¿¡</h3><p>serviceWorkerå‘é¡µé¢å‘æ¶ˆæ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sw.js:</span><br><span class="line"></span><br><span class="line">self.clients.matchAll().then(clients =&gt; &#123;</span><br><span class="line">    clients.forEach(client =&gt; &#123;</span><br><span class="line">        console.log(&apos;%c [sw message]&apos;, &apos;color:#00aa00&apos;, client)</span><br><span class="line">        client.postMessage(&quot;This message is from serviceWorker&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">ä¸»é¡µé¢:</span><br><span class="line"></span><br><span class="line">navigator.serviceWorker.addEventListener(&apos;message&apos;, function (event) &#123;</span><br><span class="line">    console.log(&apos;[Main] receive from serviceWorker:&apos;, event.data, event)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¿™é‡Œé¢æ˜¯æœ‰å‘çš„ï¼š</p><ul><li>ä¸»ç•Œé¢çš„äº‹ä»¶ç›‘å¬éœ€è¦ç­‰serviceWorkeræ³¨å†Œå®Œæ¯•åï¼Œæ‰€ä»¥ä¸€èˆ¬<code>navigator.serviceWorker.register</code>çš„å›è°ƒåˆ°æ¥ä¹‹åå†è¿›è¡Œæ³¨å†Œ(æˆ–è€…å»¶è¿Ÿè¶³å¤Ÿçš„æ—¶é—´)ã€‚</li><li>å¦‚æœåœ¨ä¸»ç•Œé¢äº‹ä»¶ç›‘å¬è¿˜æ²¡æœ‰æ³¨å†ŒæˆåŠŸçš„æ—¶å€™ serviceWorker å‘é€æ¶ˆæ¯ï¼Œè‡ªç„¶æ˜¯æ”¶ä¸åˆ°çš„ã€‚å¦‚æœæˆ‘ä»¬æŠŠ serviceWorker ç›´æ¥å†™åœ¨ install çš„å›è°ƒä¸­ï¼Œä¹Ÿæ˜¯ä¸èƒ½è¢«æ­£å¸¸æ”¶åˆ°çš„ã€‚</li></ul><p>ä»é¡µé¢å‘ serviceWorker å‘é€æ¶ˆæ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ä¸»é¡µé¢:</span><br><span class="line"></span><br><span class="line">navigator.serviceWorker.controller &amp;&amp; navigator.serviceWorker.controller.postMessage(&apos;hello serviceWorker&apos;);</span><br><span class="line"></span><br><span class="line">sw.js:</span><br><span class="line">self.addEventListener(&apos;message&apos;, function (event) &#123;</span><br><span class="line">    console.log(&quot;[sw from main]&quot;,event.data); // è¾“å‡ºï¼š&apos;sw.updatedone&apos;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œè¿™ä¹Ÿè¦æ±‚ä¸»ç•Œé¢çš„ä»£ç éœ€è¦ç­‰åˆ°serviceWorkeræ³¨å†Œå®Œæ¯•åè§¦å‘ï¼Œå¦å¤–è¿˜æœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„ï¼Œ serviceWorker çš„äº‹ä»¶ç»‘å®šä»£ç è¦æ±‚ä¸»ç•Œé¢çš„serviceWorkerå·²ç»æ³¨å†Œå®Œæ¯•åæ‰å¯ä»¥ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå½“å‰é¡µé¢æ²¡æœ‰è¯¥serviceWorker ç¬¬ä¸€æ¬¡æ³¨å†Œæ˜¯ä¸ä¼šæ”¶åˆ°ä¸»ç•Œé¢æ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„ã€‚</p><p>è®°ä½ï¼Œåªæœ‰å½“å‰å·²ç»åœ¨ active çš„ serviceWorkerï¼Œ æ‰èƒ½å’Œä¸»é¡µé¢æ”¶å‘æ¶ˆæ¯ç­‰ã€‚</p><p><strong>ä»¥ä¸Šå°±æ˜¯å’Œ serviceWorker æœ‰å…³çš„ä¸€äº›å†…å®¹ï¼Œåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¼šå¯¹PWA æ·»åŠ è‡³ä¸»å±å¹•ç­‰åŠŸèƒ½è¿›è¡Œæ€»ç»“</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> PWA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµè§ˆå™¨webæ¸²æŸ“ä¸ä¼˜åŒ–-ç»­</title>
      <link href="/2017/08/31/%E6%B7%B1%E5%85%A5%E6%B5%8F%E8%A7%88%E5%99%A8web%E6%B8%B2%E6%9F%93%E4%B8%8E%E4%BC%98%E5%8C%96-%E7%BB%AD/"/>
      <url>/2017/08/31/%E6%B7%B1%E5%85%A5%E6%B5%8F%E8%A7%88%E5%99%A8web%E6%B8%B2%E6%9F%93%E4%B8%8E%E4%BC%98%E5%8C%96-%E7%BB%AD/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬ç¯‡æ–‡ç« æ¥ä¸Šä¸€ç¯‡ç»§ç»­åˆ†ææµè§ˆå™¨webæ¸²æŸ“ç›¸å…³å†…å®¹ï¼Œä½†æ˜¯æ›´ä¾§é‡ä¼˜åŒ–å·¥ä½œã€‚å½“ç„¶ï¼Œä¸»è¦è¿˜æ˜¯åŸºäºX5æ¥åˆ†æ</p></blockquote><p>ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä¸»è¦æ˜¯ä»æµè§ˆå™¨å†…æ ¸çš„çº¿ç¨‹è§’åº¦æ¥åˆ†æç›¸å…³å·¥ä½œçš„ï¼Œå¯¹æ•´ä½“æµç¨‹æ²¡æœ‰å®è§‚æ¸…æ™°çš„åˆ†æï¼Œè¿™æ¬¡æˆ‘ä»¬ä»å®è§‚åˆ°å¾®è§‚ï¼Œä»æ•´ä½“åˆ°å±€éƒ¨ï¼Œæ¥è¿›è¡Œåˆ†æå’Œæ¢ç©¶å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ã€‚</p><p>é¦–å…ˆï¼Œä¸€ä¸ªç½‘é¡µçš„åŠ è½½ï¼Œéœ€è¦ä»€ä¹ˆå·¥ä½œå‘¢ï¼Ÿ</p><p><img src="https://www.10000h.top/images/data_img/webRender2/P1.png" alt></p><p>è¿™ä¸ªå·¥ä½œå¯ä»¥åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼šäº‘(äº‘ç«¯)ã€ç®¡(ä¼ è¾“é“¾è·¯)ã€ç«¯(å®¢æˆ·ç«¯)ï¼Œä»äº‘ç»è¿‡ç®¡ä¼ åˆ°ç«¯ï¼Œç„¶åç»è¿‡åŠ è½½è§£ææ’ç‰ˆæ¸²æŸ“ï¼Œä»è€Œå®Œæˆç½‘é¡µä»è¯·æ±‚åˆ°å‘ˆç°çš„å·¥ä½œ(å½“ç„¶ï¼Œæˆ‘ä»¬è¿™é‡Œæ²¡æœ‰æ¶‰åŠåè®®çš„åˆ†æï¼Œå®é™…ä¸Šæ ¹æ®åè®®ä¸åŒï¼Œè¿™ä¸ªä¼ è¾“å¯èƒ½æ˜¯å¤šæ¬¡ä¼ è¾“)ã€‚</p><p>æ•°æ®åˆ°ç«¯ä¹‹åï¼Œåˆç»è¿‡ä»¥ä¸‹è¿‡ç¨‹ï¼Œæ‰æœ€ç»ˆæ˜¾ç¤ºå‡ºæ¥ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender2/P2.png" alt></p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ€ä¹ˆè¡¡é‡æ€§èƒ½å‘¢ï¼Ÿ</p><p>å›ºç„¶ï¼Œæˆ‘ä»¬æœ‰è¯¸å¤šæµè§ˆå™¨æä¾›çš„APIï¼Œè¿™äº›APIèƒ½è®©æˆ‘ä»¬è·å–åˆ°è¾ƒå¤šä¿¡æ¯å¹¶ä¸”è®°å½•ä¸ŠæŠ¥ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender2/P3.png" alt></p><p>ä½†æ˜¯è¿™äº›å…·ä½“æ•°å€¼è¡¨è¾¾çš„å«ä¹‰æœ‰é™ï¼Œå¹¶ä¸”ä»–ä»¬å®é™…ä¸Šä¹Ÿä¸ç­‰äºç”¨æˆ·ä½“éªŒã€‚</p><p>æ‰€ä»¥ï¼Œæ‰¾åˆ°ä¸€ä¸ªç§‘å­¦å¹¶ä¸”å¯ä»¥æ£€æµ‹çš„æ ‡å‡†ï¼Œå¹¶ä¸”è¿™ä¸ªæ ‡å‡†å¯ä»¥å’Œç”¨æˆ·ä½“éªŒæœ‰æ­£ç›¸å…³å…³ç³»ï¼Œè¿™ä¸ªæ˜¯è‡³å…³é‡è¦çš„ã€‚</p><p>ç›®å‰è¿™ä¸ªæ ‡å‡†æ˜¯<strong>é¦–å±æ—¶é—´</strong>(å°±ä¹‹å‰è‡ªå·±çš„äº†è§£ï¼Œå…·ä½“çš„è¿˜åŒºåˆ†é¦–å±å±•ç¤ºæ—¶é—´å’Œé¦–å±å¯äº¤äº’æ—¶é—´ï¼Œä½†æ˜¯è¿™é‡Œè®²å¸ˆä¸åšåŒºåˆ†ï¼Œå°±ä¸‹æ–‡æä¾›çš„æµ‹ç®—æ–¹æ³•è€Œè¨€ï¼Œæ˜¾ç„¶è¿™é‡ŒæŒ‡çš„æ˜¯é¦–å±å±•ç¤ºæ—¶é—´ï¼Œ<em>å¦å¤–ï¼Œå±•ç¤ºååˆ°ç”¨æˆ·çš„ç¬¬ä¸€æ¬¡æ“ä½œéƒ½ä¼šæœ‰ä¸€ä¸ªè‡³å°‘1sçš„å»¶æ—¶ï¼Œæ¯•ç«Ÿç”¨æˆ·æ‰‹æŒ‡æŒ‰ä¸‹çš„åŠ¨ä½œæ˜¯ä¼šæ¯”è¾ƒæ…¢çš„ï¼Œè¿™ä¸ªæ—¶é—´jsçš„äº¤äº’éƒ½èƒ½å®Œæˆäº†ï¼Œæ‰€ä»¥é¦–å±å±•ç¤ºæ—¶é—´æ›´åŠ é‡è¦â€“from dorsywang</em>)</p><p>é‚£ä¹ˆ<strong>é¦–å±æ—¶é—´</strong>æ€ä¹ˆæµ‹é‡å‘¢ï¼Ÿ</p><p><strong>æ‹¿æ‘„åƒæœºå¿«é€Ÿæ‹ç…§æµ‹é‡çš„</strong>ã€‚è¿™ä¸ªç­”æ¡ˆå¯èƒ½æœ‰äº›åƒæƒŠï¼Œä½†æ˜¯ç›®å‰X5å†…æ ¸ä¸šåŠ¡çš„ç›¸å…³å¼€å‘äººå‘˜çš„ç¡®å°±æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼æµ‹ç®—çš„ï¼Œé€šè¿‡é«˜é€Ÿç›¸æœºä¸æ–­æ‹ç…§ï¼Œç„¶åè¾…åŠ©å›¾åƒè¯†åˆ«ï¼Œåˆ¤æ–­é¦–å±æ˜¯å¦å·²ç»åŠ è½½å®Œæˆï¼Œæœ€ç»ˆå†é€šè¿‡äººå·¥å›å½’æ ¡å¯¹ã€‚<br>å› ä¸ºå¦‚æœé‡‡ç”¨ç¨‹åºæ£€æµ‹çš„è¯ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šå¯¹è¿‡ç¨‹æœ¬èº«é€ æˆä¸€å®šçš„å½±å“ï¼Œæ‰€ä»¥æ²¡æœ‰é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚<br>å½“ç„¶ï¼Œé€šè¿‡æ‘„åƒ+å›¾åƒè¯†åˆ«çš„è¿™ç§æ–¹å¼ä¹Ÿæ˜¯æœ‰ä¸€å®šçš„å¼Šç«¯ï¼Œæ¯”å¦‚è¯´ï¼Œå‡è®¾é¦–å±æœ‰ä¸€ä¸ªå›¾ç‰‡ï¼Œè€Œå›¾ç‰‡çš„åŠ è½½é€šå¸¸æ¯”è¾ƒæ…¢å¹¶ä¸”ä¸å½±å“cssã€jsçš„åŠ è½½ï¼Œè¿™ä¸ªæ—¶å€™ç›´æ¥é€šè¿‡å›¾ç‰‡è¯†åˆ«çš„è¯å°±å¯èƒ½ä¼šæœ‰ä¸€å®šçš„è¯¯åˆ¤ã€‚</p><p>çŸ¥é“äº†æ€ä¹ˆæµ‹ç®—ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥åˆ†æå½±å“è¿™ä¸ªæŒ‡æ ‡çš„ä¸€äº›åŸå› ï¼š</p><ul><li>èµ„æºé˜»å¡å†…æ ¸çº¿ç¨‹</li></ul><p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œcsså’ŒJSæ˜¯é˜»å¡é¡µé¢çš„ï¼Œå½“ç„¶ä¹Ÿä¼šå¯¹é¦–å±æ—¶é—´é€ æˆå½±å“ã€‚</p><p>å¯¹è¿™ä¸ªé—®é¢˜ï¼ŒX5å†…æ ¸æœ‰å…³é”®å­èµ„æº(é˜»å¡èµ„æº)ç¼“å­˜ï¼Œè¿™é‡Œçš„å…³é”®èµ„æºï¼ŒæŒ‡çš„æ˜¯å†…æ ¸ç»è¿‡ç»Ÿè®¡åˆ¤æ–­å¾—å‡ºçš„ä¸šåŠ¡å¸¸ç”¨çš„å…³é”®å­èµ„æºã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¸ªç»Ÿè®¡ä¹Ÿå¯èƒ½ç¼ºä¹ä¸€å®šçš„å‡†ç¡®æ€§ï¼Œæ‰€ä»¥ç›¸å…³å›¢é˜Ÿä¹Ÿæ­£åœ¨æ¨è¿›è¿™æ–¹é¢çš„å†…å®¹è§„èŒƒåŒ–(æ¯”å¦‚å†™å…¥Web App Manifest)</p><ul><li>ä¸­æ–‡Layoutçš„æ—¶é—´è¿‡é•¿</li></ul><p>è¿™ä¸ªé—®é¢˜æˆ‘ä¹‹å‰æ²¡æœ‰å¬è¯´è¿‡ï¼Œä½†æ˜¯çš„ç¡®æ˜¯è¿™æ ·å­ï¼Œå®é™…ä¸Šï¼Œæµè§ˆå™¨åœ¨ç»˜åˆ¶æ–‡å­—çš„æ—¶å€™ç»å†çš„è¿‡ç¨‹éå¸¸çš„å¤šï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªç¯èŠ‚æ˜¯æ‰¾åˆ°æ–‡å­—çš„å®½åº¦å’Œé«˜åº¦(å› ä¸ºåœ¨è‹±æ–‡çŠ¶æ€ä¸‹ï¼Œæ¯ä¸€ä¸ªå­—ç¬¦çš„å®½åº¦æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªå­—ç¬¦éƒ½è¦æŸ¥æ‰¾ï¼Œä½†æ˜¯è‹±æ–‡æ€»å…±åªæœ‰26ä¸ªå­—ç¬¦)ï¼Œè€Œä¸­æ–‡ç”±äºå­—ç¬¦æ¯”è¾ƒå¤šï¼Œå¸¸ç”¨å¾—å°±æœ‰6000å¤šä¸ªï¼Œå®Œæ•´çš„æ›´æ˜¯æœ‰2ä¸‡ä¸ªä»¥ä¸Šï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹éœ€è¦èŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒX5å†…æ ¸è€ƒè™‘åˆ°ä¸­æ–‡æ–‡å­—å‡ ä¹éƒ½æ˜¯ç­‰å®½ç­‰é«˜çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹å¯¹ä¸€ä¸ªæ–‡å­—ä¸²æ¥è¯´åªéœ€è¦æŸ¥è¯¢ä¸€æ¬¡å³å¯ï¼Œå®é™…ä¸Šæ˜¯èŠ‚çº¦äº†è¿™ä¸ªç¯èŠ‚ã€‚</p><ul><li>é¦–æ¬¡æ¸²æŸ“å¤ªæ…¢</li></ul><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨å…ˆç»˜åˆ¶é¦–å±çš„æ–¹å¼ï¼Œè¿™ä¸ªä¹Ÿå°±æ˜¯åŸºäºç¬¬ä¸€ç¯‡æ–‡ç« ä¸­è®²åˆ°çš„æµè§ˆå™¨çš„åˆ†å—æ¸²æŸ“æœºåˆ¶</p><ul><li>ä¸€æ¬¡è§£æå†…å®¹è¿‡å¤š</li></ul><p>é‡‡ç”¨é¦–å±æ¢æµ‹æœºåˆ¶ï¼Œä¼˜å…ˆè§£æé¦–å±å†…å®¹ã€‚</p><p>å¦å¤–ï¼Œè¿™é‡Œå¯ä»¥å‰ç«¯é…åˆå»åšé¦–å±ä¼˜åŒ–ï¼š</p><p>åœ¨é¦–å±çš„ä½ç½®æ’å…¥é¦–å±æ ‡ç­¾ï¼Œå†…æ ¸è§£æåˆ°æ ‡ç­¾åç«‹å³ç»ˆæ­¢è§£æå¹¶ä¸”æ’ç‰ˆä¸Šå±</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=â€˜x5-pagetypeâ€™ content=â€˜optpage&apos;&gt;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨é¦–å±åˆ†ç•Œçš„åœ°æ–¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;first-screen/&gt;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™ï¼Œå¯ä»¥ä¸“é—¨å»ä¼˜åŒ–é¦–å±æ ‡ç­¾ä¹‹å‰çš„å†…å®¹(è¿™ä¸ªæ ‡ç­¾å‰å°½é‡å±•ç°è€—æ—¶å°‘å’Œä¸éœ€è¦é˜»å¡è§£æçš„èµ„æº)ã€‚</p><p>å¦å¤–ï¼ŒX5å†…æ ¸ä¹Ÿæä¾›äº†ä¸»èµ„æºé¢„æ‹‰å–çš„æ¥å£ï¼Œå¹¶ä¸”è€ƒè™‘åˆ°é¢„æ‹‰å–çš„cookieé—®é¢˜ï¼Œè¿˜æä¾›äº†preconnecté¢„é“¾æ¥ã€‚<br><em>TIP:ä¸»èµ„æºä¸­å…³è”çš„å­èµ„æºé¢„æ‹‰å–ä¸ç”¨ä¸»åŠ¨è°ƒç”¨</em></p><ul><li>é¢„å…ˆæ“ä½œ</li></ul><p>å¦å¤–ä¸ºäº†æä¾›æ›´åŠ æè‡´çš„ä¼˜åŒ–ï¼ŒX5å†…æ ¸(QQæµè§ˆå™¨ã€æ‰‹Q Webview)è¿˜æä¾›äº†å¦‚ä¸‹è¯¸å¤šé¢„æ“ä½œï¼š</p><ul><li>åœ¨â€é»è´´å¹¶è½¬åˆ°â€ä¹‹å‰å°±å¼€å§‹è¿›è¡Œç½‘ç»œè¯·æ±‚å’Œé¢„æ¸²æŸ“</li><li>ç»å¸¸è®¿é—®çš„ç«™ç‚¹å¯ä»¥é¢„è§£æDNS</li><li>ç‚¹å‡»åœ°å€æ æ—¶è¿›è¡Œæœç´¢é¢„è¿æ¥</li><li>ç‚¹å‡»é“¾æ¥æ—¶ï¼Œå…ˆé¢„é“¾æ¥ï¼Œå†åšè·³è½¬ã€‚</li><li>â€¦â€¦</li></ul><h3 id="å…¶ä»–æ–¹å¼ä¼˜åŒ–"><a href="#å…¶ä»–æ–¹å¼ä¼˜åŒ–" class="headerlink" title="å…¶ä»–æ–¹å¼ä¼˜åŒ–"></a>å…¶ä»–æ–¹å¼ä¼˜åŒ–</h3><p>å®é™…ä¸Šä¸Šæ–‡ä¸»è¦è®²äº†å®¢æˆ·ç«¯æ–¹é¢çš„ä¼˜åŒ–å·¥ä½œï¼Œå®é™…ä¸Šå¯¹äºâ€äº‘â€ã€â€ç®¡â€ä¸¤ç«¯ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šä¼˜åŒ–å·¥ä½œå¯ä»¥è®²çš„ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªå’Œå‰ç«¯å…³ç³»ä¸æ˜¯ç‰¹åˆ«å¯†åˆ‡ï¼Œæˆ‘æŒ‘ä¸€éƒ¨åˆ†è®²ä¸€è®²ã€‚è¿™äº›åœ¨æˆ‘ä»¬å‰ç«¯åšä¸ªäººé¡¹ç›®çš„åå°æ—¶å€™ä¹Ÿå¯ä»¥å‚è€ƒ</p><h5 id="åå°æé€Ÿ"><a href="#åå°æé€Ÿ" class="headerlink" title="åå°æé€Ÿ"></a>åå°æé€Ÿ</h5><ul><li>ç›´æ¥ä½¿ç”¨IPï¼ŒèŠ‚çœdnsçš„æŸ¥è¯¢æ—¶é—´</li><li>ç»´æŒé•¿è¿æ¥</li><li>HTTP1.1å¯ç”¨åŒ…å¤´èŠ‚çœ</li><li>æœåŠ¡å™¨ç¼“å­˜</li><li>æ–‡æœ¬èµ„æºå‹ç¼©ä¼ è¾“GZIP(6)</li><li>å›¾ç‰‡å°ºå¯¸å‹ç¼©ã€å›¾ç‰‡è´¨é‡å‹ç¼©ã€æ”¯æŒwebpå’Œsharpp/hevcæ ¼å¼ã€‚</li></ul><h5 id="é™ä½ç½‘ç»œæ—¶å»¶"><a href="#é™ä½ç½‘ç»œæ—¶å»¶" class="headerlink" title="é™ä½ç½‘ç»œæ—¶å»¶"></a>é™ä½ç½‘ç»œæ—¶å»¶</h5><ul><li>å°±å¿«æ¥å…¥å’Œå°±è¿‘æ¥å…¥</li></ul><p>åœ¨é€‰æ‹©æ¥å…¥ç‚¹çš„æ—¶å€™ï¼Œå¦‚æœé‡‡ç”¨å°±è¿‘æ¥å…¥ï¼Œå¯ä»¥ä¿æŒè·¯ç”±ç¨³å®šï¼Œæœ‰åˆ©äºè´Ÿè½½å‡è¡¡ï¼Œå¹¶ä¸”å®ç°ç®€å•ï¼Œä¾¿äºç»´æŠ¤ã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼šç»éªŒåˆ¤æ–­ï¼Œå‡†ç¡®åº¦ä¸å¤Ÿé«˜ ï¼› æ— æ³•è‡ªåŠ¨åˆ‡æ¢è·¯ç”±ã€‚</p><p>ç›¸æ¯”è¾ƒè€Œè¨€ï¼Œé€‰æ‹©å°±å¿«æ¥å…¥ï¼Œæ˜¯ä¸€ä¸ªèƒ½å¤Ÿææ•ˆçš„æ–¹å¼ã€‚</p><h5 id="å†…å®¹é˜²åŠ«æŒ"><a href="#å†…å®¹é˜²åŠ«æŒ" class="headerlink" title="å†…å®¹é˜²åŠ«æŒ"></a>å†…å®¹é˜²åŠ«æŒ</h5><p>è¿è¥å•†åŠ«æŒå¯¹æˆ‘ä»¬æ¥è¯´å·²ç»æ˜¯ä¸é™Œç”Ÿçš„è¯é¢˜äº†ï¼Œä½†æ˜¯X5å†…æ ¸æœ‰ä¸€ä¸ªæ¯”è¾ƒæ–°çš„é˜²åŠ«æŒæ‰‹æ®µï¼Œå°±æ˜¯å®¢æˆ·ç«¯å’Œäº‘åŠ é€ŸæœåŠ¡å™¨åŒæ—¶é‡‡ç”¨è½»é‡çº§httpåŠ å¯†ï¼Œè™½ç„¶è¿™ç§æ–¹å¼æ™®é€‚æ€§ä¸å¼ºï¼Œä½†æ˜¯çš„ç¡®å¯ä»¥è§£å†³è…¾è®¯è‡ªèº«ä¸šåŠ¡çš„é˜²åŠ«æŒé—®é¢˜ã€‚</p><h4 id="QUICå’Œhttp2"><a href="#QUICå’Œhttp2" class="headerlink" title="QUICå’Œhttp2"></a>QUICå’Œhttp2</h4><p>QUIC åŸºäºUDPçš„åè®®é€šè®¯æ–¹å¼ï¼Œæœ‰è¿™äº›ä¼˜åŠ¿ï¼š</p><ul><li>å»¶è¿Ÿå°‘</li><li>å‰å‘çº é”™</li><li>æ²¡æœ‰<strong>çº¿å¤´é˜»å¡[æ³¨1]</strong>çš„å¤šè·¯å¤ç”¨</li><li>é€šä¿¡é€šé“çš„å®šä¹‰åŸºäºIDè€Œä¸æ˜¯IP+ç«¯å£ï¼Œä½¿å¾—åˆ‡æ¢ç½‘ç»œåç»§ç»­è½¬å‘é“¾æ¥æˆä¸ºå¯èƒ½</li></ul><p>â€”â€”â€”â€”â€”â€”</p><p>æ³¨1ï¼šçº¿å¤´é˜»å¡ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender2/P4.png" alt></p><p>â€”â€”â€”â€”â€”â€”</p><p>é™„1: å¸¦å®½å’Œå»¶è¿Ÿå¯¹ç½‘é¡µåŠ è½½çš„å½±å“ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender2/X1.png" alt></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ·±å…¥æµè§ˆå™¨webæ¸²æŸ“ä¸ä¼˜åŒ–</title>
      <link href="/2017/08/27/%E6%B7%B1%E5%85%A5%E6%B5%8F%E8%A7%88%E5%99%A8web%E6%B8%B2%E6%9F%93%E4%B8%8E%E4%BC%98%E5%8C%96/"/>
      <url>/2017/08/27/%E6%B7%B1%E5%85%A5%E6%B5%8F%E8%A7%88%E5%99%A8web%E6%B8%B2%E6%9F%93%E4%B8%8E%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦åˆ†æå’Œæ€»ç»“webå†…æ ¸æ¸²æŸ“çš„ç›¸å…³å†…å®¹ï¼Œä»¥åŠåœ¨è¿™æ–¹é¢å‰ç«¯å¯ä»¥åšçš„æ€§èƒ½ä¼˜åŒ–å·¥ä½œã€‚</p></blockquote><p>æ–‡ç« ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>blinkå†…æ ¸çš„æ¸²æŸ“æœºåˆ¶</li><li>chromeå†…æ ¸æ¶æ„å˜è¿</li><li>åˆ†å±‚æ¸²æŸ“</li><li>åŠ¨ç”» &amp; canvas &amp; WebGl</li></ul><p><em>è¿™é‡Œçš„å‰ä¸¤éƒ¨åˆ†å¯èƒ½ä¼šæœ‰äº›æ¯ç‡¥ï¼Œå¦‚æœæ˜¯å‰ç«¯å·¥ç¨‹å¸ˆå¹¶ä¸”æƒ³ç«‹å³è·å¾—å®é™…é¡¹ç›®çš„å»ºè®®çš„ï¼Œå¯ä»¥ç›´æ¥é˜…è¯»ç¬¬ä¸‰éƒ¨åˆ†å’Œç¬¬å››éƒ¨åˆ†</em></p><h3 id="blinkå†…æ ¸çš„æ¸²æŸ“æœºåˆ¶"><a href="#blinkå†…æ ¸çš„æ¸²æŸ“æœºåˆ¶" class="headerlink" title="blinkå†…æ ¸çš„æ¸²æŸ“æœºåˆ¶"></a>blinkå†…æ ¸çš„æ¸²æŸ“æœºåˆ¶</h3><p>blinkå†…æ ¸æ˜¯GoogleåŸºäºWebkitå†…æ ¸å¼€å‘çš„æ–°çš„åˆ†æ”¯ï¼Œè€Œå®é™…ä¸Šï¼Œç›®å‰Chromeå·²ç»é‡‡ç”¨äº†blinkå†…æ ¸ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çš„æœ‰å…³åˆ†æå¤§å¤šåŸºäºblinkå†…æ ¸çš„æµè§ˆå™¨(Chrome)ï¼Œå°±ä¸å†è¯¦ç»†æŒ‡æ˜ï¼Œå½“ç„¶ï¼Œéƒ¨åˆ†å†…å®¹ä¹Ÿä¼šæ¶‰åŠåˆ°è…¾è®¯ç ”å‘çš„X5å†…æ ¸(X5å†…æ ¸åŸºäºå®‰å“çš„WebViewï¼Œç›®å‰å·²ç»åœ¨æ‰‹æœºQQç­‰äº§å“ä¸­ä½¿ç”¨ï¼ŒåŸºäºX5å†…æ ¸çš„é¡¹ç›®ç´¯è®¡æœ‰æ•°äº¿UVï¼Œä¸Šç™¾äº¿PV)ã€‚</p><p>ä¸€ä¸ªé¡µé¢çš„æ˜¾ç¤ºï¼Œå®é™…ä¸Šä¸»è¦ç»å†äº†ä¸‹é¢çš„å››ä¸ªæµç¨‹ï¼š</p><p>åŠ è½½ =&gt; è§£æ =&gt; æ’ç‰ˆ =&gt; æ¸²æŸ“</p><p>å®é™…ä¸Šï¼Œè¿™é‡Œçš„æ¸²æŸ“ä¸»è¦æ˜¯æŒ‡æ’ç‰ˆä¹‹ååˆ°æœ€åçš„ä¸Šå±ç»˜åˆ¶(è¿™ä¸ªæ—¶å€™å†…å®¹å·²ç»æ’ç‰ˆå¥½äº†)ï¼Œä¸€éƒ¨åˆ†å‰ç«¯å·¥ç¨‹å¸ˆé€šå¸¸ä¼šæŠŠä¸€éƒ¨åˆ†çš„æ’ç‰ˆå·¥ä½œç†è§£åˆ°â€œæ¸²æŸ“â€çš„æµç¨‹ä¸­(ä¹Ÿå°±æ˜¯ä¸‹å›¾ä¸­å…¨éƒ¨å·¥ä½œ)ï¼Œå®é™…ä¸Šè¿™ä¸ªç†è§£æ˜¯ä¸å‡†ç¡®çš„ã€‚</p><p><img src="https://www.10000h.top/images/data_img/webRender/P6.PNG" alt></p><p>ç›®å‰ï¼Œæµè§ˆå™¨çš„æ¸²æŸ“é‡‡ç”¨çš„æ˜¯åˆ†å—æ¸²æŸ“çš„æœºåˆ¶ï¼Œæ‰€è°“çš„åˆ†å—æ¸²æŸ“çš„æœºåˆ¶ï¼Œå…¶å®åº”è¯¥è¿™ä¹ˆç†è§£ï¼š</p><ul><li>æµè§ˆå™¨é¦–å…ˆæŠŠæ•´ä¸ªç½‘é¡µåˆ†æˆä¸€äº›ä½åˆ†è¾¨ç‡çš„å—ï¼Œå†æŠŠç½‘é¡µåˆ†æˆé«˜åˆ†è¾¨ç‡çš„å—ï¼Œç„¶åç»™è¿™äº›å—æ’åˆ—ä¼˜å…ˆçº§ã€‚</li><li>å¤„åœ¨å¯è§†åŒºåŸŸå†…çš„ä½åˆ†è¾¨ç‡å—çš„ä¼˜å…ˆçº§ä¼šæ¯”è¾ƒé«˜ï¼Œä¼šè¢«è¾ƒå…ˆç»˜åˆ¶ã€‚</li><li>ä¹‹åæµè§ˆå™¨ä¼šæŠŠé«˜åˆ†è¾¨ç‡çš„å—è¿›è¡Œç»˜åˆ¶ï¼ŒåŒæ ·ä¹Ÿæ˜¯å…ˆç»˜åˆ¶å¤„äºå¯è§†åŒºåŸŸå†…çš„ï¼Œå†ç»˜åˆ¶å¯è§†åŒºåŸŸå¤–çš„(ç”±è¿‘åˆ°è¿œ)ã€‚</li></ul><p>ä»¥ä¸Šè®²çš„è¿™äº›ç­–ç•¥å¯ä»¥ä½¿å¯ä»¥ä½¿å¾—æµè§ˆå™¨ä¼˜å…ˆå±•ç¤ºå¯è§†åŒºåŸŸå†…çš„å†…å®¹ï¼Œå¹¶ä¸”å…ˆå±•ç¤ºå¤§è‡´å†…å®¹ï¼Œå†å±•ç¤ºé«˜ç²¾åº¦å†…å®¹(å½“ç„¶ï¼Œç”±äºè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒå¿«ï¼Œå®é™…ä¸Šæˆ‘ä»¬å¤§å¤šæ—¶å€™æ˜¯æ„Ÿå—ä¸åˆ°çš„)ã€‚</p><p>å¦å¤–è¿™é‡Œå€¼å¾—æé†’çš„ä¸€ç‚¹æ˜¯ï¼Œåˆ†å—çš„ä¼˜å…ˆçº§æ˜¯ä¼šæ ¹æ®åˆ°å¯è§†åŒºåŸŸçš„è·ç¦»æ¥å†³å®šçš„ï¼Œæ‰€ä»¥æœ‰äº›æ¨ªç€çš„å†…å®¹(æ¯”å¦‚bannerçš„æ»šåŠ¨å®ç°ï¼Œé€šå¸¸ä¼šè®¾ç½®æ¨ªå‘è¶…å‡ºå±å¹•æ¥è¡¨ç¤ºéšè—)ï¼Œä¹Ÿæ˜¯ä¼šæŒ‰ç…§åˆ°å¯è§†åŒºåŸŸçš„è·ç¦»æ¥å†³å®šä¼˜å…ˆçº§çš„ã€‚</p><p>ç»˜åˆ¶çš„è¿‡ç¨‹ï¼Œå¯ä»¥è¢«ç¡¬ä»¶åŠ é€Ÿï¼Œè¿™é‡Œç¡¬ä»¶åŠ é€Ÿçš„ä¸»è¦æ‰‹æ®µä¸»è¦æ˜¯æŒ‡ï¼š</p><ul><li>ç¡¬ä»¶åŠ é€Ÿåˆæˆä¸Šå±</li><li>2D Canvasã€Videoçš„ç¡¬ä»¶åŠ é€Ÿ</li><li>GPUå…‰æ …åŒ–<ul><li>GPUå…‰æ …åŒ–é€Ÿåº¦æ›´å¿«ï¼Œå†…å­˜å’ŒCPUçš„æ¶ˆè€—æ›´å°‘</li><li>ç›®å‰è¿˜æ²¡æœ‰åŠæ³•å¯¹åŒ…å«å¤æ‚çŸ¢é‡ç»˜åˆ¶çš„é¡µé¢è¿›è¡ŒGPUå…‰æ …åŒ–</li><li>GPUå…‰æ …åŒ–æ˜¯æœªæ¥è¶‹åŠ¿</li></ul></li></ul><h3 id="chromeå†…æ ¸æ¶æ„å˜è¿"><a href="#chromeå†…æ ¸æ¶æ„å˜è¿" class="headerlink" title="chromeå†…æ ¸æ¶æ„å˜è¿"></a>chromeå†…æ ¸æ¶æ„å˜è¿</h3><p>åœ¨æ¸²æŸ“æ¶æ„ä¸Šï¼Œchromeä¹Ÿæ˜¯ç»å†äº†è¯¸å¤šå˜è¿ï¼Œæ—©æœŸçš„Chromeæ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender/P1.PNG" alt></p><p>æ—©æœŸçš„chromeçš„æ¶æ„å®é™…ä¸Šæœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ul><li>Rendererçº¿ç¨‹ä»»åŠ¡ç¹é‡</li><li>æ— æ³•å®æ—¶å“åº”ç¼©æ”¾æ»‘åŠ¨æ“ä½œ</li><li>è„åŒºåŸŸä¸æ»‘åŠ¨é‡ç»˜åŒºåŸŸæœ‰å†²çª<ul><li>è¿™é‡Œä¸¾ä¸ªåœºæ™¯ï¼Œå‡è®¾ä¸€ä¸ªgifï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœç”¨æˆ·æ»‘åŠ¨ï¼Œæ»‘åŠ¨æ–°çš„éœ€è¦ç»˜åˆ¶çš„å†…å®¹å’Œgifä¸‹ä¸€å¸§å†…å®¹å°±ä¼šäº§ç”Ÿç»˜åˆ¶å†²çª</li></ul></li></ul><p>å½“ç„¶ï¼Œç»è¿‡ä¸€ç³»åˆ—çš„å‘å±•ï¼ŒChromeç°åœ¨æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender/P2.PNG" alt></p><p>åœ¨å®‰å“ä¸Šï¼ŒAndroid 4.4çš„ Blinkå†…æ ¸æ¶æ„å¦‚ä¸‹(4.4ä¹‹å‰å¹¶ä¸æ”¯æŒOpenGL)</p><p><img src="https://www.10000h.top/images/data_img/webRender/P3.PNG" alt></p><p>å½“ç„¶ï¼Œè¿™ç§æ¶æ„ä¹Ÿæœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š</p><ul><li>UIçº¿ç¨‹è¿‡äºç¹å¿™</li><li>æ— æ³•æ”¯æŒCanvasçš„ç¡¬ä»¶åŠ é€Ÿä»¥åŠWebGL</li></ul><p>æ‰€ä»¥ï¼ŒåæœŸå‘å±•æˆäº†è¿™æ ·ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender/P4.PNG" alt></p><p>æ€»ç»“çœ‹æ¥ï¼Œå†…æ ¸å‘å±•çš„è¶‹åŠ¿æ˜¯ï¼š</p><ul><li>å¤šçº¿ç¨‹åŒ–(å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸å¿ƒCPU)</li><li>ç¡¬ä»¶åŠ é€Ÿ(å¯ä»¥åˆ©ç”¨GPU)</li></ul><h3 id="åˆ†å±‚æ¸²æŸ“"><a href="#åˆ†å±‚æ¸²æŸ“" class="headerlink" title="åˆ†å±‚æ¸²æŸ“"></a>åˆ†å±‚æ¸²æŸ“</h3><p>åœ¨é˜…è¯»è¿™ä¸€ç« ä¹‹å‰ï¼Œæˆ‘å»ºè®®è¯»è€…å…ˆå»äº²è‡ªä½“éªŒä¸€ä¸‹æ‰€è°“çš„â€œåˆ†å±‚æ¸²æŸ“â€ï¼š</p><blockquote><p>æ‰“å¼€Chromeæµè§ˆå™¨ï¼Œæ‰“å¼€æ§åˆ¶å°ï¼Œæ‰¾åˆ°â€Layersâ€ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆåœ¨æ§åˆ¶å°å³ä¸Šè§’æ›´å¤šçš„å›¾æ ‡-&gt;More tools æ‰¾åˆ°â€Layersâ€ï¼Œç„¶åéšä¾¿æ‰¾ä¸ªç½‘é¡µæ‰“å¼€å³å¯</p></blockquote><p>ç½‘é¡µçš„åˆ†å±‚æ¸²æŸ“æµç¨‹ä¸»è¦æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender/P7.PNG" alt></p><p>(<em>æ³¨æ„ï¼šå¤šä¸ªRenderObjectå¯èƒ½åˆä¼šå¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªRenderLayer</em>)</p><p>æ—¢ç„¶æ‰ç”¨äº†åˆ†å±‚æ¸²æŸ“ï¼Œé‚£ä¹ˆè‚¯å®šå¯ä»¥æ¥åˆ†å±‚å¤„ç†ï¼Œåˆ†å±‚æ¸²æŸ“æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>å‡å°‘ä¸å¿…è¦çš„é‡æ–°ç»˜åˆ¶</li><li>å¯ä»¥å®ç°è¾ƒä¸ºå¤æ‚çš„åŠ¨ç”»</li><li>èƒ½å¤Ÿæ–¹ä¾¿å®ç°å¤æ‚çš„CSSæ ·å¼</li></ul><p>å½“ç„¶ï¼Œåˆ†å±‚æ¸²æŸ“æ˜¯ä¼šå¾ˆå½±å“æ¸²æŸ“æ•ˆç‡çš„ï¼Œå¯ä»¥æœ‰å¥½çš„å½±å“ï¼Œä½¿ç”¨ä¸å½“ä¹Ÿä¼šæœ‰å·®çš„å½±å“ï¼Œæˆ‘ä»¬éœ€è¦åˆç†çš„æ§åˆ¶å’Œä½¿ç”¨åˆ†å±‚ï¼š</p><ul><li>å¦‚æœå°è±†è…å—åˆ†å±‚è¾ƒå¤šï¼Œé¡µé¢æ•´ä½“çš„åˆ†å±‚æ•°é‡è¾ƒå¤§ï¼Œä¼šå¯¼è‡´æ¯å¸§æ¸²æŸ“æ—¶éå†åˆ†å±‚å’Œè®¡ç®—åˆ†å±‚ä½ç½®è€—æ—¶è¾ƒé•¿å•Š(æ¯”è¾ƒå…¸å‹çš„æ˜¯è…¾è®¯ç½‘ç§»åŠ¨ç«¯é¦–é¡µ)ã€‚</li><li>å¦‚æœå¯è§†åŒºåŸŸå†…åˆ†å±‚å¤ªå¤šä¸”éœ€è¦ç»˜åˆ¶çš„é¢ç§¯å¤ªå¤§ï¼Œæ¸²æŸ“æ€§èƒ½éå¸¸å·®ï¼Œç”šè‡³æ— æ³•è¾¾åˆ°æ­£å¸¸æ˜¾ç¤ºçš„åœ°æ­¥(æ¯”å¦‚æœ‰ä¸€äº›å…¨å±H5)ã€‚</li><li>å¦‚æœé¡µé¢å‡ ä¹æ²¡æœ‰åˆ†å±‚ï¼Œé¡µé¢å˜åŒ–æ—¶å€™éœ€è¦é‡ç»˜çš„åŒºåŸŸè¾ƒå¤šã€‚å…ƒç´ å†…å®¹æ— å˜åŒ–åªæœ‰ä½ç½®å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨åˆ†å±‚æ¥é¿å…é‡ç»˜ã€‚</li></ul><p>é‚£ä¹ˆï¼Œæ˜¯ä»€ä¹ˆåŸå› å¯ä»¥å¯¼è‡´åˆ†å±‚å‘¢ï¼Ÿç›®å‰æ¯ä¸€ä¸ªæµè§ˆå™¨æˆ–è€…ä¸åŒç‰ˆæœ¬çš„æµè§ˆå™¨åˆ†å±‚ç­–ç•¥éƒ½æ˜¯æœ‰äº›ä¸åŒçš„(è™½ç„¶æ€»ä½“å·®ä¸å¤ªå¤š)ï¼Œä½†æœ€å¸¸è§çš„å‡ ä¸ªåˆ†å±‚åŸå› æ˜¯ï¼štransformã€Z-indexï¼›è¿˜æœ‰å¯ä»¥ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿçš„videoã€canvasï¼›fixedå…ƒç´ ï¼›æ··åˆæ’ä»¶(flashç­‰)ã€‚å…³äºå…¶ä»–æ›´å…·ä½“çš„å†…å®¹ï¼Œå¯ä»¥è§ä¸‹æ–‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//æ³¨:Chromeä¸­ç¬¦åˆåˆ›å»ºæ–°å±‚çš„æƒ…å†µï¼š</span><br><span class="line">Layer has 3D or perspective transform CSS properties(æœ‰3Då…ƒç´ çš„å±æ€§)</span><br><span class="line">Layer is used by &lt;video&gt; element using accelerated video decoding(videoæ ‡ç­¾å¹¶ä½¿ç”¨åŠ é€Ÿè§†é¢‘è§£ç )</span><br><span class="line">Layer is used by a &lt;canvas&gt; element with a 3D context or accelerated 2D context(canvaså…ƒç´ å¹¶å¯ç”¨3D)</span><br><span class="line">Layer is used for a composited plugin(æ’ä»¶ï¼Œæ¯”å¦‚flash)</span><br><span class="line">Layer uses a CSS animation for its opacity or uses an animated webkit transform(CSSåŠ¨ç”»)</span><br><span class="line">Layer uses accelerated CSS filters(CSSæ»¤é•œ)</span><br><span class="line">Layer with a composited descendant has information that needs to be in the composited layer tree, such as a clip or reflection(æœ‰ä¸€ä¸ªåä»£å…ƒç´ æ˜¯ç‹¬ç«‹çš„layer)</span><br><span class="line">Layer has a sibling with a lower z-index which has a compositing layer (in other words the layer is rendered on top of a composited layer)(å…ƒç´ çš„ç›¸é‚»å…ƒç´ æ˜¯ç‹¬ç«‹layer)</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹å¦‚ä½•åˆç†çš„è®¾è®¡åˆ†å±‚ï¼šåˆ†å±‚æ€»çš„åŸåˆ™æ˜¯ï¼Œå‡å°‘æ¸²æŸ“é‡ç»˜é¢ç§¯ä¸å‡å°‘åˆ†å±‚ä¸ªæ•°å’Œåˆ†å±‚æ€»é¢ç§¯ï¼š</p><ul><li>ç›¸å¯¹ä½ç½®ä¼šå‘ç”Ÿå˜åŒ–çš„å…ƒç´ éœ€è¦åˆ†å±‚(æ¯”å¦‚bannerå›¾ã€æ»šåŠ¨æ¡)</li><li>å…ƒç´ å†…å®¹æ›´æ–°æ¯”è¾ƒé¢‘ç¹çš„éœ€è¦åˆ†å±‚(æ¯”å¦‚é¡µé¢ä¸­å¤¹æ‚çš„å€’è®¡æ—¶ç­‰)</li><li>è¾ƒé•¿è¾ƒå¤§çš„é¡µé¢æ³¨æ„æ€»çš„åˆ†å±‚ä¸ªæ•°</li><li>é¿å…æŸä¸€å—åŒºåŸŸåˆ†å±‚è¿‡å¤šï¼Œé¢ç§¯è¿‡å¤§</li></ul><p>(<em>å¦‚æœä½ ç»™ä¸€ä¸ªå…ƒç´ æ·»åŠ ä¸Šäº†-webkit-transform: translateZ(0);æˆ–è€… -webkit-transform: translate3d(0,0,0);å±æ€§ï¼Œé‚£ä¹ˆä½ å°±ç­‰äºå‘Šè¯‰äº†æµè§ˆå™¨ç”¨GPUæ¥æ¸²æŸ“è¯¥å±‚ï¼Œä¸ä¸€èˆ¬çš„CPUæ¸²æŸ“ç›¸æ¯”ï¼Œæå‡äº†é€Ÿåº¦å’Œæ€§èƒ½ã€‚(æˆ‘å¾ˆç¡®å®šè¿™ä¹ˆåšä¼šåœ¨Chromeä¸­å¯ç”¨äº†ç¡¬ä»¶åŠ é€Ÿï¼Œä½†åœ¨å…¶ä»–å¹³å°ä¸åšä¿è¯ã€‚å°±æˆ‘å¾—åˆ°çš„èµ„æ–™è€Œè¨€ï¼Œåœ¨å¤§å¤šæ•°æµè§ˆå™¨æ¯”å¦‚Firefoxã€Safariä¹Ÿæ˜¯é€‚ç”¨çš„)</em>)</p><p>å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒX5å¯¹åˆ†å±‚æ–¹é¢åšäº†ä¸€å®šçš„ä¼˜åŒ–å·¥ä½œï¼Œå½“å…¶æ£€æµ‹åˆ°åˆ†å±‚è¿‡å¤šå¯èƒ½ä¼šå‡ºç°æ˜¾ç¤ºé—®é¢˜çš„æ—¶å€™ä¼šè¿›è¡Œå±‚åˆå¹¶ï¼Œç‰ºç‰²æ˜¾ç¤ºæ€§èƒ½æ¢å–æ˜¾ç¤ºæ­£ç¡®æ€§ã€‚</p><p>æœ€åå†æå‡ºä¸€ä¸ªå°é—®é¢˜ï¼š</p><p>ä»¥ä¸‹å“ªç§æ¸²æŸ“æ–¹å¼æ˜¯æœ€ä¼˜çš„å‘¢ï¼Ÿ</p><p><img src="https://www.10000h.top/images/data_img/webRender/P8.PNG" alt></p><p>è¿™é‡Œå®é™…ä¸Šåè€…è™½ç„¶åœ¨åˆ†å±‚ä¸Šæ»¡è¶³æ€»ä½“åŸåˆ™ï¼Œä½†æ˜¯ä¹‹å‰è®²åˆ°æµè§ˆå™¨çš„åˆ†å—æ¸²æŸ“æœºåˆ¶ï¼Œæ˜¯æŒ‰ç…§åˆ°å¯è§†åŒºåŸŸçš„è·ç¦»æ’åºçš„ï¼Œè€ƒè™‘åˆ°è¿™ä¸ªå› ç´ ï¼Œå®é™…ä¸Šåè€…è¿™ç§æ–¹å¼å¯èƒ½ä¼šå¯¹åˆ†å—æ¸²æŸ“é€ æˆä¸€å®šçš„å›°æ‰°ï¼Œå¹¶ä¸”ä¹Ÿä¸æ˜¯æœ€ä¼˜çš„ã€‚</p><h3 id="åŠ¨ç”»-amp-canvas-amp-WebGl"><a href="#åŠ¨ç”»-amp-canvas-amp-WebGl" class="headerlink" title="åŠ¨ç”» &amp; canvas &amp; WebGl"></a>åŠ¨ç”» &amp; canvas &amp; WebGl</h3><p>è®²æœ€åä¸€éƒ¨åˆ†å¼€å§‹ï¼Œé¦–å…ˆæŠ›å‡ºä¸€ä¸ªé—®é¢˜ï¼šCSSåŠ¨ç”» or JSåŠ¨ç”»?</p><p>å¯¹å†…æ ¸æ¥è¯´ï¼Œå®é™…ä¸Šå°±æ˜¯Rendererçº¿ç¨‹åŠ¨ç”»è¿˜æ˜¯Compositorçº¿ç¨‹åŠ¨ç”»ï¼ŒäºŒè€…å®é™…ä¸Šè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender/P9.PNG" alt></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒRendererçº¿ç¨‹æ˜¯æ¯”Compositorçº¿ç¨‹åŠ¨ç”»æ€§èƒ½å·®çš„(åœ¨ä¸­ä½ç«¯å°¤å…¶æ˜æ˜¾)</p><p>å¦å¤–ï¼Œæ— è®ºæ˜¯JSåŠ¨ç”»è¿˜æ˜¯CSSåŠ¨ç”»ï¼ŒåŠ¨ç”»è¿‡ç¨‹ä¸­çš„é‡ç»˜ä»¥åŠæ ·å¼å˜åŒ–éƒ½ä¼šæ‹–æ…¢åŠ¨ç”»æ‰§è¡Œä»¥åŠå¼•èµ·å¡é¡¿<br>ä»¥ä¸‹æ˜¯ä¸€äº›ä¸ä¼šè§¦å‘é‡ç»˜æˆ–è€…æ’ç‰ˆçš„CSSåŠ¨ç”»å±æ€§ï¼š</p><ul><li>cursor</li><li>font-variant</li><li>opacity</li><li>orphans</li><li>perspective</li><li>perspecti-origin</li><li>pointer-events</li><li>transform</li><li>transform-style</li><li>widows</li></ul><p>æƒ³è¦äº†è§£æ›´å¤šå†…å®¹ï¼Œå¯ä»¥å‚è€ƒ<a href="https://csstriggers.com/" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p>è¿™æ–¹é¢æœ€ç»ˆçš„å»ºè®®å‚è€ƒå¦‚ä¸‹ï¼š</p><ul><li>å°½é‡ä½¿ç”¨ä¸ä¼šå¼•èµ·é‡ç»˜çš„CSSå±æ€§åŠ¨ç”»ï¼Œä¾‹å¦‚transformã€opacityç­‰</li><li>åŠ¨ç”»ä¸€å®šè¦é¿å…è§¦å‘å¤§é‡å…ƒç´ é‡æ–°æ’ç‰ˆæˆ–è€…å¤§é¢ç§¯é‡ç»˜</li><li>åœ¨æœ‰åŠ¨ç”»æ‰§è¡Œæ—¶ï¼Œé¿å…å…¶ä»–åŠ¨ç”»ä¸ç›¸å…³å› ç´ å¼•èµ·æ’ç‰ˆå’Œé‡ç»˜</li></ul><h4 id="requestAnimationFrame"><a href="#requestAnimationFrame" class="headerlink" title="requestAnimationFrame"></a>requestAnimationFrame</h4><p>å¦å¤–å½“æˆ‘ä»¬åœ¨ä½¿ç”¨åŠ¨ç”»çš„æ—¶å€™ï¼Œä¸ºäº†é¿å…å‡ºç°æ‰å¸§çš„æƒ…å†µï¼Œæœ€å¥½é‡‡ç”¨requestAnimationFrameè¿™ä¸ªAPIï¼Œè¿™ä¸ªAPIè¿åˆæµè§ˆå™¨çš„æµç¨‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¿è¯åœ¨ä¸‹ä¸€å¸§ç»˜åˆ¶çš„æ—¶å€™ä¸Šä¸€å¸§ä¸€å®šå‡ºç°äº†ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender/P11.PNG" alt></p><h3 id="3D-canvas"><a href="#3D-canvas" class="headerlink" title="3D canvas"></a>3D canvas</h3><p>è¿˜æœ‰å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦æ¶‰åŠå¤§é‡å…ƒç´ çš„åŠ¨ç”»(æ¯”å¦‚é›ªèŠ±é£˜è½ã€å¤šä¸ªä¸è§„åˆ™å›¾å½¢å˜åŒ–ç­‰)ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœç”¨CSSåŠ¨ç”»ï¼ŒAnimationåŠ¨ç”»çš„å…ƒç´ å¾ˆå¤šã€‚ï¼Œå¯¼è‡´åˆ†å±‚ä¸ªæ•°éå¸¸å¤šï¼Œæµè§ˆå™¨æ¯å¸§éƒ½éœ€è¦éå†è®¡ç®—æ‰€æœ‰åˆ†å±‚ï¼Œå¯¼è‡´æ¯”è¾ƒè€—æ—¶ã€</p><p>è¿™ä¸ªæ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>2D canvasä¸Šåœºã€‚ </p><p>å’ŒCSSåŠ¨ç”»ç›¸æ¯”ï¼Œ2D canvasçš„ä¼˜ç‚¹æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“</li><li>æ¸²æŸ“æµç¨‹æ›´ä¼˜</li></ul><p>å…¶æ¸²æŸ“æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender/P10.PNG" alt></p><p>å®é™…ä¸Šä»¥ä¸Šæµç¨‹æ¯”è¾ƒè€—æ—¶çš„æ˜¯JS Callè¿™ä¸€éƒ¨åˆ†ï¼Œæ‰§è¡Œopenglçš„è¿™ä¸€éƒ¨åˆ†è¿˜æ˜¯æŒºå¿«çš„ã€‚</p><p>HTML 2D canvas ä¸»è¦ç»˜åˆ¶å¦‚ä¸‹ä¸‰ç§å…ƒç´ ï¼š</p><ul><li>å›¾ç‰‡</li><li>æ–‡å­—</li><li>çŸ¢é‡</li></ul><p>è¿™ä¸ªè¿‡ç¨‹å¯ä»¥é‡‡ç”¨ç¡¬ä»¶åŠ é€Ÿï¼Œç¡¬ä»¶åŠ é€Ÿå›¾ç‰‡ç»˜åˆ¶çš„ä¸»è¦æµç¨‹ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender/P12.PNG" alt></p><p>ç¡¬ä»¶åŠ é€Ÿæ–‡å­—ç»˜åˆ¶çš„ä¸»è¦æµç¨‹ï¼š</p><p><img src="https://www.10000h.top/images/data_img/webRender/P13.PNG" alt></p><p>ä½†å¯¹äºçŸ¢é‡ç»˜åˆ¶è€Œè¨€ï¼Œç®€å•çš„å›¾å½¢ï¼Œæ¯”å¦‚ç‚¹ã€ç›´çº¿ç­‰å¯ä»¥ç›´æ¥ä½¿ç”¨OpenGLæ¸²æŸ“ï¼Œå¤æ‚çš„å›¾å½¢ï¼Œå¦‚æ›²çº¿ç­‰ï¼Œæ— æ³•é‡‡ç”¨OpenGLç»˜åˆ¶ã€‚</p><p>å¯¹äºç»˜åˆ¶æ•ˆç‡æ¥è¯´ï¼Œ2D Canvaså¯¹ç»˜åˆ¶å›¾ç‰‡æ•ˆç‡è¾ƒé«˜ï¼Œç»˜åˆ¶æ–‡å­—å’ŒçŸ¢é‡æ•ˆç‡è¾ƒä½(<strong>æ‰€ä»¥å»ºè®®æ˜¯ï¼Œæˆ‘ä»¬å¦‚æœèƒ½ä½¿ç”¨è´´å›¾å°±å°½é‡ä½¿ç”¨è´´å›¾äº†</strong>)</p><p>è¿˜æœ‰ï¼Œæœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦å…ˆç»˜åˆ¶åˆ°ç¦»å±canvasä¸Šé¢ï¼Œç„¶åå†ä¸Šå±ï¼Œè¿™ä¸ªå¯ä»¥å……åˆ†åˆ©ç”¨ç¼“å­˜ã€‚</p><h3 id="3D-canvas-WebGL"><a href="#3D-canvas-WebGL" class="headerlink" title="3D canvas(WebGL)"></a>3D canvas(WebGL)</h3><p>ç›®å‰ï¼Œ3D canvas(WebGL)çš„åº”ç”¨ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œå¯¹äºè¿™ç±»åº”ç”¨ï¼Œç°åœ¨å·²ç»æœ‰äº†ä¸å°‘å·²ç»æˆå‹çš„åº«:</p><ul><li>é€šç”¨å¼•æ“ï¼šthreeJSã€Pixi</li><li>VRè§†é¢‘çš„ä¸“ä¸šå¼•æ“ï¼škrpanoã€UtoVR</li><li>H5æ¸¸æˆå¼•æ“ï¼šEgretã€Layaboxã€Cocos</li></ul><p>WebGLè™½ç„¶åŒ…å«Webï¼Œä½†æœ¬èº«å¯¹å‰ç«¯çš„è¦æ±‚æœ€ä½ï¼Œä½†æ˜¯å¯¹OpenGLã€æ•°å­¦ç›¸å…³çš„çŸ¥è¯†è¦æ±‚è¾ƒé«˜ï¼Œæ‰€ä»¥å¦‚æœå‰ç«¯å·¥ç¨‹å¸ˆæ²¡æœ‰ä¸€å®šçš„åŸºç¡€ï¼Œè¿˜æ˜¯é‡‡ç”¨ç°åœ¨çš„æµè¡Œåº«ã€‚</p><p>X5å†…æ ¸å¯¹äºWebGlè¿›è¡Œäº†æ€§èƒ½ä¸Šå’Œè€—ç”µä¸Šçš„ä¼˜åŒ–ï¼Œå¹¶ä¸”ä¹Ÿå¯¹å…¼å®¹æ€§é”™è¯¯ä¸ŠæŠ¥å’Œä¿®å¤åšäº†ä¸€å®šçš„å·¥ä½œã€‚</p><hr><p>æœ¬æ–‡å‚è€ƒè…¾è®¯å†…éƒ¨è®²åº§èµ„æ–™æ•´ç†è€Œæˆï¼Œå¹¶èå…¥ä¸€éƒ¨åˆ†ç¬”è€…çš„è¡¥å……ï¼Œè°¢ç»ä»»ä½•å½¢å¼çš„è½¬è½½ã€‚</p><p>å…¶ä»–ä¼˜è´¨å¥½æ–‡ï¼š</p><p><a href="http://qingbob.com/javascript-high-performance-animation-and-page-rendering/" target="_blank" rel="noopener">Javascripté«˜æ€§èƒ½åŠ¨ç”»ä¸é¡µé¢æ¸²æŸ“</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
